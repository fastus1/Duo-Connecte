---
phase: 01-cleanup
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - shared/schema.ts
  - client/src/contexts/SessionContext.tsx
  - client/src/components/AdminPreviewSidebar.tsx
autonomous: true

must_haves:
  truths:
    - "SessionContext no longer references senderName or receiverName"
    - "shared/schema.ts has no duoFlow export"
    - "AdminPreviewSidebar shows only admin/support pages, no Duo navigation"
  artifacts:
    - path: "shared/schema.ts"
      provides: "Clean schema without Duo-specific flow config"
      not_contains: ["duoFlow", "senderName", "receiverName", "FlowConfig", "FlowType"]
    - path: "client/src/contexts/SessionContext.tsx"
      provides: "Simplified session context for template"
      not_contains: ["senderName", "receiverName", "duo-connecte-names"]
    - path: "client/src/components/AdminPreviewSidebar.tsx"
      provides: "Admin sidebar with only template pages"
      not_contains: ["duoFlow", "Parcours Duo", "Inversion des rôles"]
  key_links:
    - from: "client/src/contexts/SessionContext.tsx"
      to: "shared/schema.ts"
      via: "SessionState type import"
      pattern: "import.*SessionState.*from.*schema"
---

<objective>
Clean up schema, context, and sidebar to remove Duo-specific logic

Purpose: Remove participant tracking (senderName/receiverName), Duo flow configuration, and Duo navigation from the codebase, leaving a clean template structure.

Output: Simplified schema.ts without flow config, clean SessionContext without participant names, and AdminPreviewSidebar with only template-relevant pages.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-cleanup/01-RESEARCH.md
@.planning/phases/01-cleanup/01-01-SUMMARY.md
@shared/schema.ts
@client/src/contexts/SessionContext.tsx
@client/src/components/AdminPreviewSidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove Duo flow configuration from schema.ts</name>
  <files>shared/schema.ts</files>
  <action>
Modify shared/schema.ts to remove all Duo-specific exports:

1. **Remove sessionStateSchema participant fields (around line 147-166):**
   Simplify the schema to only keep generic session tracking:
   ```typescript
   // Session state for template (simplified)
   export const sessionStateSchema = z.object({
     currentStep: z.number().min(0).default(0),
     lastUpdated: z.string().optional(),
   });

   export type SessionState = z.infer<typeof sessionStateSchema>;
   ```

   Remove these fields:
   - senderName, receiverName
   - appType
   - All checklist fields (checklistSituation, checklistVecu, etc.)
   - suiviNecessaire

2. **Remove FlowType, FlowConfig, duoFlow, getFlow, pages, sectionNames (lines 222-302):**
   Delete entirely:
   - `export type FlowType = 'duo';`
   - `export interface FlowConfig { ... }`
   - `export const duoFlow: FlowConfig = { ... }` (entire object with 39 pages)
   - `export function getFlow(_appType?: FlowType): FlowConfig { ... }`
   - `export const pages = duoFlow.pages;`
   - `export const sectionNames = [...] as const;`

Keep all database tables and their schemas (users, loginAttempts, appConfig, paidMembers, feedbacks, supportTickets) - these are infrastructure.
  </action>
  <verify>
Run `npm run check` - no TypeScript errors.
Verify with grep: `grep -E "(duoFlow|FlowConfig|senderName|receiverName)" shared/schema.ts` returns empty.
  </verify>
  <done>
schema.ts exports only database tables, validation schemas for auth/admin/support, and a simplified sessionStateSchema without participant tracking.
  </done>
</task>

<task type="auto">
  <name>Task 2: Simplify SessionContext to remove participant logic</name>
  <files>client/src/contexts/SessionContext.tsx</files>
  <action>
Modify client/src/contexts/SessionContext.tsx to remove Duo-specific state:

1. **Simplify SessionState usage:**
   Update to use the new simplified SessionState type (just currentStep and lastUpdated).

2. **Remove loadSavedNames function (lines 22-36):**
   Delete the entire function that loads senderName/receiverName from localStorage.

3. **Update defaultSession (line 14-18):**
   ```typescript
   const defaultSession: SessionState = {
     currentStep: 0,
     lastUpdated: new Date().toISOString(),
   };
   ```

4. **Remove savedNames initialization in SessionProvider (line 38-43):**
   ```typescript
   export function SessionProvider({ children }: { children: ReactNode }) {
     const [session, setSession] = useState<SessionState>(defaultSession);
   ```

5. **Remove the localStorage sync useEffect (lines 54-65):**
   Delete the entire useEffect that saves names to 'duo-connecte-names'.

6. **Keep these functions as-is (they're generic enough):**
   - updateSession
   - resetSession
   - goToStep
   - goBack

Result: A clean ~50-line SessionContext that tracks only currentStep and lastUpdated.
  </action>
  <verify>
Run `npm run check` - no TypeScript errors.
Verify: `grep -E "(senderName|receiverName|duo-connecte-names)" client/src/contexts/SessionContext.tsx` returns empty.
  </verify>
  <done>
SessionContext.tsx is simplified to ~50 lines, tracking only currentStep and lastUpdated, with no localStorage persistence for names.
  </done>
</task>

<task type="auto">
  <name>Task 3: Simplify AdminPreviewSidebar to remove Duo navigation</name>
  <files>client/src/components/AdminPreviewSidebar.tsx</files>
  <action>
Modify client/src/components/AdminPreviewSidebar.tsx to remove all Duo-specific content:

1. **Remove duoFlow import (line 25):**
   Delete: `import { duoFlow } from '@shared/schema';`

2. **Simplify specialPages array (lines 29-36):**
   Keep only template-relevant pages:
   ```typescript
   const templatePages = [
       { path: '/welcome', label: 'Welcome Page', icon: Home },
       { path: '/admin-login', label: 'Admin Login', icon: Shield },
       { path: '/admin', label: 'Admin Dashboard', icon: Shield },
       { path: '/support', label: 'Support Page', icon: HelpCircle },
   ];
   ```
   Remove: `/duo/feedback` and `/duo/completion` entries.

3. **Remove demoScreens array (lines 38-43):**
   Delete the entire array (demo pages were deleted in Plan 01).

4. **Remove duoPageLabels and inversionPageLabels objects (lines 45-87):**
   Delete both entire objects - no longer needed.

5. **Simplify the sidebar content:**
   Remove these CollapsibleSection components:
   - "Écrans de démonstration" section
   - "Parcours Duo" section
   - "Inversion des rôles" section

   Keep only the "Pages spéciales" section, renamed to "Template Pages":
   ```tsx
   <SidebarGroup>
       <SidebarGroupLabel className="py-2">
           <div className="flex items-center gap-2">
               <Home className="h-4 w-4" />
               <span>Template Pages</span>
           </div>
       </SidebarGroupLabel>
       <SidebarGroupContent>
           <SidebarMenu>
               {templatePages.map((page) => (
                   <SidebarMenuItem key={page.path}>
                       <SidebarMenuButton
                           onClick={() => handleNavigate(page.path)}
                           isActive={isActive(page.path)}
                       >
                           <page.icon className="h-4 w-4" />
                           <span>{page.label}</span>
                       </SidebarMenuButton>
                   </SidebarMenuItem>
               ))}
           </SidebarMenu>
       </SidebarGroupContent>
   </SidebarGroup>
   ```

6. **Remove unused imports:**
   - Remove: `Users, RefreshCw, Heart, Loader2, Lock, LogIn` if no longer used
   - Remove: `CollapsibleSection` component if sidebar is simplified to non-collapsible
   - Remove: `Collapsible, CollapsibleContent, CollapsibleTrigger` if not used
   - Remove: `useState` if CollapsibleSection is removed

Result: A clean ~80-line AdminPreviewSidebar showing only template-relevant pages.
  </action>
  <verify>
Run `npm run check` - no TypeScript errors.
Verify: `grep -E "(duoFlow|Parcours Duo|Inversion)" client/src/components/AdminPreviewSidebar.tsx` returns empty.
  </verify>
  <done>
AdminPreviewSidebar.tsx shows only Welcome, Admin Login, Admin Dashboard, and Support pages. No Duo workflow navigation.
  </done>
</task>

</tasks>

<verification>
- [ ] `npm run check` passes without TypeScript errors
- [ ] `grep -E "(duoFlow|FlowConfig|senderName|receiverName)" shared/schema.ts` returns empty
- [ ] `grep -E "(senderName|receiverName|duo-connecte-names)" client/src/contexts/SessionContext.tsx` returns empty
- [ ] `grep -E "(duoFlow|Parcours Duo|Inversion)" client/src/components/AdminPreviewSidebar.tsx` returns empty
</verification>

<success_criteria>
1. schema.ts has no duoFlow, FlowConfig, FlowType, senderName, receiverName exports
2. SessionContext.tsx tracks only currentStep and lastUpdated
3. AdminPreviewSidebar.tsx shows only 4 template pages (Welcome, Admin Login, Admin Dashboard, Support)
4. npm run check passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-cleanup/01-02-SUMMARY.md`
</output>
