---
phase: 03-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Health endpoint returns 200 OK with database connected"
    - "Frontend loads and renders without JavaScript errors"
    - "Navigation between pages works correctly"
    - "Database can read and write data"
    - "Admin panel is accessible and functional"
  artifacts:
    - path: "https://duo-connecte-production.up.railway.app/api/health"
      provides: "Health status with database connection confirmation"
      contains: '"status": "ok"'
    - path: "https://duo-connecte-production.up.railway.app/admin"
      provides: "Admin dashboard access"
  key_links:
    - from: "Frontend"
      to: "/api/health"
      via: "HTTP GET request"
      pattern: "status.*ok"
    - from: "Admin panel"
      to: "Neon PostgreSQL"
      via: "storage.ts CRUD operations"
      pattern: "database.*connected"
---

<objective>
Verify core API and frontend functionality on Railway production deployment

Purpose: Confirm that the basic application infrastructure (health endpoint, frontend rendering, database connectivity) works correctly after migration from Replit to Railway. This validates VAL-01, VAL-02, and VAL-03 requirements.

Output: Documented verification of API responses, frontend behavior, and database operations with any issues identified and resolved.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-validation/03-RESEARCH.md
@.planning/phases/02-railway-setup/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify health endpoint and database connectivity</name>
  <files>None (verification only)</files>
  <action>
Test the production health endpoint to verify server is running and database is connected.

Execute these curl commands and document results:

```bash
# Test health endpoint
curl -s https://duo-connecte-production.up.railway.app/api/health | jq

# Expected response:
# {
#   "status": "ok",
#   "database": "connected",
#   "config": { ... 4 security flags ... },
#   "timestamp": "..."
# }

# Test config endpoint
curl -s https://duo-connecte-production.up.railway.app/api/config | jq

# Verify admin user exists
curl -s "https://duo-connecte-production.up.railway.app/api/debug/admin-check?email=fastusone@gmail.com" | jq
```

**If health endpoint shows database disconnected:**
1. Check Railway logs: `railway logs`
2. Verify DATABASE_URL is set: `railway variables`
3. Test Neon connection via Neon console

**If any endpoint returns 404 or 500:**
1. Check Railway deployment status: `railway status`
2. Check if latest deployment succeeded
3. Review server logs for errors
  </action>
  <verify>
curl -s https://duo-connecte-production.up.railway.app/api/health returns JSON with "status": "ok" and "database": "connected"
  </verify>
  <done>
Health endpoint returns 200 with connected database status. Config endpoint returns security layer settings. Admin user verified in database.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify database CRUD operations</name>
  <files>None (verification only)</files>
  <action>
Test database read/write operations through the admin panel API endpoints.

**Test 1: Read operations (via health endpoint already confirmed)**
- GET /api/config reads app_config table
- GET /api/debug/admin-check reads users table

**Test 2: Write operations via admin panel**
Access the admin panel and test these operations:

1. Navigate to https://duo-connecte-production.up.railway.app/admin-login
2. Log in with admin credentials (fastusone@gmail.com)
3. Go to Security tab and toggle a setting (e.g., enable/disable requireCircleDomain)
4. Refresh page and verify setting persisted

Document any errors encountered. If login fails, check:
- Is the admin user created? (use debug endpoint)
- Is the PIN set correctly?

**Expected behavior:**
- Admin login works with email + PIN
- Security settings can be toggled
- Settings persist after page refresh
  </action>
  <verify>
Admin can log in, toggle security settings, and see changes persist after page refresh.
  </verify>
  <done>
Database write operations confirmed working: security settings can be modified and persist across page loads.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify frontend rendering and navigation</name>
  <what-built>
Railway deployment with React frontend serving multiple pages: homepage, welcome, admin-login, admin dashboard, and duo flow pages.
  </what-built>
  <how-to-verify>
Test frontend rendering and navigation in your browser:

1. **Homepage test:**
   - Open https://duo-connecte-production.up.railway.app/
   - Page should load without JavaScript errors (check browser console)
   - Expected: Welcome or landing page content renders

2. **Navigation test:**
   - Click any navigation links present
   - Or manually navigate to:
     - /welcome (welcome page)
     - /admin-login (admin login form)
   - Each page should render without errors

3. **Admin dashboard test:**
   - After logging in at /admin-login
   - Navigate to /admin
   - All admin tabs should be accessible (Security, Webhooks, Paid Members, etc.)

4. **Browser console check:**
   - Open DevTools (F12) -> Console tab
   - Look for any red error messages
   - Minor warnings are okay, but no critical errors

**Report any issues:**
- Pages that don't load
- Navigation that doesn't work
- Console errors (copy the error message)
- Missing content or broken layouts
  </how-to-verify>
  <resume-signal>
Type "approved" if all pages load correctly with working navigation, or describe specific issues encountered.
  </resume-signal>
</task>

</tasks>

<verification>
Phase 3 Plan 01 is complete when:
1. curl to /api/health returns `{"status": "ok", "database": "connected", ...}`
2. curl to /api/config returns security layer configuration
3. Admin user can log in and modify settings
4. Settings persist after page refresh (database writes work)
5. All frontend pages load without JavaScript errors
6. Navigation between pages works correctly
</verification>

<success_criteria>
- VAL-01: Health endpoint responds with 200 OK and database connected
- VAL-02: Frontend loads completely and navigation works
- VAL-03: Database CRUD operations verified (read via health, write via admin settings)
</success_criteria>

<output>
After completion, create `.planning/phases/03-validation/03-01-SUMMARY.md`
</output>
