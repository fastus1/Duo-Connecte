---
phase: 02-template-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ARCHITECTURE.md
autonomous: true

must_haves:
  truths:
    - "ARCHITECTURE.md exists at project root"
    - "AI (Claude Code) can understand the codebase by reading one file"
    - "Document is in French as specified"
    - "Points d'extension clearly indicate where to add pages/API/schema"
  artifacts:
    - path: "ARCHITECTURE.md"
      provides: "Complete architecture documentation for AI consumption"
      min_lines: 200
      contains:
        - "Vue d'Ensemble"
        - "Stack Technique"
        - "Structure des Dossiers"
        - "Flux d'Authentification"
        - "Points d'Extension"
  key_links:
    - from: "ARCHITECTURE.md"
      to: "client/src/App.tsx"
      via: "reference in routing section"
    - from: "ARCHITECTURE.md"
      to: "server/routes/"
      via: "reference in API section"
    - from: "ARCHITECTURE.md"
      to: "shared/schema.ts"
      via: "reference in schema section"
---

<objective>
Create ARCHITECTURE.md - a single comprehensive architecture document in French that enables an AI (Claude Code with GSD) to quickly understand and work with this Circle.so app template.

Purpose: Make the template "ready to clone" - a developer (human or AI) can duplicate the repo and immediately understand where to put their code.

Output: `/ARCHITECTURE.md` (200-400 lines) containing project structure, tech stack, auth flows, access control, and extension points.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-template-structure/02-CONTEXT.md
@.planning/phases/02-template-structure/02-RESEARCH.md

# Key source files to reference while documenting:
@client/src/App.tsx
@client/src/contexts/AccessContext.tsx
@server/routes.ts
@server/storage.ts
@shared/schema.ts
@.env.example
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ARCHITECTURE.md</name>
  <files>ARCHITECTURE.md</files>
  <action>
Create `/ARCHITECTURE.md` at project root with the following structure (all in French):

**1. Vue d'Ensemble** (~5 lines)
- One paragraph explaining: Circle.so app template, auth integree, admin dashboard
- Target audience: AI qui va utiliser /gsd:new-project

**2. Stack Technique** (~20 lines)
- Table format with columns: Library | Version | Purpose
- Include: React 18, Vite, Express, Drizzle ORM, wouter, TanStack Query, TailwindCSS
- Supporting libs: @neondatabase/serverless, jsonwebtoken, bcrypt, zod

**3. Structure des Dossiers** (~30 lines)
- ASCII tree showing client/, server/, shared/
- Brief annotation for each major directory
- Reference 02-RESEARCH.md lines 56-87 for verified structure

**4. Flux d'Authentification** (~50 lines)
- ASCII diagram showing Circle.so postMessage -> AccessContext -> JWT flow
- Reference diagram from 02-RESEARCH.md lines 199-229
- Explain PIN optional flow (new user vs existing)
- Code references: AccessContext.tsx, server/routes/auth.ts, server/middleware.ts

**5. Controle d'Acces (AccessGate)** (~20 lines)
- Modes: development (acces libre), production (verification Circle.so + paywall)
- Reference: client/src/App.tsx AccessGate component
- Brief explanation of how routes are protected

**6. Points d'Extension** (~40 lines)
Three sections with file pointers (NOT step-by-step guides):
- Ajouter une Page: client/src/pages/, route in App.tsx
- Ajouter une API: server/routes/, register in routes/index.ts
- Modifier le Schema: shared/schema.ts, run npm run db:push

**7. Configuration** (~20 lines)
- Reference .env.example
- Brief mention of dev/prod modes (managed via admin panel)
- Key env vars: DATABASE_URL, JWT_SECRET, VITE_* variables

**Important guidelines:**
- Write ONLY in French (code snippets can stay in English)
- Target 200-400 lines total
- ASCII diagrams only where they CLARIFY (auth flow yes, others optional)
- Pointers to files, not exhaustive documentation of each file
- The reader is an AI that will figure out details by reading code
  </action>
  <verify>
1. File exists: `test -f ARCHITECTURE.md && echo "EXISTS"`
2. Word count reasonable: `wc -l ARCHITECTURE.md` shows 200-400 lines
3. Contains key sections: `grep -c "## " ARCHITECTURE.md` shows 6-8 sections
4. In French: `grep -i "d'authentification\|d'extension\|d'ensemble" ARCHITECTURE.md`
5. Build still passes: `npm run build`
  </verify>
  <done>
- ARCHITECTURE.md exists at project root
- Contains all 7 sections (Vue d'Ensemble through Configuration)
- Between 200-400 lines
- Written in French
- References actual file paths in the codebase
- ASCII diagram for auth flow included
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate documentation accuracy</name>
  <files>ARCHITECTURE.md</files>
  <action>
Verify that all file paths and references in ARCHITECTURE.md are accurate:

1. Check all file paths mentioned exist:
   - client/src/App.tsx
   - client/src/contexts/AccessContext.tsx
   - client/src/pages/
   - server/routes.ts
   - server/routes/
   - server/storage.ts
   - shared/schema.ts
   - .env.example

2. Verify the tech stack versions match package.json

3. Ensure the folder structure tree matches actual codebase structure

4. Fix any inaccuracies found

This ensures an AI reading the doc won't be confused by outdated or incorrect references.
  </action>
  <verify>
1. All paths exist: `for f in client/src/App.tsx client/src/contexts/AccessContext.tsx server/routes.ts server/storage.ts shared/schema.ts .env.example; do test -f "$f" && echo "$f OK"; done`
2. Directories exist: `for d in client/src/pages server/routes; do test -d "$d" && echo "$d OK"; done`
3. No broken references in doc
  </verify>
  <done>
- All file paths in ARCHITECTURE.md verified to exist
- Tech stack versions match package.json
- Folder structure tree matches reality
- Document is accurate and trustworthy for AI consumption
  </done>
</task>

</tasks>

<verification>
Phase 02 verification checks:

1. **File existence:** `test -f ARCHITECTURE.md`
2. **Length check:** `wc -l ARCHITECTURE.md` between 200-400
3. **Section structure:** Contains Vue d'Ensemble, Stack, Structure, Flux, AccessGate, Extension, Configuration
4. **Language:** Written in French (headings and content)
5. **Build integrity:** `npm run build` still passes
6. **Path accuracy:** All referenced files/directories exist
</verification>

<success_criteria>
- [ ] ARCHITECTURE.md exists at project root
- [ ] Document is 200-400 lines
- [ ] Contains all required sections
- [ ] Written in French
- [ ] ASCII auth flow diagram included
- [ ] All file path references are accurate
- [ ] Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-template-structure/02-01-SUMMARY.md`
</output>
