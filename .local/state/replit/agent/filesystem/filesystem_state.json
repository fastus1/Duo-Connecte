{"file_contents":{"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/App.tsx":{"content":"import React, { useEffect } from 'react';\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { SessionProvider, useSession } from '@/contexts/SessionContext';\nimport { AccessProvider, useAccess } from '@/contexts/AccessContext';\nimport { soloFlow, duoFlow, getFlow } from '@shared/schema';\n\n// Template Pages\nimport AuthPage from \"@/pages/auth\";\nimport Dashboard from \"@/pages/dashboard\";\n\nimport AdminLogin from \"@/pages/admin-login\";\nimport NotFound from \"@/pages/not-found\";\nimport { GlobalHeader } from \"@/components/GlobalHeader\";\n\n// Duo Connecte Pages\nimport Welcome from '@/pages/Welcome';\nimport PaywallScreen from '@/pages/PaywallScreen';\n\n// Import Solo flow pages\nimport SoloRoles from '@/pages/SoloRoles';\nimport SoloWarnings from '@/pages/SoloWarnings';\nimport SoloIntention from '@/pages/SoloIntention';\nimport SoloSenderGrounding from '@/pages/SoloSenderGrounding';\nimport SoloReceiverGrounding from '@/pages/SoloReceiverGrounding';\nimport SoloTransition1 from '@/pages/SoloTransition1';\nimport SoloSenderSituation from '@/pages/SoloSenderSituation';\nimport SoloSenderExperience from '@/pages/SoloSenderExperience';\nimport SoloSenderInterpretation from '@/pages/SoloSenderInterpretation';\nimport SoloSenderImpact from '@/pages/SoloSenderImpact';\nimport SoloSenderSummary from '@/pages/SoloSenderSummary';\nimport SoloReceiverValidation from '@/pages/SoloReceiverValidation';\nimport SoloSenderConfirmation from '@/pages/SoloSenderConfirmation';\nimport SoloSenderClarification from '@/pages/SoloSenderClarification';\nimport SoloReceiverExperience from '@/pages/SoloReceiverExperience';\nimport SoloSenderValidation from '@/pages/SoloSenderValidation';\nimport SoloReceiverConfirmation from '@/pages/SoloReceiverConfirmation';\nimport SoloTransition2 from '@/pages/SoloTransition2';\nimport SoloSenderNeeds from '@/pages/SoloSenderNeeds';\nimport SoloReceiverResponse from '@/pages/SoloReceiverResponse';\nimport SoloTransition3 from '@/pages/SoloTransition3';\nimport SoloSenderClosing from '@/pages/SoloSenderClosing';\nimport SoloReceiverClosing from '@/pages/SoloReceiverClosing';\nimport SoloThanks from '@/pages/SoloThanks';\nimport SoloFeedback from '@/pages/SoloFeedback';\nimport SoloCompletion from '@/pages/SoloCompletion';\n\n// Import Duo flow pages\nimport DuoRoles from '@/pages/DuoRoles';\nimport DuoWarnings from '@/pages/DuoWarnings';\nimport DuoIntention from '@/pages/DuoIntention';\nimport DuoSenderGrounding from '@/pages/DuoSenderGrounding';\nimport DuoReceiverGrounding from '@/pages/DuoReceiverGrounding';\nimport DuoTransition1 from '@/pages/DuoTransition1';\nimport DuoSenderSituation from '@/pages/DuoSenderSituation';\nimport DuoSenderExperience from '@/pages/DuoSenderExperience';\nimport DuoSenderInterpretation from '@/pages/DuoSenderInterpretation';\nimport DuoSenderImpact from '@/pages/DuoSenderImpact';\nimport DuoSenderSummary from '@/pages/DuoSenderSummary';\nimport DuoReceiverValidation from '@/pages/DuoReceiverValidation';\nimport DuoSenderConfirmation from '@/pages/DuoSenderConfirmation';\nimport DuoReceiverExperience from '@/pages/DuoReceiverExperience';\nimport DuoSenderValidation from '@/pages/DuoSenderValidation';\nimport DuoReceiverConfirmation from '@/pages/DuoReceiverConfirmation';\nimport DuoTransition2 from '@/pages/DuoTransition2';\nimport DuoSenderNeeds from '@/pages/DuoSenderNeeds';\nimport DuoReceiverResponse from '@/pages/DuoReceiverResponse';\nimport DuoTransition3 from '@/pages/DuoTransition3';\nimport DuoSenderClosing from '@/pages/DuoSenderClosing';\nimport DuoReceiverClosing from '@/pages/DuoReceiverClosing';\nimport DuoFeedback from '@/pages/DuoFeedback';\nimport DuoCompletion from '@/pages/DuoCompletion';\n\n// Import Duo Inversion flow pages\nimport DuoInversionPage7a from '@/pages/DuoInversionPage7a';\nimport DuoInversionPage8a from '@/pages/DuoInversionPage8a';\nimport DuoInversionPage9a from '@/pages/DuoInversionPage9a';\nimport DuoInversionPage10a from '@/pages/DuoInversionPage10a';\nimport DuoInversionPage11a from '@/pages/DuoInversionPage11a';\nimport DuoInversionPage12a from '@/pages/DuoInversionPage12a';\nimport DuoInversionPage13a from '@/pages/DuoInversionPage13a';\nimport DuoInversionPage14a from '@/pages/DuoInversionPage14a';\nimport DuoInversionPage15a from '@/pages/DuoInversionPage15a';\nimport DuoInversionPage16a from '@/pages/DuoInversionPage16a';\nimport DuoInversionPage17a from '@/pages/DuoInversionPage17a';\nimport DuoInversionPage18a from '@/pages/DuoInversionPage18a';\nimport DuoInversionPage19a from '@/pages/DuoInversionPage19a';\nimport DuoInversionPage20a from '@/pages/DuoInversionPage20a';\n\nconst soloPageComponents = [\n  Welcome,\n  SoloRoles,\n  SoloWarnings,\n  SoloIntention,\n  SoloSenderGrounding,\n  SoloReceiverGrounding,\n  SoloTransition1,\n  SoloSenderSituation,\n  SoloSenderExperience,\n  SoloSenderInterpretation,\n  SoloSenderImpact,\n  SoloSenderSummary,\n  SoloReceiverValidation,\n  SoloSenderConfirmation,\n  SoloSenderClarification,\n  SoloReceiverExperience,\n  SoloSenderValidation,\n  SoloReceiverConfirmation,\n  SoloTransition2,\n  SoloSenderNeeds,\n  SoloReceiverResponse,\n  SoloTransition3,\n  SoloSenderClosing,\n  SoloReceiverClosing,\n  SoloThanks,\n  SoloFeedback,\n  SoloCompletion,\n];\n\nconst duoPageComponents = [\n  Welcome,\n  DuoRoles,\n  DuoWarnings,\n  DuoIntention,\n  DuoSenderGrounding,\n  DuoReceiverGrounding,\n  DuoTransition1,\n  DuoSenderSituation,\n  DuoSenderExperience,\n  DuoSenderInterpretation,\n  DuoSenderImpact,\n  DuoSenderSummary,\n  DuoReceiverValidation,\n  DuoSenderConfirmation,\n  DuoReceiverExperience,\n  DuoSenderValidation,\n  DuoReceiverConfirmation,\n  DuoTransition2,\n  DuoSenderNeeds,\n  DuoReceiverResponse,\n  DuoTransition3,\n  DuoSenderClosing,\n  DuoReceiverClosing,\n  DuoFeedback,\n  DuoCompletion,\n  DuoInversionPage7a,\n  DuoInversionPage8a,\n  DuoInversionPage9a,\n  DuoInversionPage10a,\n  DuoInversionPage11a,\n  DuoInversionPage12a,\n  DuoInversionPage13a,\n  DuoInversionPage14a,\n  DuoInversionPage15a,\n  DuoInversionPage16a,\n  DuoInversionPage17a,\n  DuoInversionPage18a,\n  DuoInversionPage19a,\n  DuoInversionPage20a,\n];\n\nfunction AccessGate({ children }: { children: React.ReactNode }) {\n  const { accessStatus } = useAccess();\n  const [location] = useLocation();\n\n  // Admin page is always accessible (has its own protection)\n  if (location === '/admin' || location === '/admin-login') {\n    return <>{children}</>;\n  }\n\n  // Allow access if user is logged in (admin/template auth)\n  const sessionToken = localStorage.getItem('session_token');\n  if (sessionToken) {\n    return <>{children}</>;\n  }\n\n  // Public pages\n  if (location === '/') {\n    return <>{children}</>;\n  }\n\n  // Show loading state\n  if (accessStatus === 'loading') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"w-16 h-16 mx-auto\">\n            <img\n              src=\"/logo-blue.png\"\n              alt=\"Logo\"\n              className=\"w-16 h-16 animate-pulse dark:hidden\"\n            />\n            <img\n              src=\"/logo-white.png\"\n              alt=\"Logo\"\n              className=\"w-16 h-16 animate-pulse hidden dark:block\"\n            />\n          </div>\n          <p className=\"text-muted-foreground\">Vérification de l'accès...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Show paywall if access denied\n  if (accessStatus === 'denied') {\n    return <PaywallScreen />;\n  }\n\n  // Show error if origin is invalid\n  if (accessStatus === 'origin_invalid') {\n    return (\n      <div className=\"min-h-screen bg-background flex items-center justify-center p-4\">\n        <div className=\"text-center space-y-4 max-w-md\">\n          <h1 className=\"text-xl font-semibold text-foreground\">Accès non autorisé</h1>\n          <p className=\"text-muted-foreground\">\n            Cette application est accessible uniquement depuis la communauté Avancer Simplement.\n          </p>\n          <a\n            href=\"https://communaute.avancersimplement.com\"\n            className=\"inline-block mt-4 px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors\"\n          >\n            Accéder à la communauté\n          </a>\n        </div>\n      </div>\n    );\n  }\n\n  // Access granted - show the app\n  return <>{children}</>;\n}\n\nfunction SessionRouter() {\n  const { session } = useSession();\n  const [location, setLocation] = useLocation();\n\n  // Get current flow configuration\n  const flow = getFlow(session.appType);\n\n  // Sync URL with current step (but don't redirect if on admin or template pages)\n  useEffect(() => {\n    // Skip redirection if user is on admin or template pages\n    if (location === '/admin' || location === '/admin-login' || location === '/' || location === '/user-home') {\n      return;\n    }\n\n    const currentPage = flow.pages[session.currentStep];\n    if (currentPage && location !== currentPage.path) {\n      // Only redirect if we are in a flow path (starts with /solo or /duo or is /welcome)\n      if (location.startsWith('/solo') || location.startsWith('/duo') || location === '/welcome') {\n        setLocation(currentPage.path);\n      }\n    }\n  }, [session.currentStep, session.appType, location, setLocation, flow.pages]);\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <GlobalHeader />\n      <AccessGate>\n        <Switch>\n          {/* Auth & Public Routes */}\n          <Route path=\"/\" component={AuthPage} />\n          <Route path=\"/user-home\">{() => { window.location.replace('/welcome'); return null; }}</Route>\n          <Route path=\"/admin-login\" component={AdminLogin} />\n\n          {/* Protected Routes */}\n          <Route path=\"/admin\" component={Dashboard} />\n\n          {/* Solo flow routes */}\n          {soloFlow.pages.map((page, index) => (\n            <Route key={`solo-${page.id}`} path={page.path}>\n              {React.createElement(soloPageComponents[index] || NotFound)}\n            </Route>\n          ))}\n\n          {/* Duo flow routes */}\n          {duoFlow.pages.map((page, index) => (\n            <Route key={`duo-${page.id}`} path={page.path}>\n              {React.createElement(duoPageComponents[index] || NotFound)}\n            </Route>\n          ))}\n\n          <Route component={NotFound} />\n        </Switch>\n      </AccessGate>\n    </div>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"system\">\n        <TooltipProvider>\n          <AccessProvider>\n            <SessionProvider>\n              <Toaster />\n              <SessionRouter />\n            </SessionProvider>\n          </AccessProvider>\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":10980,"size_tokens":null},"client/src/components/pin-login-form.tsx":{"content":"import { useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useMutation } from '@tanstack/react-query';\nimport { Lock, Eye, EyeOff, AlertTriangle } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { apiRequest } from '@/lib/queryClient';\n\nconst loginPinSchema = z.object({\n  pin: z.string()\n    .regex(/^\\d{4,6}$/, 'Le NIP doit contenir 4 à 6 chiffres'),\n});\n\ntype LoginPinFormData = z.infer<typeof loginPinSchema>;\n\ninterface PinLoginFormProps {\n  userEmail: string;\n  onSuccess: (sessionToken: string, userId: string, isAdmin?: boolean) => void;\n  onError: (message: string) => void;\n}\n\nexport function PinLoginForm({ userEmail, onSuccess, onError }: PinLoginFormProps) {\n  const [showPin, setShowPin] = useState(false);\n  const [rateLimitError, setRateLimitError] = useState(false);\n\n  const form = useForm<LoginPinFormData>({\n    resolver: zodResolver(loginPinSchema),\n    defaultValues: {\n      pin: '',\n    },\n  });\n\n  const validatePinMutation = useMutation({\n    mutationFn: async (data: LoginPinFormData) => {\n      const response = await apiRequest('POST', '/api/auth/validate-pin', {\n        email: userEmail,\n        pin: data.pin,\n      });\n      return await response.json();\n    },\n    onSuccess: (result) => {\n      setRateLimitError(false);\n      if (result.success) {\n        onSuccess(result.session_token, result.user_id, result.is_admin);\n      }\n    },\n    onError: (error: any) => {\n      if (error.message?.includes('429') || error.message?.includes('tentatives')) {\n        setRateLimitError(true);\n        onError('Trop de tentatives. Veuillez réessayer dans 15 minutes.');\n      } else {\n        onError(error.message || 'NIP incorrect');\n      }\n      form.reset();\n    },\n  });\n\n  const onSubmit = (data: LoginPinFormData) => {\n    setRateLimitError(false);\n    validatePinMutation.mutate(data);\n  };\n\n  return (\n    <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-pin-login\">\n      <CardHeader className=\"space-y-3 pb-6\">\n        <div className=\"flex items-center justify-center w-12 h-12 mx-auto rounded-full bg-primary/10\">\n          <Lock className=\"h-6 w-6 text-primary\" />\n        </div>\n        <CardTitle className=\"text-2xl font-semibold text-center\">\n          Bon retour !\n        </CardTitle>\n        <CardDescription className=\"text-center text-base\">\n          Entrez votre NIP pour accéder à l'application\n        </CardDescription>\n      </CardHeader>\n      \n      <CardContent>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          {rateLimitError && (\n            <Alert variant=\"destructive\" className=\"bg-destructive/10 border-destructive/20\" data-testid=\"alert-rate-limit\">\n              <AlertTriangle className=\"h-4 w-4\" />\n              <AlertDescription>\n                Trop de tentatives de connexion. Votre compte est temporairement verrouillé pour des raisons de sécurité. \n                Veuillez réessayer dans 15 minutes.\n              </AlertDescription>\n            </Alert>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"login-pin\" className=\"text-base font-medium\">\n              Votre NIP <span className=\"text-destructive\">*</span>\n            </Label>\n            <div className=\"relative\">\n              <Input\n                {...form.register('pin')}\n                id=\"login-pin\"\n                type={showPin ? 'text' : 'password'}\n                inputMode=\"numeric\"\n                maxLength={6}\n                placeholder=\"Entrez votre NIP\"\n                className=\"h-12 pr-10 text-base\"\n                disabled={validatePinMutation.isPending || rateLimitError}\n                autoFocus\n                data-testid=\"input-login-pin\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPin(!showPin)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors\"\n                disabled={rateLimitError}\n                data-testid=\"button-toggle-login-pin-visibility\"\n              >\n                {showPin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n              </button>\n            </div>\n            {form.formState.errors.pin && (\n              <p className=\"text-sm text-destructive\" data-testid=\"text-login-pin-error\">\n                {form.formState.errors.pin.message}\n              </p>\n            )}\n          </div>\n\n          <Button\n            type=\"submit\"\n            className=\"w-full h-12 text-base font-semibold\"\n            disabled={validatePinMutation.isPending || !form.formState.isValid || rateLimitError}\n            data-testid=\"button-validate-pin\"\n          >\n            {validatePinMutation.isPending ? 'Vérification...' : 'Se connecter'}\n          </Button>\n\n          <div className=\"text-center\">\n            <button\n              type=\"button\"\n              className=\"text-sm text-primary hover:underline\"\n              onClick={() => {\n                onError('Pour réinitialiser votre NIP, veuillez contacter le support.');\n              }}\n              data-testid=\"link-forgot-pin\"\n            >\n              NIP oublié ?\n            </button>\n          </div>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":5674,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport {\n  validateUserData,\n  generateSessionToken,\n  hashPin,\n  comparePin,\n  pinRateLimiter,\n  requireAuth,\n  type CircleUserData\n} from \"./middleware\";\nimport { corsMiddleware } from \"./app\";\nimport crypto from \"crypto\";\nimport {\n  validateCircleUserSchema,\n  createPinSchema,\n  validatePinSchema,\n  updateConfigSchema,\n  insertFeedbackSchema\n} from \"@shared/schema\";\n\n// Temporary cache for validated Circle.so data (5 minutes expiry)\ninterface ValidationCache {\n  email: string;\n  publicUid: string;\n  name: string;\n  isAdmin: boolean;\n  timestamp: number;\n}\nconst validationCache = new Map<string, ValidationCache>();\nconst VALIDATION_EXPIRY_MS = 5 * 60 * 1000; // 5 minutes\n\n// Cleanup expired validations every minute\nsetInterval(() => {\n  const now = Date.now();\n  Array.from(validationCache.entries()).forEach(([token, data]) => {\n    if (now - data.timestamp > VALIDATION_EXPIRY_MS) {\n      validationCache.delete(token);\n    }\n  });\n}, 60 * 1000);\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n\n  // Apply CORS to API routes and webhooks (webhooks called from Circle.so client-side scripts)\n  app.use('/api', corsMiddleware);\n  app.use('/webhooks', corsMiddleware);\n\n  // Feedback endpoint\n  app.post(\"/api/feedback\", async (req, res) => {\n    try {\n      const validatedFeedback = insertFeedbackSchema.parse(req.body);\n      const feedback = await storage.createFeedback(validatedFeedback);\n      res.json(feedback);\n    } catch (error: any) {\n      res.status(400).json({ error: error.message });\n    }\n  });\n\n  // Get all feedbacks - Admin only\n  app.get(\"/api/admin/feedbacks\", requireAuth, async (req, res) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: \"Accès réservé aux administrateurs\" });\n      }\n\n      const feedbacks = await storage.getAllFeedbacks();\n      res.json(feedbacks);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Get archived feedbacks - Admin only\n  app.get(\"/api/admin/feedbacks/archived\", requireAuth, async (req, res) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: \"Accès réservé aux administrateurs\" });\n      }\n\n      const feedbacks = await storage.getArchivedFeedbacks();\n      res.json(feedbacks);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Archive feedback - Admin only\n  app.patch(\"/api/admin/feedbacks/:id/archive\", requireAuth, async (req, res) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: \"Accès réservé aux administrateurs\" });\n      }\n\n      await storage.archiveFeedback(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Unarchive feedback - Admin only\n  app.patch(\"/api/admin/feedbacks/:id/unarchive\", requireAuth, async (req, res) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: \"Accès réservé aux administrateurs\" });\n      }\n\n      await storage.unarchiveFeedback(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // Delete feedback - Admin only\n  app.delete(\"/api/admin/feedbacks/:id\", requireAuth, async (req, res) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: \"Accès réservé aux administrateurs\" });\n      }\n\n      await storage.deleteFeedback(req.params.id);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // GET /api/health - Health check endpoint for debugging\n  app.get('/api/health', async (req: Request, res: Response) => {\n    try {\n      // Test database connection\n      const testUser = await storage.getUserByEmail('test@nonexistent.com');\n      const config = await storage.getAppConfig();\n      return res.json({\n        status: 'ok',\n        database: 'connected',\n        config: {\n          requireCircleDomain: config.requireCircleDomain,\n          requireCircleLogin: config.requireCircleLogin,\n          requirePaywall: config.requirePaywall,\n          requirePin: config.requirePin,\n        },\n        timestamp: new Date().toISOString()\n      });\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      return res.status(500).json({\n        status: 'error',\n        database: 'disconnected',\n        error: errorMessage\n      });\n    }\n  });\n\n  // GET /api/debug/admin-check - Check if admin user exists (for debugging production)\n  app.get('/api/debug/admin-check', async (req: Request, res: Response) => {\n    try {\n      const email = req.query.email as string;\n      if (!email) {\n        return res.status(400).json({ error: 'Email parameter required' });\n      }\n      \n      const user = await storage.getUserByEmail(email);\n      return res.json({\n        exists: !!user,\n        isAdmin: user?.isAdmin ?? null,\n        hasPin: !!user?.pinHash,\n        userId: user?.id ?? null,\n        environment: process.env.NODE_ENV || 'unknown',\n        devMode: process.env.DEV_MODE === 'true',\n      });\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      return res.status(500).json({ error: errorMessage });\n    }\n  });\n\n  // POST /api/debug/fix-admin - One-time fix to set admin status (secured with secret)\n  app.post('/api/debug/fix-admin', async (req: Request, res: Response) => {\n    try {\n      const { email, secret } = req.body;\n      \n      // Security: require the webhook secret to use this endpoint\n      const webhookSecret = process.env.WEBHOOK_SECRET;\n      if (!secret || secret !== webhookSecret) {\n        return res.status(401).json({ error: 'Invalid secret' });\n      }\n      \n      if (!email) {\n        return res.status(400).json({ error: 'Email required' });\n      }\n      \n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(404).json({ error: 'User not found' });\n      }\n      \n      // Update user to be admin\n      await storage.updateUserRole(user.id, true);\n      \n      return res.json({\n        success: true,\n        message: `User ${email} is now admin`,\n        userId: user.id,\n      });\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      return res.status(500).json({ error: errorMessage });\n    }\n  });\n\n  // POST /api/auth/validate - Validate Circle.so user data\n  app.post('/api/auth/validate', async (req: Request, res: Response) => {\n    try {\n      const { user } = req.body as { user: CircleUserData };\n\n      if (!user) {\n        return res.status(400).json({ error: 'Données utilisateur manquantes' });\n      }\n\n      // Get app configuration\n      const appConfig = await storage.getAppConfig();\n\n      // Use data as provided by the frontend\n      // Generate unique publicUid if not provided\n      const uniqueSuffix = crypto.randomBytes(4).toString('hex');\n      const userData = {\n        publicUid: user.publicUid || `circle_${uniqueSuffix}`,\n        email: user.email || 'dev@example.com',\n        name: user.name || 'Membre',\n        isAdmin: user.isAdmin !== undefined ? user.isAdmin : false,\n        timestamp: user.timestamp || Date.now(),\n      };\n\n      // Validate format and timestamp\n      const formatCheck = validateUserData(userData);\n      if (!formatCheck.valid) {\n        return res.status(400).json({ error: formatCheck.error });\n      }\n\n      // Check if user exists by email (email is the authoritative identifier)\n      const existingUser = await storage.getUserByEmail(userData.email);\n\n      if (!existingUser) {\n        // New user - email is unique, publicUid conflicts are handled by generating unique IDs\n        // Generate one-time validation token for new user\n        const validationToken = crypto.randomBytes(32).toString('hex');\n        validationCache.set(validationToken, {\n          email: userData.email,\n          publicUid: userData.publicUid,\n          name: userData.name || `User ${userData.publicUid}`,\n          isAdmin: userData.isAdmin || false,\n          timestamp: Date.now(),\n        });\n\n        // New member - needs to create PIN (or auto-register if PIN not required)\n        return res.json({\n          status: 'new_user',\n          user_id: userData.publicUid,\n          email: userData.email,\n          name: userData.name,\n          is_admin: userData.isAdmin || false,\n          validation_token: validationToken,\n          requires_pin: appConfig.requirePin,\n        });\n      }\n\n      // Existing user - if publicUid differs, update it (Circle.so may regenerate IDs)\n      // We trust the email as the primary identifier\n      if (existingUser.publicUid !== userData.publicUid) {\n        await storage.updateUserPublicUid(existingUser.id, userData.publicUid);\n      }\n\n      // Admin status: PRESERVE existing admin status from database\n      // Only upgrade to admin if Circle.so explicitly says isAdmin=true\n      // Never downgrade an existing admin (admins are set via database or dashboard)\n      const finalIsAdmin = existingUser.isAdmin || userData.isAdmin || false;\n\n      // If PIN is NOT required, auto-login the user\n      if (!appConfig.requirePin) {\n        await storage.updateUserLastLogin(existingUser.id);\n        await storage.logLoginAttempt({\n          userId: existingUser.id,\n          success: true,\n          ipAddress: req.ip || null,\n        });\n        const sessionToken = generateSessionToken(existingUser.id, existingUser.email);\n\n        return res.json({\n          status: 'auto_login',\n          user_id: existingUser.id,\n          is_admin: finalIsAdmin,\n          session_token: sessionToken,\n          requires_pin: false,\n        });\n      }\n\n      // Check if existing user has a PIN\n      if (!existingUser.pinHash) {\n        // Existing user WITHOUT PIN - needs to create one\n        // Generate validation token for PIN creation\n        const validationToken = crypto.randomBytes(32).toString('hex');\n        validationCache.set(validationToken, {\n          email: userData.email,\n          publicUid: userData.publicUid,\n          name: existingUser.name || userData.name || 'Membre',\n          isAdmin: finalIsAdmin,\n          timestamp: Date.now(),\n        });\n\n        return res.json({\n          status: 'missing_pin',\n          user_id: userData.publicUid,\n          db_user_id: existingUser.id,\n          email: userData.email,\n          name: existingUser.name || userData.name,\n          is_admin: finalIsAdmin,\n          validation_token: validationToken,\n          requires_pin: true,\n        });\n      }\n\n      // Existing member with PIN - needs to enter PIN\n      return res.json({\n        status: 'existing_user',\n        user_id: existingUser.id,\n        is_admin: finalIsAdmin,\n        requires_pin: true,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/validate:', error);\n      const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n      console.error('Error details:', errorMessage);\n      return res.status(500).json({\n        error: 'Erreur serveur lors de la validation',\n        details: process.env.DEV_MODE === 'true' ? errorMessage : undefined\n      });\n    }\n  });\n\n  // POST /api/auth/create-pin - Create PIN for new user (REQUIRES validation token)\n  app.post('/api/auth/create-pin', async (req: Request, res: Response) => {\n    try {\n      const { email, public_uid, name, pin, validation_token } = req.body;\n\n      // Validate input\n      if (!email || !public_uid || !name || !pin || !validation_token) {\n        return res.status(400).json({ error: 'Données manquantes' });\n      }\n\n      // SERVER-SIDE PAYWALL CHECK: Prevent bypassing paywall via direct API calls\n      const appConfig = await storage.getAppConfig();\n      if (appConfig.requirePaywall && email) {\n        const paidMember = await storage.getPaidMemberByEmail(email.toLowerCase());\n        if (!paidMember) {\n          console.log(`[AUTH] Paywall block on create-pin for: ${email}`);\n          return res.status(403).json({\n            error: 'Accès réservé aux membres payants',\n            paywall_blocked: true\n          });\n        }\n      }\n\n      // CRITICAL: Verify validation token to prevent unauthorized account creation\n      const cachedData = validationCache.get(validation_token);\n      if (!cachedData) {\n        return res.status(403).json({\n          error: 'Token de validation invalide ou expiré. Veuillez recommencer l\\'authentification.'\n        });\n      }\n\n      // Verify the data matches the cached validation\n      if (cachedData.email !== email || cachedData.publicUid !== public_uid) {\n        validationCache.delete(validation_token); // Clean up invalid attempt\n        return res.status(403).json({\n          error: 'Les données ne correspondent pas à la validation Circle.so'\n        });\n      }\n\n      // Check if validation is still fresh (not expired)\n      if (Date.now() - cachedData.timestamp > VALIDATION_EXPIRY_MS) {\n        validationCache.delete(validation_token);\n        return res.status(403).json({\n          error: 'Token de validation expiré. Veuillez recommencer l\\'authentification.'\n        });\n      }\n\n      // Delete token (one-time use)\n      validationCache.delete(validation_token);\n\n      // Validate PIN format (4-6 digits)\n      if (!/^\\d{4,6}$/.test(pin)) {\n        return res.status(400).json({\n          error: 'Le NIP doit contenir 4 à 6 chiffres'\n        });\n      }\n\n      // Hash the PIN\n      const pinHash = await hashPin(pin);\n\n      // Check if user already exists (may be updating PIN for existing user without one)\n      const existingUser = await storage.getUserByEmail(email);\n      let user;\n      \n      if (existingUser) {\n        // Existing user without PIN - update their PIN\n        if (existingUser.pinHash) {\n          return res.status(400).json({\n            error: 'Un NIP existe déjà pour ce compte. Utilisez la connexion normale.'\n          });\n        }\n        // Update existing user with new PIN\n        await storage.updateUserPin(existingUser.id, pinHash);\n        user = { ...existingUser, pinHash, isAdmin: cachedData.isAdmin };\n      } else {\n        // Create new user with PIN\n        user = await storage.createUser({\n          email,\n          publicUid: public_uid,\n          name,\n          pinHash,\n          isAdmin: cachedData.isAdmin,\n        });\n      }\n\n      // Update last login\n      await storage.updateUserLastLogin(user.id);\n\n      // Log successful login attempt\n      await storage.logLoginAttempt({\n        userId: user.id,\n        success: true,\n        ipAddress: req.ip || null,\n      });\n\n      // Generate session token\n      const sessionToken = generateSessionToken(user.id, user.email);\n\n      return res.json({\n        success: true,\n        session_token: sessionToken,\n        user_id: user.id,\n        is_admin: user.isAdmin,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/create-pin:', error);\n      return res.status(500).json({ error: 'Erreur lors de la création du NIP' });\n    }\n  });\n\n  // POST /api/auth/create-user-no-pin - Create user without PIN (when PIN is not required)\n  app.post('/api/auth/create-user-no-pin', async (req: Request, res: Response) => {\n    try {\n      const { email, public_uid, name, validation_token } = req.body;\n\n      // Check if PIN is required\n      const appConfig = await storage.getAppConfig();\n      if (appConfig.requirePin) {\n        return res.status(403).json({ error: 'Le NIP est requis pour créer un compte' });\n      }\n\n      // SERVER-SIDE PAYWALL CHECK: Prevent bypassing paywall via direct API calls\n      if (appConfig.requirePaywall && email) {\n        const paidMember = await storage.getPaidMemberByEmail(email.toLowerCase());\n        if (!paidMember) {\n          console.log(`[AUTH] Paywall block on create-user-no-pin for: ${email}`);\n          return res.status(403).json({\n            error: 'Accès réservé aux membres payants',\n            paywall_blocked: true\n          });\n        }\n      }\n\n      // Validate input\n      if (!email || !public_uid || !name || !validation_token) {\n        return res.status(400).json({ error: 'Données manquantes' });\n      }\n\n      // Verify validation token\n      const cachedData = validationCache.get(validation_token);\n      if (!cachedData) {\n        return res.status(403).json({\n          error: 'Token de validation invalide ou expiré. Veuillez recommencer l\\'authentification.'\n        });\n      }\n\n      // Verify the data matches\n      if (cachedData.email !== email || cachedData.publicUid !== public_uid) {\n        validationCache.delete(validation_token);\n        return res.status(403).json({\n          error: 'Les données ne correspondent pas à la validation Circle.so'\n        });\n      }\n\n      // Check expiration\n      if (Date.now() - cachedData.timestamp > VALIDATION_EXPIRY_MS) {\n        validationCache.delete(validation_token);\n        return res.status(403).json({\n          error: 'Token de validation expiré. Veuillez recommencer l\\'authentification.'\n        });\n      }\n\n      validationCache.delete(validation_token);\n\n      // Check if user exists\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        // User exists - just log them in (PIN not required)\n        await storage.updateUserLastLogin(existingUser.id);\n        await storage.logLoginAttempt({\n          userId: existingUser.id,\n          success: true,\n          ipAddress: req.ip || null,\n        });\n        const sessionToken = generateSessionToken(existingUser.id, existingUser.email);\n        return res.json({\n          success: true,\n          session_token: sessionToken,\n          user_id: existingUser.id,\n          is_admin: existingUser.isAdmin,\n        });\n      }\n\n      // Create user WITHOUT pinHash (they can create one later if layer 4 is enabled)\n      const user = await storage.createUser({\n        email,\n        publicUid: public_uid,\n        name,\n        pinHash: null,\n        isAdmin: cachedData.isAdmin,\n      });\n\n      await storage.updateUserLastLogin(user.id);\n      await storage.logLoginAttempt({\n        userId: user.id,\n        success: true,\n        ipAddress: req.ip || null,\n      });\n\n      const sessionToken = generateSessionToken(user.id, user.email);\n\n      return res.json({\n        success: true,\n        session_token: sessionToken,\n        user_id: user.id,\n        is_admin: user.isAdmin,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/create-user-no-pin:', error);\n      return res.status(500).json({ error: 'Erreur lors de la création du compte' });\n    }\n  });\n\n  // POST /api/auth/validate-pin - Validate PIN for existing user (rate limited)\n  app.post('/api/auth/validate-pin', pinRateLimiter, async (req: Request, res: Response) => {\n    try {\n      const { email, pin } = req.body;\n\n      // Validate input\n      if (!email || !pin) {\n        return res.status(400).json({ error: 'Email et NIP requis' });\n      }\n\n      // SERVER-SIDE PAYWALL CHECK: Prevent bypassing paywall via direct API calls\n      const appConfig = await storage.getAppConfig();\n      if (appConfig.requirePaywall && email) {\n        const paidMember = await storage.getPaidMemberByEmail(email.toLowerCase());\n        if (!paidMember) {\n          console.log(`[AUTH] Paywall block on validate-pin for: ${email}`);\n          return res.status(403).json({\n            error: 'Accès réservé aux membres payants',\n            paywall_blocked: true\n          });\n        }\n      }\n\n      // Get user\n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        // Log failed attempt for non-existent user\n        await storage.logLoginAttempt({\n          userId: null,\n          success: false,\n          ipAddress: req.ip || null,\n        });\n        return res.status(404).json({ error: 'Utilisateur introuvable' });\n      }\n\n      // Check if user has a PIN\n      if (!user.pinHash) {\n        return res.status(400).json({ error: 'Aucun NIP configuré pour ce compte. Veuillez en créer un.' });\n      }\n\n      // Compare PIN\n      const isValidPin = await comparePin(pin, user.pinHash);\n\n      if (!isValidPin) {\n        // Log failed attempt\n        await storage.logLoginAttempt({\n          userId: user.id,\n          success: false,\n          ipAddress: req.ip || null,\n        });\n\n        return res.status(401).json({ error: 'NIP incorrect' });\n      }\n\n      // Update last login\n      await storage.updateUserLastLogin(user.id);\n\n      // Log successful attempt\n      await storage.logLoginAttempt({\n        userId: user.id,\n        success: true,\n        ipAddress: req.ip || null,\n      });\n\n      // Generate session token\n      const sessionToken = generateSessionToken(user.id, user.email);\n\n      return res.json({\n        success: true,\n        session_token: sessionToken,\n        user_id: user.id,\n        name: user.name,\n        is_admin: user.isAdmin,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/validate-pin:', error);\n      return res.status(500).json({ error: 'Erreur lors de la validation du NIP' });\n    }\n  });\n\n  // POST /api/auth/admin-login - Admin login with email + PIN (bypass Circle.so)\n  // Security: Always requires admin status - this is for admins to access dashboard\n  app.post('/api/auth/admin-login', pinRateLimiter, async (req: Request, res: Response) => {\n    try {\n      const { email, pin } = req.body;\n\n      // Validate input\n      if (!email || !pin) {\n        return res.status(400).json({ error: 'Email et NIP requis' });\n      }\n\n      // Get user by email\n      const user = await storage.getUserByEmail(email);\n      console.log('[ADMIN-LOGIN] User lookup result:', { \n        email, \n        found: !!user, \n        userId: user?.id,\n        isAdmin: user?.isAdmin,\n        isAdminType: typeof user?.isAdmin\n      });\n      \n      if (!user) {\n        await storage.logLoginAttempt({\n          userId: null,\n          success: false,\n          ipAddress: req.ip || null,\n        });\n        return res.status(404).json({ error: 'Utilisateur introuvable' });\n      }\n\n      // Security check: Only admins can use this endpoint\n      if (!user.isAdmin) {\n        await storage.logLoginAttempt({\n          userId: user.id,\n          success: false,\n          ipAddress: req.ip || null,\n        });\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      // Check if user has a PIN\n      if (!user.pinHash) {\n        return res.status(400).json({ error: 'Aucun NIP configuré pour ce compte admin.' });\n      }\n\n      // Verify PIN\n      const isValidPin = await comparePin(pin, user.pinHash);\n      if (!isValidPin) {\n        await storage.logLoginAttempt({\n          userId: user.id,\n          success: false,\n          ipAddress: req.ip || null,\n        });\n        return res.status(401).json({ error: 'NIP incorrect' });\n      }\n\n      // Update last login\n      await storage.updateUserLastLogin(user.id);\n\n      // Log successful attempt\n      await storage.logLoginAttempt({\n        userId: user.id,\n        success: true,\n        ipAddress: req.ip || null,\n      });\n\n      // Generate session token\n      const sessionToken = generateSessionToken(user.id, user.email);\n\n      return res.json({\n        success: true,\n        session_token: sessionToken,\n        user_id: user.id,\n        name: user.name,\n        is_admin: user.isAdmin,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/admin-login:', error);\n      return res.status(500).json({ error: 'Erreur lors de la connexion admin' });\n    }\n  });\n\n  // GET /api/auth/me - Get current user info (protected route example)\n  app.get('/api/auth/me', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user) {\n        return res.status(404).json({ error: 'Utilisateur introuvable' });\n      }\n\n      // Return user info without sensitive data\n      return res.json({\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        publicUid: user.publicUid,\n        isAdmin: user.isAdmin,\n        lastLogin: user.lastLogin,\n        createdAt: user.createdAt,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/me:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // GET /api/config - Get app configuration (public)\n  app.get('/api/config', async (req: Request, res: Response) => {\n    try {\n      const config = await storage.getAppConfig();\n      // isPublicMode: true ONLY when ALL 4 layers are disabled\n      const isPublicMode = !config.requireCircleDomain && !config.requireCircleLogin && !config.requirePaywall && !config.requirePin;\n      return res.json({\n        requireCircleDomain: config.requireCircleDomain,\n        requireCircleLogin: config.requireCircleLogin,\n        requirePaywall: config.requirePaywall,\n        requirePin: config.requirePin,\n        paywallPurchaseUrl: config.paywallPurchaseUrl,\n        paywallInfoUrl: config.paywallInfoUrl,\n        paywallTitle: config.paywallTitle,\n        paywallMessage: config.paywallMessage,\n        environment: config.environment,\n        isPublicMode,\n      });\n    } catch (error) {\n      console.error('Error in GET /api/config:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // GET /api/settings - Alias for /api/config to support migrated AccessContext\n  app.get('/api/settings', async (req: Request, res: Response) => {\n    try {\n      const config = await storage.getAppConfig();\n      return res.json({\n        environment: config.environment,\n        circleOnlyMode: config.requireCircleDomain, // Map requireCircleDomain to circleOnlyMode\n      });\n    } catch (error) {\n      console.error('Error in GET /api/settings:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // POST /api/check-access - Check access for migrated AccessContext\n  app.post('/api/check-access', async (req: Request, res: Response) => {\n    try {\n      const { email } = req.body;\n      const config = await storage.getAppConfig();\n\n      // If in development mode, grant access (unless specific restrictions apply)\n      if (config.environment === 'development') {\n        return res.json({\n          hasAccess: true,\n          mode: 'development'\n        });\n      }\n\n      // In production, check requirements\n\n      // 1. Check Paywall if enabled\n      if (config.requirePaywall) {\n        if (!email) {\n          return res.json({ hasAccess: false, mode: 'production', reason: 'email_required_for_paywall' });\n        }\n        const paidMember = await storage.getPaidMemberByEmail(email);\n        if (!paidMember) {\n          return res.json({ hasAccess: false, mode: 'production', reason: 'paywall' });\n        }\n      }\n\n      // 2. Check Circle Domain if enabled (handled by client mostly, but we can validate email domain if needed)\n      // For now, we assume client validation for origin, and here we just check if email is present if login is required\n      if (config.requireCircleLogin && !email) {\n        return res.json({ hasAccess: false, mode: 'production', reason: 'login_required' });\n      }\n\n      // If all checks pass\n      return res.json({\n        hasAccess: true,\n        mode: 'production'\n      });\n\n    } catch (error) {\n      console.error('Error in POST /api/check-access:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // PATCH /api/config - Update app configuration (admin only)\n  app.patch('/api/config', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      const {\n        requireCircleDomain,\n        requireCircleLogin,\n        requirePaywall,\n        requirePin,\n        paywallPurchaseUrl,\n        paywallInfoUrl,\n        paywallTitle,\n        paywallMessage,\n        environment,\n      } = req.body;\n\n\n\n      const updateData: Partial<any> = {};\n\n      console.log('[PATCH /api/config] Received body:', req.body);\n\n      if (requireCircleDomain !== undefined) updateData.requireCircleDomain = requireCircleDomain;\n      if (requireCircleLogin !== undefined) updateData.requireCircleLogin = requireCircleLogin;\n      if (requirePaywall !== undefined) updateData.requirePaywall = requirePaywall;\n      if (requirePin !== undefined) updateData.requirePin = requirePin;\n      if (paywallPurchaseUrl !== undefined) updateData.paywallPurchaseUrl = paywallPurchaseUrl;\n      if (paywallInfoUrl !== undefined) updateData.paywallInfoUrl = paywallInfoUrl;\n      if (paywallTitle !== undefined) updateData.paywallTitle = paywallTitle;\n      if (paywallMessage !== undefined) updateData.paywallMessage = paywallMessage;\n      if (environment !== undefined) updateData.environment = environment;\n\n      console.log('[PATCH /api/config] Constructed updateData:', updateData);\n\n      const updatedConfig = await storage.updateAppConfig(updateData);\n\n      console.log('[PATCH /api/config] Updated config from storage:', updatedConfig);\n\n      return res.json({\n        success: true,\n        requireCircleDomain: updatedConfig.requireCircleDomain,\n        requireCircleLogin: updatedConfig.requireCircleLogin,\n        requirePaywall: updatedConfig.requirePaywall,\n        requirePin: updatedConfig.requirePin,\n        paywallPurchaseUrl: updatedConfig.paywallPurchaseUrl,\n        paywallInfoUrl: updatedConfig.paywallInfoUrl,\n        paywallTitle: updatedConfig.paywallTitle,\n        paywallMessage: updatedConfig.paywallMessage,\n        environment: updatedConfig.environment,\n      });\n    } catch (error) {\n      console.error('Error in PATCH /api/config:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // POST /api/auth/check-paywall - Check if user has paid (requires email from Circle.so login)\n  app.post('/api/auth/check-paywall', async (req: Request, res: Response) => {\n    try {\n      const { email } = req.body;\n      const config = await storage.getAppConfig();\n\n      console.log(`[PAYWALL CHECK] Email: \"${email}\", requirePaywall: ${config.requirePaywall}`);\n\n      // If paywall is disabled, grant access\n      if (!config.requirePaywall) {\n        console.log(`[PAYWALL CHECK] Paywall disabled - granting access`);\n        return res.json({ hasAccess: true, paywallEnabled: false });\n      }\n\n      // Paywall enabled - check if user has paid\n      if (!email) {\n        console.log(`[PAYWALL CHECK] No email provided - blocking access`);\n        return res.json({\n          hasAccess: false,\n          paywallEnabled: true,\n          paywallTitle: config.paywallTitle,\n          paywallMessage: config.paywallMessage,\n          paywallPurchaseUrl: config.paywallPurchaseUrl,\n          paywallInfoUrl: config.paywallInfoUrl,\n        });\n      }\n\n      const normalizedEmail = email.toLowerCase().trim();\n      const paidMember = await storage.getPaidMemberByEmail(normalizedEmail);\n      console.log(`[PAYWALL CHECK] Checking: \"${normalizedEmail}\", found: ${paidMember ? 'YES - ' + paidMember.email : 'NO'}`);\n\n      if (paidMember) {\n        console.log(`[PAYWALL CHECK] Access GRANTED for ${normalizedEmail}`);\n        return res.json({ hasAccess: true, paywallEnabled: true });\n      }\n\n      // User has not paid\n      return res.json({\n        hasAccess: false,\n        paywallEnabled: true,\n        paywallTitle: config.paywallTitle,\n        paywallMessage: config.paywallMessage,\n        paywallPurchaseUrl: config.paywallPurchaseUrl,\n        paywallInfoUrl: config.paywallInfoUrl,\n      });\n\n    } catch (error) {\n      console.error('Error in /api/auth/check-paywall:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // POST /webhooks/circle-payment - Receive payment notifications from Circle.so\n  // This endpoint is called by Circle.so when a payment is completed\n  // Security: Requires X-Webhook-Secret header matching WEBHOOK_SECRET env var\n  app.post('/webhooks/circle-payment', async (req: Request, res: Response) => {\n    try {\n      const webhookSecret = process.env.WEBHOOK_SECRET;\n      const providedSecret = req.headers['x-webhook-secret'] as string;\n\n      // Log webhook attempt (for debugging)\n      console.log(`[WEBHOOK] Payment webhook called from ${req.ip} at ${new Date().toISOString()}`);\n\n      // Validate webhook secret\n      if (!webhookSecret) {\n        console.error('[WEBHOOK] WEBHOOK_SECRET not configured');\n        return res.status(500).json({ error: 'Webhook not configured' });\n      }\n\n      if (!providedSecret || providedSecret !== webhookSecret) {\n        console.warn(`[WEBHOOK] Invalid secret attempt from ${req.ip}`);\n        return res.status(401).json({ error: 'Non autorisé - secret invalide' });\n      }\n\n      const { event, user, payment } = req.body;\n\n      // Validate event type\n      if (event !== 'payment_received') {\n        console.log(`[WEBHOOK] Unsupported event type: ${event}`);\n        return res.status(400).json({ error: 'Type d\\'événement non supporté' });\n      }\n\n      // Validate email\n      if (!user?.email) {\n        console.log('[WEBHOOK] Missing email in payload');\n        return res.status(400).json({ error: 'Email requis' });\n      }\n\n      const email = user.email.toLowerCase();\n\n      // Check if already registered\n      const existingMember = await storage.getPaidMemberByEmail(email);\n      if (existingMember) {\n        console.log(`[WEBHOOK] Member already registered: ${email}`);\n        return res.json({\n          success: true,\n          message: 'Membre déjà enregistré',\n          email,\n        });\n      }\n\n      // Register new paid member\n      const newMember = await storage.createPaidMember({\n        email,\n        paymentPlan: payment?.paywall_display_name || null,\n        amountPaid: payment?.amount_paid || null,\n        couponUsed: payment?.coupon_code || null,\n      });\n\n      console.log(`[WEBHOOK] New paid member registered: ${email}, plan: ${payment?.paywall_display_name || 'N/A'}`);\n\n      return res.json({\n        success: true,\n        message: 'Accès activé',\n        email: newMember.email,\n        paymentDate: newMember.paymentDate,\n      });\n\n    } catch (error) {\n      console.error('[WEBHOOK] Error processing payment:', error);\n      return res.status(500).json({ error: 'Erreur lors de l\\'enregistrement du paiement' });\n    }\n  });\n\n  // GET /api/admin/paid-members - List all paid members (admin only)\n  app.get('/api/admin/paid-members', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      const paidMembers = await storage.getAllPaidMembers();\n      return res.json({ members: paidMembers });\n\n    } catch (error) {\n      console.error('Error in GET /api/admin/paid-members:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // POST /api/admin/paid-members - Manually add a paid member (admin only)\n  app.post('/api/admin/paid-members', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      const { email } = req.body;\n      if (!email || typeof email !== 'string') {\n        return res.status(400).json({ error: 'Email requis' });\n      }\n\n      const normalizedEmail = email.toLowerCase().trim();\n\n      // Check if already exists\n      const existing = await storage.getPaidMemberByEmail(normalizedEmail);\n      if (existing) {\n        return res.status(400).json({ error: 'Ce membre est déjà enregistré' });\n      }\n\n      const newMember = await storage.createPaidMember({\n        email: normalizedEmail,\n        paymentPlan: 'Manual',\n        amountPaid: null,\n        couponUsed: null,\n      });\n\n      console.log(`[ADMIN] Paid member manually added: ${normalizedEmail} by ${user.email}`);\n\n      return res.json({ success: true, member: newMember });\n\n    } catch (error) {\n      console.error('Error in POST /api/admin/paid-members:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // DELETE /api/admin/paid-members/:email - Remove a paid member (admin only)\n  app.delete('/api/admin/paid-members/:email', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const user = await storage.getUser(userId);\n\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      const { email } = req.params;\n      await storage.deletePaidMember(email);\n\n      return res.json({ success: true, message: 'Membre supprimé' });\n\n    } catch (error) {\n      console.error('Error in DELETE /api/admin/paid-members:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // DELETE /api/admin/delete-user/:email - Delete user and all their data (admin only)\n  app.delete('/api/admin/delete-user/:email', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const adminUser = await storage.getUser(userId);\n\n      if (!adminUser || !adminUser.isAdmin) {\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      const { email } = req.params;\n      const normalizedEmail = email.toLowerCase().trim();\n      \n      // Prevent deleting yourself\n      if (normalizedEmail === adminUser.email?.toLowerCase()) {\n        return res.status(400).json({ error: 'Vous ne pouvez pas supprimer votre propre compte' });\n      }\n\n      const targetUser = await storage.getUserByEmail(normalizedEmail);\n\n      if (!targetUser) {\n        return res.status(404).json({ error: 'Utilisateur introuvable' });\n      }\n\n      // Also delete from paid members if exists\n      await storage.deletePaidMember(normalizedEmail);\n      \n      // Delete the user and all their data\n      await storage.deleteUser(targetUser.id);\n\n      console.log(`[ADMIN] User completely deleted: ${normalizedEmail} by admin: ${adminUser.email} at ${new Date().toISOString()}`);\n\n      return res.json({ \n        success: true, \n        message: `Utilisateur ${normalizedEmail} et toutes ses données ont été supprimés.` \n      });\n\n    } catch (error) {\n      console.error('Error in DELETE /api/admin/delete-user:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  // POST /api/admin/reset-user-pin - Reset a user's PIN (admin only)\n  app.post('/api/admin/reset-user-pin', requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { userId } = (req as any).user;\n      const adminUser = await storage.getUser(userId);\n\n      if (!adminUser || !adminUser.isAdmin) {\n        return res.status(403).json({ error: 'Accès réservé aux administrateurs' });\n      }\n\n      const { email } = req.body;\n      if (!email || typeof email !== 'string') {\n        return res.status(400).json({ error: 'Email requis' });\n      }\n\n      const normalizedEmail = email.toLowerCase().trim();\n      const targetUser = await storage.getUserByEmail(normalizedEmail);\n\n      if (!targetUser) {\n        return res.status(404).json({ error: 'Utilisateur introuvable' });\n      }\n\n      // Reset the PIN to null\n      await storage.updateUserPin(targetUser.id, null);\n\n      // Audit log\n      console.log(`[ADMIN] PIN reset for user: ${normalizedEmail} by admin: ${adminUser.email} at ${new Date().toISOString()}`);\n\n      return res.json({ \n        success: true, \n        message: `NIP réinitialisé pour ${normalizedEmail}. L'utilisateur devra en créer un nouveau.` \n      });\n\n    } catch (error) {\n      console.error('Error in POST /api/admin/reset-user-pin:', error);\n      return res.status(500).json({ error: 'Erreur serveur' });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":41466,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/dev-mode-indicator.tsx":{"content":"import { Code2 } from 'lucide-react';\nimport { Badge } from '@/components/ui/badge';\n\nexport function DevModeIndicator() {\n  const devMode = import.meta.env.VITE_DEV_MODE === 'true';\n\n  if (!devMode) return null;\n\n  return (\n    <div className=\"fixed bottom-4 left-1/2 -translate-x-1/2 z-50\" data-testid=\"badge-dev-mode\">\n      <Badge \n        variant=\"default\" \n        className=\"bg-warning text-warning-foreground hover:bg-warning shadow-lg px-3 py-1.5 text-xs font-semibold uppercase tracking-wide\"\n      >\n        <Code2 className=\"h-3 w-3 mr-1.5\" />\n        Mode Développement\n      </Badge>\n    </div>\n  );\n}\n","path":null,"size_bytes":617,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n  --background: 215 16% 95%;\n  --foreground: 0 0% 0%;\n  --border: 215 14% 85%;\n  --card: 0 0% 100%;\n  --card-foreground: 0 0% 0%;\n  --card-border: 215 14% 88%;\n  --sidebar: 0 0% 100%;\n  --sidebar-foreground: 213 18% 37%;\n  --sidebar-border: 0 0% 94%;\n  --sidebar-primary: 213 90% 29%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 0 0% 94%;\n  --sidebar-accent-foreground: 213 18% 37%;\n  --sidebar-ring: 213 90% 29%;\n  --popover: 0 0% 94%;\n  --popover-foreground: 0 0% 0%;\n  --popover-border: 0 0% 91%;\n  --primary: 213 90% 29%;\n  --primary-foreground: 0 0% 100%;\n  --secondary: 0 0% 90%;\n  --secondary-foreground: 0 0% 0%;\n  --muted: 0 0% 94%;\n  --muted-foreground: 213 8% 33%;\n  --accent: 0 0% 94%;\n  --accent-foreground: 0 0% 0%;\n  --destructive: 4 90% 43%;\n  --destructive-foreground: 0 0% 100%;\n  --success: 142 76% 33%;\n  --success-foreground: 0 0% 100%;\n  --warning: 38 100% 50%;\n  --warning-foreground: 0 0% 0%;\n  --input: 0 0% 75%;\n  --ring: 213 90% 29%;\n  --chart-1: 213 90% 45%;\n  --chart-2: 173 58% 39%;\n  --chart-3: 43 74% 49%;\n  --chart-4: 27 87% 47%;\n  --chart-5: 280 65% 47%;\n  --font-sans: Inter, system-ui, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n  --background: 215 16% 17%;\n  --foreground: 210 17% 92%;\n  --border: 215 14% 26%;\n  --card: 215 16% 17%;\n  --card-foreground: 210 17% 92%;\n  --card-border: 215 14% 26%;\n  --sidebar: 215 16% 17%;\n  --sidebar-foreground: 210 17% 92%;\n  --sidebar-border: 215 14% 26%;\n  --sidebar-primary: 211 100% 60%;\n  --sidebar-primary-foreground: 215 16% 13%;\n  --sidebar-accent: 215 14% 26%;\n  --sidebar-accent-foreground: 0 0% 100%;\n  --sidebar-ring: 211 100% 60%;\n  --popover: 215 20% 20%;\n  --popover-foreground: 210 17% 92%;\n  --popover-border: 215 14% 26%;\n  --primary: 211 100% 60%;\n  --primary-foreground: 215 16% 13%;\n  --secondary: 215 14% 26%;\n  --secondary-foreground: 210 17% 92%;\n  --muted: 215 14% 26%;\n  --muted-foreground: 210 10% 65%;\n  --accent: 215 14% 26%;\n  --accent-foreground: 210 17% 92%;\n  --destructive: 4 90% 43%;\n  --destructive-foreground: 0 0% 100%;\n  --success: 142 76% 33%;\n  --success-foreground: 0 0% 100%;\n  --warning: 38 100% 50%;\n  --warning-foreground: 0 0% 0%;\n  --input: 215 14% 30%;\n  --ring: 211 100% 60%;\n  --chart-1: 211 100% 70%;\n  --chart-2: 173 58% 65%;\n  --chart-3: 43 74% 70%;\n  --chart-4: 27 87% 68%;\n  --chart-5: 280 65% 70%;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);\n\n/* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}\n","path":null,"size_bytes":10868,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines - Circle.so Authentication Webapp\n\n## Design Approach\n**Selected System**: Material Design 3 with security-focused minimalism\n**Rationale**: Authentication interfaces require clarity, trust, and accessibility. Material Design provides proven patterns for forms, validation states, and progressive disclosure while maintaining a professional, trustworthy appearance in iframe contexts.\n\n## Core Design Principles\n- **Trust through simplicity**: Clean, uncluttered interface builds user confidence\n- **Immediate feedback**: Clear validation states reduce user anxiety\n- **Progressive disclosure**: Show only what's needed at each authentication stage\n- **Iframe-optimized**: Compact layouts that work within constrained embedding contexts\n\n## Typography\n\n**Font Family**: Inter (via Google Fonts CDN)\n- Primary: Inter (400, 500, 600 weights)\n\n**Hierarchy**:\n- Page titles/headers: text-2xl font-semibold (24px)\n- Section labels: text-sm font-medium uppercase tracking-wide (14px)\n- Form labels: text-base font-medium (16px)\n- Input text: text-base (16px)\n- Helper text: text-sm (14px)\n- Error messages: text-sm font-medium (14px)\n\n## Layout System\n\n**Spacing Primitives**: Tailwind units of 2, 4, 6, 8, 12, 16\n- Component padding: p-6 to p-8\n- Form field spacing: gap-6\n- Button spacing: px-6 py-3\n- Section margins: mb-8 to mb-12\n- Container max-width: max-w-md (centered for forms)\n\n**Grid**: Single column layouts for authentication flows\n\n## Component Library\n\n### Authentication Container\n- Centered card layout with subtle shadow (shadow-lg)\n- White background with rounded corners (rounded-lg)\n- Max width 448px (max-w-md)\n- Padding: p-8\n- Responsive: Full width on mobile with px-4\n\n### Form Elements\n\n**Input Fields**:\n- Border: 2px solid with focus ring\n- Height: h-12\n- Padding: px-4\n- Rounded: rounded-md\n- Font size: text-base\n- Full width: w-full\n- Clear focus states with ring offset\n\n**PIN Input** (specific design):\n- Numeric keypad-style or individual digit boxes\n- Large, monospaced characters for clarity\n- Pattern: 4-6 individual boxes or single masked input\n- Auto-focus progression between digits\n\n**Labels**:\n- Positioned above inputs\n- Font: text-base font-medium\n- Margin: mb-2\n- Required indicator: * in error red\n\n**Buttons**:\n- Primary CTA: Full width (w-full), height h-12\n- Font: text-base font-semibold\n- Rounded: rounded-md\n- Loading state: Disabled appearance + spinner\n\n### Validation States\n\n**Success**:\n- Green accent (border-green-500)\n- Checkmark icon (Heroicons)\n- Success message: text-green-700\n\n**Error**:\n- Red accent (border-red-500)\n- X icon or alert triangle (Heroicons)\n- Error message: text-red-700 with bg-red-50 background (p-3 rounded)\n\n**Loading**:\n- Subtle spinner animation\n- Disabled button state\n- Reduced opacity on form (opacity-60)\n\n### Messaging Components\n\n**Welcome Banner** (new users):\n- Light background panel\n- User name prominently displayed (text-xl font-semibold)\n- Clear instruction text\n- Icon: User circle or welcome icon\n\n**Rate Limit Warning**:\n- Yellow/amber alert box (bg-amber-50 border-amber-200)\n- Warning icon\n- Countdown timer display\n- Clear explanation text\n\n**Session Timeout Notice**:\n- Slide-in notification (top or bottom)\n- Countdown display\n- \"Extend session\" action button\n\n## Dev Mode Indicator\n- Floating badge (top-right corner)\n- Bright yellow/orange background\n- Text: \"DEV MODE\" with code icon\n- Small: text-xs px-3 py-1\n- Position: Fixed top-4 right-4\n\n## Icons\n**Library**: Heroicons (via CDN) - outline style for clarity\n- Lock icon (authentication)\n- User circle (profile)\n- Check circle (success)\n- X circle (error)\n- Exclamation triangle (warning)\n- Clock (session timeout)\n- Code bracket (dev mode)\n\n## Accessibility\n- Form labels always visible (no placeholder-only patterns)\n- Focus indicators on all interactive elements (ring-2 ring-offset-2)\n- Error messages linked to inputs via aria-describedby\n- Color contrast minimum WCAG AA (4.5:1)\n- Touch targets minimum 44x44px (h-12 buttons)\n- Keyboard navigation fully supported\n\n## Animation Guidelines\n**Minimal animations only for feedback**:\n- Input focus: Smooth border color transition (transition-colors duration-200)\n- Button press: Subtle scale (active:scale-98)\n- Success/error messages: Fade in (animate-fade-in)\n- Loading spinner: Rotate animation only\n- **No decorative animations** - security context demands seriousness\n\n## Responsive Constraints (Iframe Context)\n- Min-width: 320px (mobile)\n- Optimal width: 400-600px\n- Vertical scrolling: Enabled within iframe\n- No fixed positioning except dev mode badge\n- Padding on mobile: px-4 (prevent edge cutoff)\n\n## Color Branding\n\n### Light Mode\n| Element | Color |\n|---------|-------|\n| Brand color | `#074491` |\n| Bouton text color | `#FFFFFF` |\n| Liens color | `#2563EB` |\n| Header background | `#FFFFFF` |\n| Header text color | `#000000` |\n| Header active text color | `#545861` |\n| Header active background color | `#F0F3F5` |\n| Sidebar background | `#FFFFFF` |\n| Sidebar text color | `#545861` |\n| Sidebar active item | `#074491` |\n| Sidebar active item text | `#FFFFFF` |\n| Sidebar hover item | `#F0F3F5` |\n\n### Dark Mode\n| Element | Color |\n|---------|-------|\n| Brand color | `#3085F5` |\n| Bouton text color | `#202226` |\n| Liens color | `#539DFF` |\n| Header background | `#2B2E33` |\n| Header text color | `#000000` |\n| Header active text color | `#E4E7EB` |\n| Header active background color | `#42464D` |\n| Sidebar background | `#2B2E33` |\n| Sidebar text color | `#E4E7EB` |\n| Sidebar active item | `#42464D` |\n| Sidebar active item text | `#FFFFFF` |\n| Sidebar hover item | `#42464D` |\n\n### Couleurs d'appoint (Utilisation judicieuse seulement)\n| Couleur | Hex |\n|---------|-----|\n| Orange | `#e05a03` |\n| Green | `#009a2a` |\n| Yellow | `#ffb200` |\n| Red | `#db0e00` |\n| Purple | `#641892` |\n| Magenta | `#a82360` |\n\n## Branding \"Avancer Simplement\"\n\n### Logo\n- **Mode clair** : Logo bleu (`logo-bleu-320`)\n- **Mode sombre** : Logo blanc (`logo-blanc-320`)\n- Composant : `client/src/components/logo.tsx`\n\n### Typographie de marque\n\n#### \"AVANCER SIMPLEMENT\" (Nom de la communauté)\n```css\nfont-family: 'Montserrat', sans-serif;\nfont-weight: 900;           /* Black */\nfont-style: italic;\ntext-transform: uppercase;\n/* Mode clair: */ color: #074491;\n/* Mode sombre: */ color: #3085F5;\n```\n\n#### \"Présente\" (Sous-titre des apps)\n```css\nfont-family: Inter, sans-serif;\nfont-weight: 400;           /* Normal */\nfont-style: italic;\nletter-spacing: 0.05em;     /* tracking-wide */\ncolor: var(--muted-foreground);\n```\n\n### Structure d'app standard\nToutes les apps présentées par Avancer Simplement utilisent ce design :\n1. Logo adaptatif (bleu/blanc selon thème)\n2. Titre \"AVANCER SIMPLEMENT\" en Montserrat Black Italic majuscules\n3. Sous-titre \"Présente\" en Inter Italic avec espacement","path":null,"size_bytes":6828,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        success: {\n          DEFAULT: \"hsl(var(--success) / <alpha-value>)\",\n          foreground: \"hsl(var(--success-foreground) / <alpha-value>)\",\n        },\n        warning: {\n          DEFAULT: \"hsl(var(--warning) / <alpha-value>)\",\n          foreground: \"hsl(var(--warning-foreground) / <alpha-value>)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4370,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { LogOut, Shield, Clock, Loader2, Home, Settings, Lock, AlertTriangle, Users, Plus, Trash2, Code, Copy, Check, Info, MoreVertical, UserX, Ban } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport { Logo } from '@/components/logo';\nimport { ThemeToggle } from '@/components/theme-toggle';\nimport { getSessionToken, clearAuth } from '@/lib/auth';\nimport { useToast } from '@/hooks/use-toast';\nimport { queryClient } from '@/lib/queryClient';\n\nimport { AdminFeedbacks } from '@/components/admin/AdminFeedbacks';\n\n// Helper function to copy text with fallback\nasync function copyToClipboard(text: string): Promise<boolean> {\n  try {\n    if (navigator.clipboard && window.isSecureContext) {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } else {\n      // Fallback for insecure contexts or when clipboard API is not available\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      textArea.style.position = 'fixed';\n      textArea.style.left = '-999999px';\n      textArea.style.top = '-999999px';\n      document.body.appendChild(textArea);\n      textArea.focus();\n      textArea.select();\n      const success = document.execCommand('copy');\n      document.body.removeChild(textArea);\n      return success;\n    }\n  } catch (err) {\n    console.error('Failed to copy:', err);\n    return false;\n  }\n}\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  interface AppConfig {\n    requireCircleDomain: boolean;\n    requireCircleLogin: boolean;\n    requirePaywall: boolean;\n    requirePin: boolean;\n    paywallPurchaseUrl: string;\n    paywallInfoUrl: string;\n    paywallTitle: string;\n    paywallMessage: string;\n    webhookAppUrl: string;\n  }\n\n  type Environment = 'development' | 'production';\n\n  interface SettingsData {\n    environment: Environment;\n    circleOnlyMode: boolean;\n  }\n\n  const { data: configData, isLoading: configLoading } = useQuery<AppConfig>({\n    queryKey: ['/api/config'],\n  });\n\n  const { data: settingsData, isLoading: settingsLoading } = useQuery<SettingsData>({\n    queryKey: ['/api/settings'],\n    queryFn: async () => {\n      const response = await fetch(\"/api/settings\");\n      if (!response.ok) throw new Error(\"Failed to fetch settings\");\n      return response.json();\n    }\n  });\n\n  const environment = settingsData?.environment ?? 'development';\n\n  // Local state for paywall settings\n  const [paywallTitle, setPaywallTitle] = useState('');\n  const [paywallMessage, setPaywallMessage] = useState('');\n  const [paywallPurchaseUrl, setPaywallPurchaseUrl] = useState('');\n  const [paywallInfoUrl, setPaywallInfoUrl] = useState('');\n  const [paywallSettingsLoaded, setPaywallSettingsLoaded] = useState(false);\n\n  // Local state for webhook script generator\n  const [webhookAppUrl, setWebhookAppUrl] = useState('');\n  const [webhookSecret, setWebhookSecret] = useState('');\n  const [webhookSettingsLoaded, setWebhookSettingsLoaded] = useState(false);\n  const [scriptCopied, setScriptCopied] = useState(false);\n\n  // Load paywall and webhook settings when config is fetched\n  useEffect(() => {\n    if (configData && !paywallSettingsLoaded) {\n      setPaywallTitle(configData.paywallTitle || '');\n      setPaywallMessage(configData.paywallMessage || '');\n      setPaywallPurchaseUrl(configData.paywallPurchaseUrl || '');\n      setPaywallInfoUrl(configData.paywallInfoUrl || '');\n      setPaywallSettingsLoaded(true);\n    }\n    if (configData && !webhookSettingsLoaded) {\n      setWebhookAppUrl(configData.webhookAppUrl || '');\n      setWebhookSettingsLoaded(true);\n    }\n  }, [configData, paywallSettingsLoaded, webhookSettingsLoaded]);\n\n  const updateConfigMutation = useMutation({\n    mutationFn: async (config: Partial<AppConfig>) => {\n      const token = getSessionToken();\n      const response = await fetch('/api/config', {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify(config),\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Erreur lors de la mise à jour');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/config'] });\n      toast({\n        title: 'Configuration mise à jour',\n        description: 'Les paramètres ont été enregistrés.',\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: 'Erreur',\n        description: error.message || 'Impossible de mettre à jour la configuration.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const environmentMutation = useMutation({\n    mutationFn: async (newEnvironment: Environment) => {\n      const token = getSessionToken();\n      const response = await fetch(\"/api/admin/settings/environment\", {\n        method: \"POST\",\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({ environment: newEnvironment }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"Impossible de changer l'environnement\");\n      }\n\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings\"] });\n      toast({\n        title: \"Environnement modifié\",\n        description: `Mode ${data.environment === 'development' ? 'Développement' : 'Production'} activé`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erreur\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Save paywall settings\n  const savePaywallSettings = () => {\n    updateConfigMutation.mutate({\n      paywallTitle,\n      paywallMessage,\n      paywallPurchaseUrl,\n      paywallInfoUrl,\n    });\n  };\n\n  // Paid members management\n  interface PaidMember {\n    id: string;\n    email: string;\n    paymentDate: string;\n    paymentPlan: string | null;\n    amountPaid: string | null;\n    couponUsed: string | null;\n  }\n\n  const [newMemberEmail, setNewMemberEmail] = useState('');\n\n  const { data: paidMembersData, isLoading: paidMembersLoading } = useQuery<{ members: PaidMember[] }>({\n    queryKey: ['/api/admin/paid-members'],\n    queryFn: async () => {\n      const token = getSessionToken();\n      const response = await fetch('/api/admin/paid-members', {\n        headers: { 'Authorization': `Bearer ${token}` },\n      });\n      if (!response.ok) throw new Error('Failed to fetch paid members');\n      return response.json();\n    },\n  });\n\n  const addMemberMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const token = getSessionToken();\n      const response = await fetch('/api/admin/paid-members', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`,\n        },\n        body: JSON.stringify({ email }),\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Erreur lors de l\\'ajout');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/paid-members'] });\n      setNewMemberEmail('');\n      toast({ title: 'Membre ajouté', description: 'L\\'email a été ajouté aux membres payants.' });\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Erreur', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const deleteMemberMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const token = getSessionToken();\n      const response = await fetch(`/api/admin/paid-members/${encodeURIComponent(email)}`, {\n        method: 'DELETE',\n        headers: { 'Authorization': `Bearer ${token}` },\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Erreur lors de la suppression');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/paid-members'] });\n      toast({ title: 'Accès révoqué', description: 'L\\'accès payant a été retiré. L\\'utilisateur existe toujours.' });\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Erreur', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const deleteUserCompleteMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const token = getSessionToken();\n      const response = await fetch(`/api/admin/delete-user/${encodeURIComponent(email)}`, {\n        method: 'DELETE',\n        headers: { 'Authorization': `Bearer ${token}` },\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.error || 'Erreur lors de la suppression');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/paid-members'] });\n      toast({ title: 'Utilisateur supprimé', description: 'L\\'utilisateur et toutes ses données ont été supprimés.' });\n    },\n    onError: (error: Error) => {\n      toast({ title: 'Erreur', description: error.message, variant: 'destructive' });\n    },\n  });\n\n  const handleAddMember = () => {\n    if (newMemberEmail.trim()) {\n      addMemberMutation.mutate(newMemberEmail.trim().toLowerCase());\n    }\n  };\n\n  const { data: userData, isLoading, error } = useQuery({\n    queryKey: ['/api/auth/me'],\n    queryFn: async () => {\n      const token = getSessionToken();\n      if (!token) {\n        throw new Error('No session token');\n      }\n\n      const response = await fetch('/api/auth/me', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      if (!response.ok) {\n        if (response.status === 401) {\n          throw new Error('Session expired');\n        }\n        throw new Error('Failed to fetch user data');\n      }\n\n      return response.json();\n    },\n    retry: false,\n  });\n\n  useEffect(() => {\n    if (error || !getSessionToken()) {\n      handleLogout();\n    }\n  }, [error]);\n\n  useEffect(() => {\n    if (userData && !userData.isAdmin) {\n      setLocation('/welcome');\n    }\n  }, [userData, setLocation]);\n\n  const handleLogout = () => {\n    clearAuth();\n    window.location.href = '/';\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <Card className=\"w-full max-w-md shadow-lg\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12 space-y-4\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            <p className=\"text-base text-muted-foreground\">Chargement de vos données...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const sessionTimestamp = localStorage.getItem('session_timestamp');\n  const sessionStart = sessionTimestamp ? new Date(parseInt(sessionTimestamp)) : null;\n\n  return (\n    <div className=\"min-h-screen bg-background pb-12\">\n      <main className=\"container mx-auto px-4 py-8\">\n        <div className=\"max-w-4xl mx-auto space-y-6\">\n          <div>\n            <h2 className=\"text-3xl font-semibold mb-2\">Tableau de bord</h2>\n            <p className=\"text-muted-foreground\">\n              Gérez votre application avec l'authentification à 4 couches\n            </p>\n          </div>\n\n          <Tabs defaultValue=\"accueil\" className=\"w-full\">\n            <TabsList className=\"flex w-full overflow-x-auto\" data-testid=\"tabs-navigation\">\n              <TabsTrigger value=\"accueil\" className=\"flex-1 min-w-fit\" data-testid=\"tab-accueil\">\n                <Home className=\"h-4 w-4 mr-1 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Accueil</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"securite\" className=\"flex-1 min-w-fit\" data-testid=\"tab-securite\">\n                <Shield className=\"h-4 w-4 mr-1 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Sécurité</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"paywall\" className=\"flex-1 min-w-fit\" data-testid=\"tab-paywall\">\n                <Lock className=\"h-4 w-4 mr-1 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Paywall</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"membres\" className=\"flex-1 min-w-fit\" data-testid=\"tab-membres\">\n                <Users className=\"h-4 w-4 mr-1 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Membres</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"webhook\" className=\"flex-1 min-w-fit\" data-testid=\"tab-webhook\">\n                <Code className=\"h-4 w-4 mr-1 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Webhook</span>\n              </TabsTrigger>\n              <TabsTrigger value=\"feedbacks\" className=\"flex-1 min-w-fit\" data-testid=\"tab-feedbacks\">\n                <Users className=\"h-4 w-4 mr-1 sm:mr-2\" />\n                <span className=\"hidden sm:inline\">Feedbacks</span>\n              </TabsTrigger>\n            </TabsList>\n\n            {/* Tab: Feedbacks */}\n            <TabsContent value=\"feedbacks\" className=\"space-y-6\">\n              <AdminFeedbacks />\n            </TabsContent>\n\n            {/* Tab: Accueil */}\n            <TabsContent value=\"accueil\" className=\"space-y-6\">\n              <Card data-testid=\"card-session-info\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Informations de session</CardTitle>\n                  <CardDescription>\n                    Détails de votre connexion actuelle\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex items-center gap-3\">\n                    <Clock className=\"h-5 w-5 text-muted-foreground\" />\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm font-medium\">Session démarrée</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {sessionStart ? sessionStart.toLocaleString('fr-FR') : 'Non disponible'}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-3\">\n                    <Shield className=\"h-5 w-5 text-muted-foreground\" />\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm font-medium\">Expiration automatique</p>\n                      <p className=\"text-xs text-muted-foreground\">\n                        60 minutes d'inactivité\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Bienvenue, {userData?.name || 'Administrateur'}</CardTitle>\n                  <CardDescription>\n                    Vous êtes connecté en tant qu'administrateur\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Utilisez les onglets ci-dessus pour naviguer entre les différentes sections de configuration.\n                  </p>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Tab: Sécurité */}\n            <TabsContent value=\"securite\" className=\"space-y-6\">\n              <Card data-testid=\"card-security-config\">\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">Couches de sécurité</CardTitle>\n                  </div>\n                  <CardDescription>\n                    Activez ou désactivez les couches de protection selon vos besoins\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <div className=\"space-y-1 flex-1\">\n                      <Label htmlFor=\"require-circle-domain\" className=\"text-sm font-medium\">\n                        Couche 1 : Exiger le domaine Circle.so\n                      </Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Si désactivé, l'app peut être accédée directement (mode développement)\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {updateConfigMutation.isPending && <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />}\n                      <Switch\n                        id=\"require-circle-domain\"\n                        checked={configData?.requireCircleDomain ?? true}\n                        onCheckedChange={(checked) => updateConfigMutation.mutate({ requireCircleDomain: checked })}\n                        disabled={updateConfigMutation.isPending || configLoading}\n                        data-testid=\"switch-require-circle-domain\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <div className=\"space-y-1 flex-1\">\n                      <Label htmlFor=\"require-circle-login\" className=\"text-sm font-medium\">\n                        Couche 2 : Exiger la connexion Circle.so\n                      </Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {!(configData?.requireCircleDomain) \n                          ? \"Requiert la Couche 1 (Circle.so envoie les infos utilisateur)\"\n                          : \"Si désactivé, les visiteurs non-connectés peuvent voir l'app\"}\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {updateConfigMutation.isPending && <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />}\n                      <Switch\n                        id=\"require-circle-login\"\n                        checked={configData?.requireCircleLogin ?? true}\n                        onCheckedChange={(checked) => {\n                          // Layer 2 requires Layer 1 - auto-enable it\n                          if (checked && !configData?.requireCircleDomain) {\n                            updateConfigMutation.mutate({ requireCircleDomain: true, requireCircleLogin: true });\n                          } else {\n                            updateConfigMutation.mutate({ requireCircleLogin: checked });\n                          }\n                        }}\n                        disabled={updateConfigMutation.isPending || configLoading}\n                        data-testid=\"switch-require-circle-login\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <div className=\"space-y-1 flex-1\">\n                      <Label htmlFor=\"require-paywall\" className=\"text-sm font-medium\">\n                        Couche 3 : Exiger le paiement (Paywall)\n                      </Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        {!(configData?.requireCircleDomain && configData?.requireCircleLogin)\n                          ? \"Requiert les Couches 1 et 2 (pour vérifier le courriel)\"\n                          : \"Si activé, seuls les membres payants peuvent accéder à l'app\"}\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {updateConfigMutation.isPending && <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />}\n                      <Switch\n                        id=\"require-paywall\"\n                        checked={configData?.requirePaywall ?? false}\n                        onCheckedChange={(checked) => {\n                          // Layer 3 requires Layers 1 and 2\n                          if (checked && (!configData?.requireCircleDomain || !configData?.requireCircleLogin)) {\n                            updateConfigMutation.mutate({ \n                              requireCircleDomain: true, \n                              requireCircleLogin: true, \n                              requirePaywall: true \n                            });\n                          } else {\n                            updateConfigMutation.mutate({ requirePaywall: checked });\n                          }\n                        }}\n                        disabled={updateConfigMutation.isPending || configLoading}\n                        data-testid=\"switch-require-paywall\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"flex items-center justify-between gap-4\">\n                    <div className=\"space-y-1 flex-1\">\n                      <Label htmlFor=\"require-pin\" className=\"text-sm font-medium\">\n                        Couche 4 : Exiger le NIP personnel\n                      </Label>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Si désactivé, pas besoin de NIP pour accéder à l'app\n                      </p>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {updateConfigMutation.isPending && <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />}\n                      <Switch\n                        id=\"require-pin\"\n                        checked={configData?.requirePin ?? true}\n                        onCheckedChange={(checked) => updateConfigMutation.mutate({ requirePin: checked })}\n                        disabled={updateConfigMutation.isPending || configLoading}\n                        data-testid=\"switch-require-pin\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"pt-2 border-t\">\n                    <p className=\"text-xs text-muted-foreground\">\n                      <strong>Note :</strong> Désactiver la Couche 1 permet de tester l'app sans être dans Circle.so. À réactiver en production.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Tab: Paywall */}\n            <TabsContent value=\"paywall\" className=\"space-y-6\">\n              <Card data-testid=\"card-paywall-config\">\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Lock className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">Configuration du Paywall</CardTitle>\n                  </div>\n                  <CardDescription>\n                    Personnalisez l'écran affiché aux membres non-payants\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"paywall-title\">Titre de l'écran de blocage</Label>\n                    <Input\n                      id=\"paywall-title\"\n                      placeholder=\"Accès Réservé\"\n                      value={paywallTitle}\n                      onChange={(e) => setPaywallTitle(e.target.value)}\n                      data-testid=\"input-paywall-title\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"paywall-message\">Message explicatif</Label>\n                    <Textarea\n                      id=\"paywall-message\"\n                      placeholder=\"Cette application est réservée aux membres payants de la communauté.\"\n                      value={paywallMessage}\n                      onChange={(e) => setPaywallMessage(e.target.value)}\n                      rows={3}\n                      data-testid=\"input-paywall-message\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"paywall-purchase-url\">URL d'achat (bouton principal)</Label>\n                    <Input\n                      id=\"paywall-purchase-url\"\n                      placeholder=\"https://votre-communaute.circle.so/c/acheter\"\n                      value={paywallPurchaseUrl}\n                      onChange={(e) => setPaywallPurchaseUrl(e.target.value)}\n                      data-testid=\"input-paywall-purchase-url\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Lien vers la page d'achat Circle.so ou Stripe\n                    </p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"paywall-info-url\">URL d'information (bouton secondaire)</Label>\n                    <Input\n                      id=\"paywall-info-url\"\n                      placeholder=\"https://votre-communaute.circle.so/c/info\"\n                      value={paywallInfoUrl}\n                      onChange={(e) => setPaywallInfoUrl(e.target.value)}\n                      data-testid=\"input-paywall-info-url\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Lien vers une page explicative (optionnel)\n                    </p>\n                  </div>\n                  <Button\n                    onClick={savePaywallSettings}\n                    disabled={updateConfigMutation.isPending}\n                    className=\"w-full\"\n                    data-testid=\"button-save-paywall-settings\"\n                  >\n                    {updateConfigMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        Enregistrement...\n                      </>\n                    ) : (\n                      'Enregistrer les paramètres du paywall'\n                    )}\n                  </Button>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Tab: Membres */}\n            <TabsContent value=\"membres\" className=\"space-y-6\">\n              <Card data-testid=\"card-paid-members\">\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Users className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">Membres Payants</CardTitle>\n                  </div>\n                  <CardDescription>\n                    Gérez manuellement les accès payants (le webhook Circle.so ajoute automatiquement les nouveaux paiements)\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"flex gap-2\">\n                    <Input\n                      placeholder=\"email@exemple.com\"\n                      value={newMemberEmail}\n                      onChange={(e) => setNewMemberEmail(e.target.value)}\n                      onKeyDown={(e) => e.key === 'Enter' && handleAddMember()}\n                      data-testid=\"input-new-member-email\"\n                    />\n                    <Button\n                      onClick={handleAddMember}\n                      disabled={addMemberMutation.isPending || !newMemberEmail.trim()}\n                      data-testid=\"button-add-member\"\n                    >\n                      {addMemberMutation.isPending ? (\n                        <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      ) : (\n                        <Plus className=\"h-4 w-4\" />\n                      )}\n                    </Button>\n                  </div>\n\n                  <div className=\"border rounded-md divide-y max-h-96 overflow-y-auto\">\n                    {paidMembersLoading ? (\n                      <div className=\"p-4 text-center text-muted-foreground\">\n                        <Loader2 className=\"h-4 w-4 animate-spin mx-auto\" />\n                      </div>\n                    ) : paidMembersData?.members?.length === 0 ? (\n                      <div className=\"p-4 text-center text-muted-foreground text-sm\">\n                        Aucun membre payant enregistré\n                      </div>\n                    ) : (\n                      paidMembersData?.members?.map((member) => (\n                        <div key={member.id} className=\"flex items-center justify-between p-3 gap-2\" data-testid={`row-member-${member.id}`}>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"text-sm font-medium truncate\">{member.email}</p>\n                            <div className=\"flex flex-wrap gap-x-2 text-xs text-muted-foreground\">\n                              <span>{member.paymentPlan || 'Ajout manuel'}</span>\n                              {member.amountPaid && <span>• {member.amountPaid}</span>}\n                              {member.couponUsed && <span>• Code: {member.couponUsed}</span>}\n                              <span>• {new Date(member.paymentDate).toLocaleDateString('fr-FR')}</span>\n                            </div>\n                          </div>\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                disabled={deleteMemberMutation.isPending || deleteUserCompleteMutation.isPending}\n                                data-testid={`button-member-actions-${member.id}`}\n                              >\n                                <MoreVertical className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem\n                                onClick={() => deleteMemberMutation.mutate(member.email)}\n                                data-testid={`button-revoke-access-${member.id}`}\n                              >\n                                <Ban className=\"h-4 w-4 mr-2\" />\n                                Retirer l'accès payant\n                              </DropdownMenuItem>\n                              <DropdownMenuSeparator />\n                              <DropdownMenuItem\n                                onClick={() => deleteUserCompleteMutation.mutate(member.email)}\n                                className=\"text-destructive focus:text-destructive\"\n                                data-testid={`button-delete-user-${member.id}`}\n                              >\n                                <UserX className=\"h-4 w-4 mr-2\" />\n                                Supprimer complètement\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </div>\n                      ))\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n\n            {/* Tab: Webhook */}\n            <TabsContent value=\"webhook\" className=\"space-y-6\">\n              <Card data-testid=\"card-webhook-generator\">\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Code className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">Générateur de Script Webhook</CardTitle>\n                  </div>\n                  <CardDescription>\n                    Générez le script à coller dans le Custom Code de votre paywall Circle.so\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"webhook-app-url\">URL de l'application</Label>\n                    <Input\n                      id=\"webhook-app-url\"\n                      placeholder=\"https://votre-app.replit.app\"\n                      value={webhookAppUrl}\n                      onChange={(e) => setWebhookAppUrl(e.target.value)}\n                      data-testid=\"input-webhook-app-url\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      L'URL complète du webhook sera : {webhookAppUrl ? `${webhookAppUrl}/webhooks/circle-payment` : '...'}\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"webhook-secret\">Secret du webhook</Label>\n                    <Input\n                      id=\"webhook-secret\"\n                      placeholder=\"votre-secret-securise\"\n                      value={webhookSecret}\n                      onChange={(e) => setWebhookSecret(e.target.value)}\n                      data-testid=\"input-webhook-secret\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      Ce secret doit correspondre à la variable d'environnement <code className=\"bg-muted px-1 rounded\">WEBHOOK_SECRET</code>\n                    </p>\n                  </div>\n\n                  <Button\n                    onClick={() => updateConfigMutation.mutate({ webhookAppUrl })}\n                    disabled={updateConfigMutation.isPending || !webhookAppUrl.trim()}\n                    variant=\"outline\"\n                    className=\"w-full\"\n                    data-testid=\"button-save-webhook-url\"\n                  >\n                    {updateConfigMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                    ) : null}\n                    Sauvegarder l'URL\n                  </Button>\n\n                  {webhookAppUrl && webhookSecret && (\n                    <div className=\"space-y-2\">\n                      <Label>Script à copier dans Circle.so</Label>\n                      <div className=\"bg-muted p-3 rounded-md text-xs font-mono overflow-x-auto whitespace-pre-wrap break-all\">\n                        {`<script>\nconst WEBHOOK_SECRET = '${webhookSecret}';\nfetch('${webhookAppUrl}/webhooks/circle-payment', {\n  method: 'POST',\n  headers: { \n    'Content-Type': 'application/json',\n    'X-Webhook-Secret': WEBHOOK_SECRET\n  },\n  body: JSON.stringify({\n    event: 'payment_received',\n    user: { \n      email: '{member_email}', \n      timestamp: Math.floor(Date.now() / 1000) \n    },\n    payment: {\n      paywall_display_name: '{paywall_display_name}',\n      amount_paid: '{amount_paid}',\n      coupon_code: '{coupon_code}'\n    }\n  })\n});\n</script>`}\n                      </div>\n                      <Button\n                        onClick={async () => {\n                          const script = `<script>\nconst WEBHOOK_SECRET = '${webhookSecret}';\nfetch('${webhookAppUrl}/webhooks/circle-payment', {\n  method: 'POST',\n  headers: { \n    'Content-Type': 'application/json',\n    'X-Webhook-Secret': WEBHOOK_SECRET\n  },\n  body: JSON.stringify({\n    event: 'payment_received',\n    user: { \n      email: '{member_email}', \n      timestamp: Math.floor(Date.now() / 1000) \n    },\n    payment: {\n      paywall_display_name: '{paywall_display_name}',\n      amount_paid: '{amount_paid}',\n      coupon_code: '{coupon_code}'\n    }\n  })\n});\n</script>`;\n                          const success = await copyToClipboard(script);\n                          if (success) {\n                            setScriptCopied(true);\n                            setTimeout(() => setScriptCopied(false), 2000);\n                            toast({ title: 'Copié !', description: 'Le script a été copié dans le presse-papiers.' });\n                          } else {\n                            toast({ title: 'Erreur', description: 'Impossible de copier. Sélectionnez manuellement le texte.', variant: 'destructive' });\n                          }\n                        }}\n                        className=\"w-full\"\n                        data-testid=\"button-copy-script\"\n                      >\n                        {scriptCopied ? (\n                          <>\n                            <Check className=\"h-4 w-4 mr-2\" />\n                            Copié !\n                          </>\n                        ) : (\n                          <>\n                            <Copy className=\"h-4 w-4 mr-2\" />\n                            Copier le script\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  )}\n\n                  {(!webhookAppUrl || !webhookSecret) && (\n                    <Alert>\n                      <AlertTriangle className=\"h-4 w-4\" />\n                      <AlertDescription>\n                        Remplissez l'URL de l'application et le secret pour générer le script.\n                      </AlertDescription>\n                    </Alert>\n                  )}\n                </CardContent>\n              </Card>\n\n              <Card data-testid=\"card-auth-script-generator\">\n                <CardHeader>\n                  <div className=\"flex items-center gap-2\">\n                    <Shield className=\"h-5 w-5 text-muted-foreground\" />\n                    <CardTitle className=\"text-lg\">Code Snippet Circle - Script d'Authentification</CardTitle>\n                  </div>\n                  <CardDescription>\n                  </CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label>Script complet (définit circleUser + répond aux demandes d'auth)</Label>\n                    <div className=\"bg-muted p-3 rounded-md text-xs font-mono overflow-x-auto whitespace-pre-wrap break-all max-h-64 overflow-y-auto\">\n                      {`<script>\n// Script d'authentification Circle.so -> Replit Apps v3\n// À placer dans: Settings → Code Snippets → JavaScript\n(function() {\n  function getTheme() {\n    return document.documentElement.classList.contains('dark') ? 'dark' : 'light';\n  }\n  \n  function buildPayload() {\n    // Circle.so expose automatiquement window.circleUser\n    if (!window.circleUser || !window.circleUser.email) return null;\n    return {\n      type: 'CIRCLE_USER_AUTH',\n      user: {\n        publicUid: window.circleUser.publicUid || '',\n        email: window.circleUser.email,\n        name: window.circleUser.name || 'Membre',\n        isAdmin: window.circleUser.is_admin === true,\n        timestamp: Date.now()\n      },\n      theme: getTheme()\n    };\n  }\n  \n  function sendToAllIframes() {\n    var iframes = document.querySelectorAll('iframe[src*=\".replit.app\"]');\n    var payload = buildPayload();\n    if (payload) {\n      iframes.forEach(function(iframe) {\n        if (iframe.contentWindow) {\n          iframe.contentWindow.postMessage(payload, '*');\n        }\n      });\n    }\n  }\n  \n  // Écouter les demandes d'auth des iframes\n  window.addEventListener('message', function(event) {\n    if (event.data && event.data.type === 'CIRCLE_AUTH_REQUEST') {\n      var payload = buildPayload();\n      if (payload && event.source) {\n        event.source.postMessage(payload, '*');\n      }\n    }\n  });\n  \n  // Attendre que circleUser soit disponible puis envoyer\n  function tryToSend() {\n    if (window.circleUser && window.circleUser.email) {\n      sendToAllIframes();\n      return true;\n    }\n    return false;\n  }\n  \n  // Essayer immédiatement puis toutes les 500ms pendant 10s\n  if (!tryToSend()) {\n    var attempts = 0;\n    var interval = setInterval(function() {\n      attempts++;\n      if (tryToSend() || attempts >= 20) {\n        clearInterval(interval);\n      }\n    }, 500);\n  }\n  \n  // Aussi envoyer après chargement complet\n  window.addEventListener('load', function() {\n    setTimeout(sendToAllIframes, 100);\n    setTimeout(sendToAllIframes, 1000);\n  });\n})();\n</script>`}\n                    </div>\n                    <Button\n                      onClick={async () => {\n                        const authScript = `<script>\n// Script d'authentification Circle.so -> Replit Apps v3\n// À placer dans: Settings → Code Snippets → JavaScript\n(function() {\n  function getTheme() {\n    return document.documentElement.classList.contains('dark') ? 'dark' : 'light';\n  }\n  \n  function buildPayload() {\n    // Circle.so expose automatiquement window.circleUser\n    if (!window.circleUser || !window.circleUser.email) return null;\n    return {\n      type: 'CIRCLE_USER_AUTH',\n      user: {\n        publicUid: window.circleUser.publicUid || '',\n        email: window.circleUser.email,\n        name: window.circleUser.name || 'Membre',\n        isAdmin: window.circleUser.is_admin === true,\n        timestamp: Date.now()\n      },\n      theme: getTheme()\n    };\n  }\n  \n  function sendToAllIframes() {\n    var iframes = document.querySelectorAll('iframe[src*=\".replit.app\"]');\n    var payload = buildPayload();\n    if (payload) {\n      iframes.forEach(function(iframe) {\n        if (iframe.contentWindow) {\n          iframe.contentWindow.postMessage(payload, '*');\n        }\n      });\n    }\n  }\n  \n  // Écouter les demandes d'auth des iframes\n  window.addEventListener('message', function(event) {\n    if (event.data && event.data.type === 'CIRCLE_AUTH_REQUEST') {\n      var payload = buildPayload();\n      if (payload && event.source) {\n        event.source.postMessage(payload, '*');\n      }\n    }\n  });\n  \n  // Attendre que circleUser soit disponible puis envoyer\n  function tryToSend() {\n    if (window.circleUser && window.circleUser.email) {\n      sendToAllIframes();\n      return true;\n    }\n    return false;\n  }\n  \n  // Essayer immédiatement puis toutes les 500ms pendant 10s\n  if (!tryToSend()) {\n    var attempts = 0;\n    var interval = setInterval(function() {\n      attempts++;\n      if (tryToSend() || attempts >= 20) {\n        clearInterval(interval);\n      }\n    }, 500);\n  }\n  \n  // Aussi envoyer après chargement complet\n  window.addEventListener('load', function() {\n    setTimeout(sendToAllIframes, 100);\n    setTimeout(sendToAllIframes, 1000);\n  });\n})();\n</script>`;\n                        const success = await copyToClipboard(authScript);\n                        if (success) {\n                          toast({ title: 'Copié !', description: 'Le script d\\'authentification complet a été copié.' });\n                        } else {\n                          toast({ title: 'Erreur', description: 'Impossible de copier. Sélectionnez manuellement le texte.', variant: 'destructive' });\n                        }\n                      }}\n                      className=\"w-full\"\n                      data-testid=\"button-copy-auth-script\"\n                    >\n                      <Copy className=\"h-4 w-4 mr-2\" />\n                      Copier le script complet\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":44269,"size_tokens":null},"client/src/pages/auth.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Loader2, AlertCircle, Shield, LogIn, Lock, ExternalLink, Info } from 'lucide-react';\nimport { useCircleAuth } from '@/hooks/use-circle-auth';\nimport { PinCreationForm } from '@/components/pin-creation-form';\nimport { PinLoginForm } from '@/components/pin-login-form';\nimport { Logo } from '@/components/logo';\nimport { ThemeToggle } from '@/components/theme-toggle';\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { getSessionToken } from '@/lib/auth';\n\ntype AuthStep = 'waiting' | 'validating' | 'new_user' | 'existing_user' | 'authenticated' | 'error' | 'public_landing' | 'paywall_blocked';\n\ninterface AppConfig {\n  requireCircleDomain: boolean;\n  requireCircleLogin: boolean;\n  requirePaywall: boolean;\n  requirePin: boolean;\n  paywallPurchaseUrl: string;\n  paywallInfoUrl: string;\n  paywallTitle: string;\n  paywallMessage: string;\n}\n\ninterface PaywallInfo {\n  paywallTitle: string;\n  paywallMessage: string;\n  paywallPurchaseUrl: string;\n  paywallInfoUrl: string;\n}\n\nexport default function AuthPage() {\n  const [, setLocation] = useLocation();\n  const { userData, error: circleError, isLoading } = useCircleAuth();\n  const [authStep, setAuthStep] = useState<AuthStep>('waiting');\n  const [error, setError] = useState<string | null>(null);\n  const [isValidating, setIsValidating] = useState(false);\n  const [validatedData, setValidatedData] = useState<{\n    public_uid?: string;\n    email?: string;\n    name?: string;\n    is_admin?: boolean;\n    validationToken?: string;\n  } | null>(null);\n  const [paywallInfo, setPaywallInfo] = useState<PaywallInfo | null>(null);\n  const lastValidatedEmailRef = useRef<string | null>(null);\n\n  // Fetch app security configuration\n  const { data: appConfig, isLoading: configLoading } = useQuery<AppConfig>({\n    queryKey: ['/api/config'],\n  });\n\n  // Dev mode is when Circle domain is NOT required\n  const devMode = appConfig ? !appConfig.requireCircleDomain : false;\n\n  // Helper functions defined before useEffect to avoid temporal dead zone errors\n  \n  const handleAuthSuccess = (sessionToken: string, userId: string, isAdmin?: boolean) => {\n    localStorage.setItem('session_token', sessionToken);\n    localStorage.setItem('user_id', userId);\n    localStorage.setItem('session_timestamp', Date.now().toString());\n    \n    // Route based on user role - all users go to welcome page\n    // Admins can access dashboard from the header\n    setLocation('/welcome');\n  };\n\n  const handleError = (message: string) => {\n    setError(message);\n  };\n\n  // Fetch paywall info directly (for paywall-only mode without Circle auth)\n  const fetchPaywallInfo = async () => {\n    try {\n      const response = await fetch('/api/config');\n      const config = await response.json();\n      \n      setPaywallInfo({\n        paywallTitle: config.paywallTitle || 'Accès Réservé',\n        paywallMessage: config.paywallMessage || 'Cette application est réservée aux membres payants.',\n        paywallPurchaseUrl: config.paywallPurchaseUrl || '',\n        paywallInfoUrl: config.paywallInfoUrl || '',\n      });\n      setAuthStep('paywall_blocked');\n    } catch (err) {\n      console.error('Error fetching paywall info:', err);\n      setError('Erreur lors du chargement de la configuration');\n      setAuthStep('error');\n    }\n  };\n\n  // Check paywall access (Couche 3)\n  const checkPaywallAccess = async (email: string): Promise<boolean> => {\n    try {\n      const response = await fetch('/api/auth/check-paywall', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email }),\n      });\n      const result = await response.json();\n\n      if (!result.hasAccess) {\n        setPaywallInfo({\n          paywallTitle: result.paywallTitle || 'Accès Réservé',\n          paywallMessage: result.paywallMessage || 'Cette application est réservée aux membres payants.',\n          paywallPurchaseUrl: result.paywallPurchaseUrl || '',\n          paywallInfoUrl: result.paywallInfoUrl || '',\n        });\n        setAuthStep('paywall_blocked');\n        return false;\n      }\n      return true;\n    } catch (err) {\n      console.error('Paywall check error:', err);\n      return true; // En cas d'erreur, on laisse passer (fail-open pour UX)\n    }\n  };\n\n  const createUserWithoutPin = async (\n    email: string,\n    publicUid: string,\n    name: string,\n    validationToken: string,\n    isAdmin: boolean\n  ) => {\n    try {\n      const result = await fetch('/api/auth/create-user-no-pin', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          email,\n          public_uid: publicUid,\n          name,\n          validation_token: validationToken,\n        }),\n      }).then(async (response) => {\n        const data = await response.json();\n        if (!response.ok) {\n          throw new Error(data.error || 'Erreur lors de la création du compte');\n        }\n        return data;\n      });\n\n      handleAuthSuccess(result.session_token, result.user_id, result.is_admin);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erreur lors de la création du compte');\n      setAuthStep('error');\n    }\n  };\n\n  const validateCircleData = async (userDataToValidate?: typeof userData) => {\n    const dataToValidate = userDataToValidate || userData;\n    if (!dataToValidate) return;\n\n    setIsValidating(true);\n    setError(null);\n\n    try {\n      const result = await fetch('/api/auth/validate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ user: dataToValidate }),\n      }).then(async (response) => {\n        const data = await response.json();\n        if (!response.ok) {\n          throw new Error(data.error || 'Erreur de validation');\n        }\n        return data;\n      });\n\n      // Check paywall (Couche 3) before continuing\n      const paywallPassed = await checkPaywallAccess(dataToValidate.email);\n      if (!paywallPassed) {\n        return; // User blocked by paywall\n      }\n\n      // Auto-login: backend returns session token directly (PIN not required)\n      if (result.status === 'auto_login' && result.session_token) {\n        handleAuthSuccess(result.session_token, result.user_id, result.is_admin);\n        return;\n      }\n\n      setValidatedData({\n        public_uid: result.user_id,\n        email: dataToValidate.email,\n        name: dataToValidate.name,\n        is_admin: result.is_admin || false,\n        validationToken: result.validation_token,\n      });\n\n      // New user without PIN requirement - auto-create account\n      if (result.status === 'new_user' && result.requires_pin === false) {\n        await createUserWithoutPin(\n          dataToValidate.email,\n          result.user_id,\n          dataToValidate.name,\n          result.validation_token,\n          result.is_admin\n        );\n        return;\n      }\n\n      if (result.status === 'new_user') {\n        setAuthStep('new_user');\n      } else if (result.status === 'existing_user') {\n        setAuthStep('existing_user');\n      }\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erreur de validation');\n      setAuthStep('error');\n    } finally {\n      setIsValidating(false);\n    }\n  };\n\n  // Main authentication effect\n  useEffect(() => {\n    // Wait for config to load\n    if (configLoading || !appConfig) return;\n\n    // Check if user already has a valid session\n    const existingToken = getSessionToken();\n    if (existingToken) {\n      // User is already logged in, redirect to welcome\n      setLocation('/welcome');\n      return;\n    }\n\n    // Public mode: all 4 layers disabled - go directly to welcome (no login required)\n    const isPublicMode = !appConfig.requireCircleDomain && !appConfig.requireCircleLogin && !appConfig.requirePaywall && !appConfig.requirePin;\n    if (isPublicMode) {\n      setLocation('/welcome');\n      return;\n    }\n\n    // Paywall-only mode: layers 1 and 2 disabled, but paywall enabled\n    // Show paywall directly without Circle validation (no way to identify user)\n    const isPaywallOnlyMode = !appConfig.requireCircleDomain && !appConfig.requireCircleLogin && appConfig.requirePaywall;\n    if (isPaywallOnlyMode) {\n      // Fetch paywall info and show paywall screen\n      fetchPaywallInfo();\n      return;\n    }\n\n    // Domain-only mode: only layer 1 enabled (requireCircleDomain = true)\n    // User is on Circle domain but no login required - let them through\n    const isDomainOnlyMode = appConfig.requireCircleDomain && !appConfig.requireCircleLogin && !appConfig.requirePaywall && !appConfig.requirePin;\n    if (isDomainOnlyMode) {\n      // User is on the Circle domain (otherwise they wouldn't reach this page via iframe)\n      // No login required, just let them access the app\n      setLocation('/welcome');\n      return;\n    }\n\n    // Dev mode: Circle domain not required but Circle login is required - use mock data\n    if (devMode && appConfig.requireCircleLogin) {\n      const mockUserData = {\n        publicUid: 'dev123',\n        email: 'dev@example.com',\n        name: 'Dev User',\n        isAdmin: true,\n        timestamp: Date.now(),\n      };\n      \n      validateCircleData(mockUserData);\n      return;\n    }\n    \n    // Dev mode without Circle login - go directly to welcome\n    if (devMode && !appConfig.requireCircleLogin && !appConfig.requirePaywall) {\n      setLocation('/welcome');\n      return;\n    }\n\n    if (circleError) {\n      setError(circleError);\n      setAuthStep('error');\n      return;\n    }\n\n    if (userData) {\n      // Prevent duplicate validation calls when Circle.so sends multiple messages\n      if (lastValidatedEmailRef.current === userData.email) {\n        return;\n      }\n      lastValidatedEmailRef.current = userData.email;\n      validateCircleData(userData);\n    }\n  }, [userData, circleError, devMode, appConfig, configLoading]);\n\n  // Show error message if Circle.so auth failed\n  if (circleError && !devMode) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-timeout\">\n          <CardHeader className=\"text-center space-y-4\">\n            <Logo size=\"lg\" className=\"mx-auto\" />\n            <CardTitle className=\"text-2xl font-semibold\">\n              Accès restreint\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <p className=\"text-center text-muted-foreground\" data-testid=\"text-timeout-message\">\n              Vous devez accéder à cette page via la Plateforme Avancer Simplement\n            </p>\n            <Button\n              asChild\n              className=\"w-full h-12\"\n              data-testid=\"button-access-platform\"\n            >\n              <a href=\"https://communaute.avancersimplement.com/\" target=\"_top\">\n                Accéder à la plateforme\n              </a>\n            </Button>\n            <div className=\"pt-4 border-t\">\n              <Button\n                variant=\"outline\"\n                className=\"w-full\"\n                onClick={() => setLocation('/admin-login')}\n                data-testid=\"button-admin-access\"\n              >\n                <Shield className=\"h-4 w-4 mr-2\" />\n                Accès Administrateur\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if ((authStep === 'waiting' || isValidating || isLoading) && !circleError) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-loading\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12 space-y-4\">\n            <Logo size=\"lg\" />\n            <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n            <p className=\"text-base text-muted-foreground\">\n              {devMode ? 'Initialisation du mode développement...' : 'Connexion en cours...'}\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Public landing page when all security layers are disabled\n  if (authStep === 'public_landing') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <div className=\"absolute top-4 right-4\">\n          <ThemeToggle />\n        </div>\n        <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-public-landing\">\n          <CardHeader className=\"text-center space-y-4\">\n            <Logo size=\"lg\" className=\"mx-auto\" />\n            <CardTitle className=\"text-2xl font-semibold\">\n              Bienvenue\n            </CardTitle>\n            <CardDescription>\n              Connectez-vous pour accéder à votre espace\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Button\n              className=\"w-full h-12\"\n              onClick={() => setLocation('/admin-login')}\n              data-testid=\"button-login\"\n            >\n              <LogIn className=\"h-4 w-4 mr-2\" />\n              Connexion\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (authStep === 'error') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-error\">\n          <CardHeader>\n            <div className=\"flex items-center justify-center w-12 h-12 mx-auto rounded-full bg-destructive/10\">\n              <AlertCircle className=\"h-6 w-6 text-destructive\" />\n            </div>\n            <CardTitle className=\"text-2xl font-semibold text-center\">\n              Erreur d'authentification\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Alert variant=\"destructive\" className=\"bg-destructive/10 border-destructive/20\">\n              <AlertDescription data-testid=\"text-error-message\">\n                {error || 'Une erreur est survenue lors de la connexion'}\n              </AlertDescription>\n            </Alert>\n            <Button\n              onClick={() => window.location.reload()}\n              variant=\"outline\"\n              className=\"w-full h-12\"\n              data-testid=\"button-retry\"\n            >\n              Réessayer\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Paywall blocked screen (Couche 3)\n  if (authStep === 'paywall_blocked' && paywallInfo) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n        <div className=\"absolute top-4 right-4\">\n          <ThemeToggle />\n        </div>\n        <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-paywall\">\n          <CardHeader className=\"text-center space-y-4\">\n            <div className=\"flex items-center justify-center w-16 h-16 mx-auto rounded-full bg-primary/10\">\n              <Lock className=\"h-8 w-8 text-primary\" />\n            </div>\n            <CardTitle className=\"text-2xl font-semibold\" data-testid=\"text-paywall-title\">\n              {paywallInfo.paywallTitle}\n            </CardTitle>\n            <CardDescription className=\"text-base\" data-testid=\"text-paywall-message\">\n              {paywallInfo.paywallMessage}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {paywallInfo.paywallPurchaseUrl && (\n              <Button\n                asChild\n                className=\"w-full h-12\"\n                data-testid=\"button-paywall-purchase\"\n              >\n                <a href={paywallInfo.paywallPurchaseUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\n                  Acheter maintenant\n                </a>\n              </Button>\n            )}\n            {paywallInfo.paywallInfoUrl && (\n              <Button\n                asChild\n                variant=\"outline\"\n                className=\"w-full h-12\"\n                data-testid=\"button-paywall-info\"\n              >\n                <a href={paywallInfo.paywallInfoUrl} target=\"_blank\" rel=\"noopener noreferrer\">\n                  <Info className=\"h-4 w-4 mr-2\" />\n                  Plus d'informations\n                </a>\n              </Button>\n            )}\n            <div className=\"pt-4 border-t\">\n              <p className=\"text-sm text-muted-foreground text-center\">\n                Vous avez déjà payé ? Rechargez la page après votre achat.\n              </p>\n              <Button\n                variant=\"ghost\"\n                className=\"w-full mt-2\"\n                onClick={() => window.location.reload()}\n                data-testid=\"button-paywall-reload\"\n              >\n                Actualiser\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      {error && (\n        <div className=\"fixed top-4 left-1/2 -translate-x-1/2 w-full max-w-md px-4 z-40\">\n          <Alert variant=\"destructive\" className=\"shadow-lg\" data-testid=\"alert-error\">\n            <AlertCircle className=\"h-4 w-4\" />\n            <AlertTitle>Erreur</AlertTitle>\n            <AlertDescription>{error}</AlertDescription>\n          </Alert>\n        </div>\n      )}\n\n      {authStep === 'new_user' && validatedData && (\n        <PinCreationForm\n          userName={validatedData.name || ''}\n          userEmail={validatedData.email || ''}\n          publicUid={validatedData.public_uid || ''}\n          validationToken={validatedData.validationToken || ''}\n          onSuccess={handleAuthSuccess}\n          onError={handleError}\n        />\n      )}\n\n      {authStep === 'existing_user' && validatedData && (\n        <PinLoginForm\n          userEmail={validatedData.email || ''}\n          onSuccess={handleAuthSuccess}\n          onError={handleError}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":18365,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, boolean, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  publicUid: text(\"public_uid\").notNull().unique(),\n  name: text(\"name\").notNull(),\n  pinHash: text(\"pin_hash\").notNull(),\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  lastLogin: timestamp(\"last_login\"),\n});\n\nexport const loginAttempts = pgTable(\"login_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\"),\n  success: boolean(\"success\").notNull(),\n  ipAddress: text(\"ip_address\"),\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n});\n\nexport const appConfig = pgTable(\"app_config\", {\n  id: varchar(\"id\").primaryKey().default(\"main\"),\n  requireCircleDomain: boolean(\"require_circle_domain\").notNull().default(true),\n  requireCircleLogin: boolean(\"require_circle_login\").notNull().default(true),\n  requirePaywall: boolean(\"require_paywall\").notNull().default(false),\n  requirePin: boolean(\"require_pin\").notNull().default(true),\n  paywallPurchaseUrl: text(\"paywall_purchase_url\").default(\"\"),\n  paywallInfoUrl: text(\"paywall_info_url\").default(\"\"),\n  paywallTitle: text(\"paywall_title\").default(\"Accès Réservé\"),\n  paywallMessage: text(\"paywall_message\").default(\"Cette application est réservée aux membres ayant souscrit à l'offre.\"),\n  webhookAppUrl: text(\"webhook_app_url\").default(\"\"),\n  environment: text(\"environment\").default(\"development\").notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const paidMembers = pgTable(\"paid_members\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  paymentDate: timestamp(\"payment_date\").defaultNow().notNull(),\n  paymentPlan: text(\"payment_plan\"),\n  amountPaid: text(\"amount_paid\"),\n  couponUsed: text(\"coupon_used\"),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  email: true,\n  publicUid: true,\n  name: true,\n  pinHash: true,\n  isAdmin: true,\n});\n\nexport const insertLoginAttemptSchema = createInsertSchema(loginAttempts).pick({\n  userId: true,\n  success: true,\n  ipAddress: true,\n}).extend({\n  userId: z.string().nullable().optional(),\n});\n\nexport const validateCircleUserSchema = z.object({\n  publicUid: z.string().min(1, \"Identifiant Circle.so requis\"),\n  email: z.string().email(\"Email invalide\"),\n  name: z.string().min(1, \"Nom requis\"),\n  isAdmin: z.boolean().optional().default(false),\n  timestamp: z.number(),\n});\n\nexport const createPinSchema = z.object({\n  email: z.string().email(\"Email invalide\"),\n  public_uid: z.string().min(1, \"Identifiant requis\"),\n  name: z.string().min(1, \"Nom requis\"),\n  pin: z.string().regex(/^\\d{4,6}$/, \"Le NIP doit contenir 4 à 6 chiffres\"),\n  validation_token: z.string().min(1, \"Token de validation requis\"),\n});\n\nexport const validatePinSchema = z.object({\n  email: z.string().email(\"Email invalide\"),\n  pin: z.string().min(1, \"NIP requis\"),\n});\n\nexport const updateConfigSchema = z.object({\n  requireCircleDomain: z.boolean().optional(),\n  requireCircleLogin: z.boolean().optional(),\n  requirePaywall: z.boolean().optional(),\n  requirePin: z.boolean().optional(),\n  paywallPurchaseUrl: z.string().optional(),\n  paywallInfoUrl: z.string().optional(),\n  paywallTitle: z.string().optional(),\n  paywallMessage: z.string().optional(),\n  webhookAppUrl: z.string().optional(),\n  environment: z.enum(['development', 'production']).optional(),\n});\n\nexport const insertPaidMemberSchema = createInsertSchema(paidMembers).omit({\n  id: true,\n  paymentDate: true,\n});\n\nexport const paymentWebhookSchema = z.object({\n  event: z.literal('payment_received'),\n  user: z.object({\n    email: z.string().email(),\n    timestamp: z.number(),\n  }),\n  payment: z.object({\n    paywall_display_name: z.string().optional(),\n    amount_paid: z.string().optional(),\n    price_interval: z.string().optional(),\n    coupon_code: z.string().optional(),\n  }).optional(),\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type InsertLoginAttempt = z.infer<typeof insertLoginAttemptSchema>;\nexport type LoginAttempt = typeof loginAttempts.$inferSelect;\nexport type AppConfig = typeof appConfig.$inferSelect;\nexport type InsertPaidMember = z.infer<typeof insertPaidMemberSchema>;\nexport type PaidMember = typeof paidMembers.$inferSelect;\n\nexport const circleUserDataSchema = z.object({\n  type: z.literal('CIRCLE_USER_AUTH'),\n  user: z.object({\n    publicUid: z.string().optional().default(''),\n    email: z.string().email(),\n    name: z.string().optional().default('Membre'),\n    firstName: z.string().optional(),\n    lastName: z.string().optional(),\n    isAdmin: z.union([z.boolean(), z.string()]).optional().default(false),\n    timestamp: z.number(),\n  }),\n  theme: z.enum(['light', 'dark']).optional(),\n});\n\nexport type CircleUserData = z.infer<typeof circleUserDataSchema>;\n\n// Session state for conversation flow\nexport const sessionStateSchema = z.object({\n  senderName: z.string().min(1),\n  receiverName: z.string().min(1),\n  currentStep: z.number().min(0).max(38),\n  // App type selection\n  appType: z.enum(['solo', 'duo']).optional(),\n  // Checklist states (parcours normal)\n  checklistSituation: z.boolean().optional(),\n  checklistVecu: z.boolean().optional(),\n  checklistInterpretation: z.boolean().optional(),\n  checklistImpact: z.boolean().optional(),\n  // Checklist states (parcours inversé)\n  checklistVecuInverse: z.boolean().optional(),\n  checklistInterpretationInverse: z.boolean().optional(),\n  checklistImpactInverse: z.boolean().optional(),\n  // Follow-up needed\n  suiviNecessaire: z.boolean().optional(),\n  // Timestamp for session tracking\n  lastUpdated: z.string().optional(),\n});\n\nexport type SessionState = z.infer<typeof sessionStateSchema>;\n\n// Feedback table for anonymous user feedback\nexport const feedbacks = pgTable(\"feedbacks\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  rating: integer(\"rating\").notNull(), // 1-5\n  helpfulAspect: text(\"helpful_aspect\"),\n  improvementSuggestion: text(\"improvement_suggestion\"),\n  archived: boolean(\"archived\").default(false).notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertFeedbackSchema = createInsertSchema(feedbacks).omit({\n  id: true,\n  archived: true,\n  createdAt: true,\n});\n\nexport type InsertFeedback = z.infer<typeof insertFeedbackSchema>;\nexport type Feedback = typeof feedbacks.$inferSelect;\n\n// Flow configuration\nexport type FlowType = 'solo' | 'duo';\n\nexport interface FlowConfig {\n  type: FlowType;\n  label: string;\n  progressColor: string; // CSS color for progress indicator\n  pages: ReadonlyArray<{\n    id: number;\n    path: string;\n    section: number;\n  }>;\n}\n\n// Solo flow configuration\nexport const soloFlow: FlowConfig = {\n  type: 'solo',\n  label: 'Régulation émotionnelle',\n  progressColor: 'hsl(0, 84%, 60%)', // Red for solo\n  pages: [\n    { id: 0, path: \"/welcome\", section: 0 },\n    { id: 1, path: \"/solo/roles\", section: 0 },\n    { id: 2, path: \"/solo/warnings\", section: 0 },\n    { id: 3, path: \"/solo/intention\", section: 1 },\n    { id: 4, path: \"/solo/sender-grounding\", section: 1 },\n    { id: 5, path: \"/solo/receiver-grounding\", section: 1 },\n    { id: 6, path: \"/solo/transition-1\", section: 1 },\n    { id: 7, path: \"/solo/sender-situation\", section: 2 },\n    { id: 8, path: \"/solo/sender-experience\", section: 2 },\n    { id: 9, path: \"/solo/sender-interpretation\", section: 2 },\n    { id: 10, path: \"/solo/sender-impact\", section: 2 },\n    { id: 11, path: \"/solo/sender-summary\", section: 2 },\n    { id: 12, path: \"/solo/receiver-validation\", section: 3 },\n    { id: 13, path: \"/solo/sender-confirmation\", section: 3 },\n    { id: 14, path: \"/solo/sender-clarification\", section: 3 },\n    { id: 15, path: \"/solo/receiver-experience\", section: 4 },\n    { id: 16, path: \"/solo/sender-validation\", section: 5 },\n    { id: 17, path: \"/solo/receiver-confirmation\", section: 5 },\n    { id: 18, path: \"/solo/transition-2\", section: 5 },\n    { id: 19, path: \"/solo/sender-needs\", section: 6 },\n    { id: 20, path: \"/solo/receiver-response\", section: 6 },\n    { id: 21, path: \"/solo/transition-3\", section: 6 },\n    { id: 22, path: \"/solo/sender-closing\", section: 7 },\n    { id: 23, path: \"/solo/receiver-closing\", section: 7 },\n    { id: 24, path: \"/solo/thanks\", section: 7 },\n    { id: 25, path: \"/solo/feedback\", section: 7 },\n    { id: 26, path: \"/solo/completion\", section: 7 },\n  ],\n};\n\n// Duo flow configuration\nexport const duoFlow: FlowConfig = {\n  type: 'duo',\n  label: 'Communication authentique',\n  progressColor: 'hsl(221, 83%, 53%)', // Blue for duo\n  pages: [\n    { id: 0, path: \"/welcome\", section: 0 },\n    { id: 1, path: \"/duo/roles\", section: 0 },\n    { id: 2, path: \"/duo/warnings\", section: 0 },\n    { id: 3, path: \"/duo/intention\", section: 1 },\n    { id: 4, path: \"/duo/sender-grounding\", section: 1 },\n    { id: 5, path: \"/duo/receiver-grounding\", section: 1 },\n    { id: 6, path: \"/duo/transition-1\", section: 1 },\n    { id: 7, path: \"/duo/sender-situation\", section: 2 },\n    { id: 8, path: \"/duo/sender-experience\", section: 2 },\n    { id: 9, path: \"/duo/sender-interpretation\", section: 2 },\n    { id: 10, path: \"/duo/sender-impact\", section: 2 },\n    { id: 11, path: \"/duo/sender-summary\", section: 2 },\n    { id: 12, path: \"/duo/receiver-validation\", section: 3 },\n    { id: 13, path: \"/duo/sender-confirmation\", section: 3 },\n    { id: 14, path: \"/duo/receiver-experience\", section: 4 },\n    { id: 15, path: \"/duo/sender-validation\", section: 5 },\n    { id: 16, path: \"/duo/receiver-confirmation\", section: 5 },\n    { id: 17, path: \"/duo/transition-2\", section: 5 },\n    { id: 18, path: \"/duo/sender-needs\", section: 6 },\n    { id: 19, path: \"/duo/receiver-response\", section: 6 },\n    { id: 20, path: \"/duo/transition-3\", section: 6 },\n    { id: 21, path: \"/duo/sender-closing\", section: 7 },\n    { id: 22, path: \"/duo/receiver-closing\", section: 7 },\n    { id: 23, path: \"/duo/feedback\", section: 7 },\n    { id: 24, path: \"/duo/completion\", section: 7 },\n    // Parcours inversé (7a-20a)\n    { id: 25, path: \"/duo/inversion-des-roles/page-7a\", section: 2 },\n    { id: 26, path: \"/duo/inversion-des-roles/page-8a\", section: 2 },\n    { id: 27, path: \"/duo/inversion-des-roles/page-9a\", section: 2 },\n    { id: 28, path: \"/duo/inversion-des-roles/page-10a\", section: 2 },\n    { id: 29, path: \"/duo/inversion-des-roles/page-11a\", section: 2 },\n    { id: 30, path: \"/duo/inversion-des-roles/page-12a\", section: 3 },\n    { id: 31, path: \"/duo/inversion-des-roles/page-13a\", section: 3 },\n    { id: 32, path: \"/duo/inversion-des-roles/page-14a\", section: 4 },\n    { id: 33, path: \"/duo/inversion-des-roles/page-15a\", section: 5 },\n    { id: 34, path: \"/duo/inversion-des-roles/page-16a\", section: 5 },\n    { id: 35, path: \"/duo/inversion-des-roles/page-17a\", section: 5 },\n    { id: 36, path: \"/duo/inversion-des-roles/page-18a\", section: 6 },\n    { id: 37, path: \"/duo/inversion-des-roles/page-19a\", section: 6 },\n    { id: 38, path: \"/duo/inversion-des-roles/page-20a\", section: 6 },\n  ],\n};\n\n// Helper to get flow configuration\nexport function getFlow(appType?: FlowType): FlowConfig {\n  return appType === 'solo' ? soloFlow : duoFlow;\n}\n\n// Legacy pages export for backward compatibility (defaults to duo)\nexport const pages = duoFlow.pages;\n\nexport const sectionNames = [\n  \"Bienvenue\",\n  \"Mettre la table\",\n  \"Le vif du sujet - Émetteur\",\n  \"Récepteur - Valider l'émetteur\",\n  \"Ce que vit le récepteur\",\n  \"Valider le récepteur\",\n  \"Demande et besoin\",\n  \"Clôture\",\n] as const;\n","path":null,"size_bytes":11931,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    value={value}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full bg-primary\"\n      style={{ width: `${value || 0}%` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":755,"size_tokens":null},"server/index-dev.ts":{"content":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { type Server } from \"node:http\";\n\nimport { nanoid } from \"nanoid\";\nimport { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\n\nimport viteConfig from \"../vite.config\";\nimport runApp from \"./app\";\n\nexport async function setupVite(app: Express, server: Server) {\n  const viteLogger = createLogger();\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\n(async () => {\n  await runApp(setupVite);\n})();\n","path":null,"size_bytes":1609,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/pin-creation-form.tsx":{"content":"import { useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useMutation } from '@tanstack/react-query';\nimport { Lock, Eye, EyeOff, Check } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { apiRequest } from '@/lib/queryClient';\n\nconst pinSchema = z.object({\n  pin: z.string()\n    .regex(/^\\d{4,6}$/, 'Le NIP doit contenir 4 à 6 chiffres'),\n  confirmPin: z.string()\n    .regex(/^\\d{4,6}$/, 'Le NIP doit contenir 4 à 6 chiffres'),\n}).refine((data) => data.pin === data.confirmPin, {\n  message: 'Les NIP ne correspondent pas',\n  path: ['confirmPin'],\n});\n\ntype PinFormData = z.infer<typeof pinSchema>;\n\ninterface PinCreationFormProps {\n  userName: string;\n  userEmail: string;\n  publicUid: string;\n  validationToken: string;\n  onSuccess: (sessionToken: string, userId: string, isAdmin?: boolean) => void;\n  onError: (message: string) => void;\n}\n\nexport function PinCreationForm({ userName, userEmail, publicUid, validationToken, onSuccess, onError }: PinCreationFormProps) {\n  const [showPin, setShowPin] = useState(false);\n  const [showConfirmPin, setShowConfirmPin] = useState(false);\n\n  const form = useForm<PinFormData>({\n    resolver: zodResolver(pinSchema),\n    defaultValues: {\n      pin: '',\n      confirmPin: '',\n    },\n  });\n\n  const createPinMutation = useMutation({\n    mutationFn: async (data: PinFormData) => {\n      const response = await apiRequest('POST', '/api/auth/create-pin', {\n        email: userEmail,\n        public_uid: publicUid,\n        name: userName,\n        pin: data.pin,\n        validation_token: validationToken, // CRITICAL: Security token from /api/auth/validate\n      });\n      return await response.json();\n    },\n    onSuccess: (result) => {\n      if (result.success) {\n        onSuccess(result.session_token, result.user_id, result.is_admin);\n      }\n    },\n    onError: (error: Error) => {\n      onError(error.message || 'Erreur lors de la création du NIP');\n    },\n  });\n\n  const onSubmit = (data: PinFormData) => {\n    createPinMutation.mutate(data);\n  };\n\n  const pinValue = form.watch('pin');\n  const confirmPinValue = form.watch('confirmPin');\n  const pinsMatch = pinValue && confirmPinValue && pinValue === confirmPinValue;\n\n  return (\n    <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-pin-creation\">\n      <CardHeader className=\"space-y-3 pb-6\">\n        <div className=\"flex items-center justify-center w-12 h-12 mx-auto rounded-full bg-primary/10\">\n          <Lock className=\"h-6 w-6 text-primary\" />\n        </div>\n        <CardTitle className=\"text-2xl font-semibold text-center\">\n          Bienvenue, {userName.split(' ')[0]} !\n        </CardTitle>\n        <CardDescription className=\"text-center text-base\">\n          Créez un NIP de 4 à 6 chiffres pour sécuriser votre compte\n        </CardDescription>\n      </CardHeader>\n      \n      <CardContent>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <div className=\"space-y-4\">\n            {/* PIN Input */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"pin\" className=\"text-base font-medium\">\n                Nouveau NIP <span className=\"text-destructive\">*</span>\n              </Label>\n              <div className=\"relative\">\n                <Input\n                  {...form.register('pin')}\n                  id=\"pin\"\n                  type={showPin ? 'text' : 'password'}\n                  inputMode=\"numeric\"\n                  maxLength={6}\n                  placeholder=\"Entrez 4-6 chiffres\"\n                  className=\"h-12 pr-10 text-base\"\n                  disabled={createPinMutation.isPending}\n                  data-testid=\"input-pin\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPin(!showPin)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors\"\n                  data-testid=\"button-toggle-pin-visibility\"\n                >\n                  {showPin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                </button>\n              </div>\n              {form.formState.errors.pin && (\n                <p className=\"text-sm text-destructive\" data-testid=\"text-pin-error\">\n                  {form.formState.errors.pin.message}\n                </p>\n              )}\n            </div>\n\n            {/* Confirm PIN Input */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"confirmPin\" className=\"text-base font-medium\">\n                Confirmer le NIP <span className=\"text-destructive\">*</span>\n              </Label>\n              <div className=\"relative\">\n                <Input\n                  {...form.register('confirmPin')}\n                  id=\"confirmPin\"\n                  type={showConfirmPin ? 'text' : 'password'}\n                  inputMode=\"numeric\"\n                  maxLength={6}\n                  placeholder=\"Confirmez votre NIP\"\n                  className=\"h-12 pr-10 text-base\"\n                  disabled={createPinMutation.isPending}\n                  data-testid=\"input-confirm-pin\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowConfirmPin(!showConfirmPin)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors\"\n                  data-testid=\"button-toggle-confirm-pin-visibility\"\n                >\n                  {showConfirmPin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                </button>\n                {pinsMatch && confirmPinValue.length >= 4 && (\n                  <div className=\"absolute right-10 top-1/2 -translate-y-1/2\">\n                    <Check className=\"h-4 w-4 text-success\" />\n                  </div>\n                )}\n              </div>\n              {form.formState.errors.confirmPin && (\n                <p className=\"text-sm text-destructive\" data-testid=\"text-confirm-pin-error\">\n                  {form.formState.errors.confirmPin.message}\n                </p>\n              )}\n            </div>\n          </div>\n\n          <Alert className=\"bg-muted border-border\">\n            <AlertDescription className=\"text-sm\">\n              <strong>Conseil de sécurité :</strong> Choisissez un NIP que vous pourrez mémoriser facilement, \n              mais qui ne soit pas évident (évitez 1234, votre année de naissance, etc.)\n            </AlertDescription>\n          </Alert>\n\n          <Button\n            type=\"submit\"\n            className=\"w-full h-12 text-base font-semibold\"\n            disabled={createPinMutation.isPending || !form.formState.isValid}\n            data-testid=\"button-create-pin\"\n          >\n            {createPinMutation.isPending ? 'Création en cours...' : 'Créer mon NIP'}\n          </Button>\n        </form>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":7302,"size_tokens":null},"server/middleware.ts":{"content":"import jwt from 'jsonwebtoken';\nimport bcrypt from 'bcrypt';\nimport { Request, Response, NextFunction } from 'express';\nimport rateLimit from 'express-rate-limit';\n\n// Use SESSION_SECRET in production (Cloud Run), fallback to JWT_SECRET for backwards compatibility\nconst SESSION_SECRET = process.env.SESSION_SECRET || process.env.JWT_SECRET || 'development-secret-change-in-production';\nconst BCRYPT_ROUNDS = 10;\n\nexport interface JWTPayload {\n  userId: string;\n  email: string;\n}\n\nexport function generateSessionToken(userId: string, email: string): string {\n  return jwt.sign(\n    { userId, email } as JWTPayload,\n    SESSION_SECRET,\n    { expiresIn: '60m' }\n  );\n}\n\nexport function verifySessionToken(token: string): JWTPayload | null {\n  try {\n    const payload = jwt.verify(token, SESSION_SECRET) as JWTPayload;\n    return payload;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport async function hashPin(pin: string): Promise<string> {\n  return bcrypt.hash(pin, BCRYPT_ROUNDS);\n}\n\nexport async function comparePin(pin: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(pin, hash);\n}\n\nexport interface CircleUserData {\n  publicUid: string;\n  email: string;\n  name: string;\n  firstName?: string;\n  lastName?: string;\n  isAdmin?: boolean;\n  timestamp: number;\n}\n\nexport interface ValidationResult {\n  valid: boolean;\n  error?: string;\n}\n\nexport function validateUserData(data: CircleUserData): ValidationResult {\n  console.log('[VALIDATE] Received data:', JSON.stringify(data, null, 2));\n  \n  // Check if email is provided\n  if (!data.email || typeof data.email !== 'string' || data.email.trim().length === 0) {\n    console.log('[VALIDATE] Email missing or empty:', data.email);\n    return { valid: false, error: 'Email non reçu de Circle.so. Veuillez actualiser la page dans Circle.so.' };\n  }\n  \n  // Normalize email\n  const email = data.email.trim().toLowerCase();\n  \n  // Check if Liquid template was not replaced (Circle.so issue)\n  if (email.includes('{{') || email.includes('}}') || email.includes('member.')) {\n    console.log('[VALIDATE] Liquid template not replaced:', email);\n    return { valid: false, error: 'Données Circle.so non chargées. Veuillez vous reconnecter à Circle.so.' };\n  }\n  \n  data.email = email;\n  \n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  if (!emailRegex.test(email)) {\n    console.log('[VALIDATE] Email regex failed for:', email);\n    return { valid: false, error: 'Format d\\'email invalide. Veuillez vous reconnecter à Circle.so.' };\n  }\n\n  // publicUid is optional - Circle.so may not always provide it\n  // Generate a fallback from email if missing\n  if (!data.publicUid || typeof data.publicUid !== 'string' || data.publicUid.trim().length === 0) {\n    data.publicUid = `circle_${data.email.replace(/[^a-z0-9]/gi, '_')}`;\n  }\n\n  // Accept any name, use default if empty\n  if (!data.name || data.name.trim().length === 0) {\n    data.name = 'Membre';\n  }\n\n  // Timestamp validation - be lenient\n  if (!data.timestamp) {\n    data.timestamp = Date.now();\n  }\n  \n  const now = Date.now();\n  const timestampAge = now - data.timestamp;\n  // Allow up to 5 minutes (300000ms) for clock skew\n  if (timestampAge > 300000 || timestampAge < -60000) {\n    return { valid: false, error: 'Token expiré ou invalide' };\n  }\n\n  return { valid: true };\n}\n\nexport const pinRateLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 5,\n  message: { error: 'Trop de tentatives. Veuillez réessayer dans 15 minutes.' },\n  standardHeaders: true,\n  legacyHeaders: false,\n  ipv6Subnet: 64, // IPv6 subnet masking for proper rate limiting\n});\n\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  const authHeader = req.headers.authorization;\n  \n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\n    return res.status(401).json({ error: 'Non autorisé' });\n  }\n\n  const token = authHeader.substring(7);\n  const payload = verifySessionToken(token);\n\n  if (!payload) {\n    return res.status(401).json({ error: 'Session invalide ou expirée' });\n  }\n\n  (req as any).user = payload;\n  next();\n}\n","path":null,"size_bytes":4075,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"CIRCLE_INTEGRATION.md":{"content":"# Guide d'intégration Circle.so\n\nCe guide explique comment intégrer votre webapp Replit dans Circle.so avec le système d'authentification sécurisé.\n\n## 📋 Prérequis\n\n- Un espace Circle.so (forfait Professional ou supérieur recommandé)\n- Votre webapp Replit déployée et accessible via une URL publique (`https://votre-app.replit.app`)\n- Accès aux paramètres de votre espace Circle.so\n\n## 🔧 Configuration Circle.so\n\n### Étape 1 : Protéger vos pages\n\n1. Connectez-vous à votre espace Circle.so\n2. Allez dans **Settings → Privacy → Pages**\n3. Sélectionnez la page qui contiendra l'iframe de votre webapp\n4. Activez l'option **\"Members Only\"** pour cette page\n5. Sauvegardez les modifications\n\n> ⚠️ **Important** : Sans cette protection, n'importe qui pourrait accéder à votre webapp, même les non-membres.\n\n### Étape 2 : Ajouter le code JavaScript de transmission\n\n1. Allez dans **Settings → Custom Code**\n2. Sélectionnez l'onglet **\"Header\"** (ou \"Footer\" selon votre préférence)\n3. Ajoutez le code suivant :\n\n```javascript\nwindow.addEventListener('load', function() {\n  // Sélectionner l'iframe de votre webapp\n  // Adaptez le sélecteur selon votre URL Replit\n  const iframe = document.querySelector('iframe[src*=\"votre-app.replit.app\"]');\n  \n  // Vérifier périodiquement si circleUser est disponible\n  const checkUser = setInterval(function() {\n    if (window.circleUser && iframe) {\n      clearInterval(checkUser);\n      \n      // Préparer les données utilisateur\n      const userData = {\n        type: 'CIRCLE_USER_AUTH',\n        user: {\n          id: window.circleUser.id,\n          email: window.circleUser.email,\n          name: window.circleUser.name,\n          first_name: window.circleUser.first_name,\n          last_name: window.circleUser.last_name,\n          timestamp: Date.now()\n        }\n      };\n      \n      // Envoyer via postMessage à l'iframe\n      // ⚠️ IMPORTANT : Remplacer par votre URL Replit exacte\n      iframe.contentWindow.postMessage(\n        userData, \n        'https://votre-app.replit.app'\n      );\n      \n      console.log('✅ Données utilisateur envoyées à l\\'iframe');\n    }\n  }, 100); // Vérifier toutes les 100ms\n});\n```\n\n4. **Remplacez** `votre-app.replit.app` par votre URL Replit **exacte**\n5. Sauvegardez les modifications\n\n### Étape 3 : Intégrer l'iframe dans votre page\n\n1. Créez ou éditez la page Circle.so où vous voulez afficher votre webapp\n2. Passez en mode **\"Edit Page\"** ou **\"HTML/Embed\"**\n3. Ajoutez le code HTML suivant :\n\n```html\n<iframe \n  src=\"https://votre-app.replit.app\" \n  width=\"100%\" \n  height=\"800\" \n  frameborder=\"0\"\n  style=\"border: none; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\"\n  allow=\"clipboard-write\"\n></iframe>\n```\n\n4. **Personnalisez** selon vos besoins :\n   - `width` : Largeur de l'iframe (100% recommandé)\n   - `height` : Hauteur en pixels (ajustez selon votre contenu)\n   - `style` : Styles CSS personnalisés\n\n5. Sauvegardez la page\n\n## ⚙️ Configuration Replit\n\n### Variables d'environnement requises\n\nDans votre Replit, configurez ces variables d'environnement :\n\n```bash\n# URL exacte de votre espace Circle.so (sans trailing slash)\nVITE_CIRCLE_ORIGIN=https://votre-espace.circle.so\n\n# Mode développement (mettre à false en production)\nVITE_DEV_MODE=false\n\n# Secret JWT (générer une chaîne aléatoire longue)\nJWT_SECRET=votre_secret_jwt_très_long_et_complexe_ici\n\n# URL de la base de données\nDATABASE_URL=postgresql://user:password@host:port/database\n```\n\n### Comment ajouter les variables dans Replit :\n\n1. Ouvrez votre Replit\n2. Cliquez sur l'onglet **\"Secrets\"** (icône de cadenas) dans le panneau de gauche\n3. Ajoutez chaque variable :\n   - **Key** : Nom de la variable (ex: `VITE_CIRCLE_ORIGIN`)\n   - **Value** : Valeur correspondante\n4. Cliquez sur **\"Add new secret\"** pour chaque variable\n\n## 🧪 Test de l'intégration\n\n### Test en mode développement (local)\n\n1. Dans Replit, définissez `VITE_DEV_MODE=true`\n2. Lancez votre application\n3. Vous verrez un badge **\"MODE DÉVELOPPEMENT\"** en haut à droite\n4. L'authentification Circle.so est bypassée (utilisateur mock)\n5. Testez la création de NIP et la connexion\n\n### Test en production (avec Circle.so)\n\n1. Définissez `VITE_DEV_MODE=false`\n2. Déployez votre application Replit\n3. Sur Circle.so :\n   - Connectez-vous en tant que membre\n   - Accédez à la page contenant l'iframe\n   - Vérifiez dans la console du navigateur (F12) :\n     ```\n     ✅ Circle.so user data received\n     ```\n4. Première connexion :\n   - Vous devriez voir le formulaire \"Créer un NIP\"\n   - Créez votre NIP (4-6 chiffres)\n   - Vous êtes redirigé vers le dashboard\n5. Reconnexions suivantes :\n   - Vous voyez le formulaire \"Connexion\"\n   - Entrez votre NIP\n   - Accès au dashboard\n\n## 🔍 Dépannage\n\n### Problème : \"Origine non autorisée\" dans la console\n\n**Solution :**\n- Vérifiez que `VITE_CIRCLE_ORIGIN` dans Replit correspond **exactement** à votre URL Circle.so\n- Assurez-vous qu'il n'y a **pas de trailing slash** (`/`) à la fin\n- Redéployez l'application après modification\n\n### Problème : L'iframe ne reçoit pas les données\n\n**Solution :**\n1. Vérifiez dans la console Circle.so (F12) :\n   - Y a-t-il le message \"✅ Données utilisateur envoyées à l'iframe\" ?\n2. Si non, vérifiez :\n   - Que `window.circleUser` est disponible (tapez dans la console)\n   - Que le sélecteur d'iframe est correct dans le code JavaScript\n3. Dans le code JavaScript Circle.so, remplacez le sélecteur par :\n   ```javascript\n   const iframe = document.querySelector('iframe');\n   ```\n\n### Problème : \"Token expiré\" lors de la validation\n\n**Solution :**\n- Le timestamp a plus de 60 secondes (protection anti-replay)\n- Rechargez la page Circle.so\n- Si le problème persiste, augmentez la limite dans le backend (déconseillé pour la sécurité)\n\n### Problème : Rate limiting (trop de tentatives)\n\n**Solution :**\n- Attendez 15 minutes avant de réessayer\n- En développement, vous pouvez redémarrer le serveur pour réinitialiser\n- En production, c'est une protection normale contre le brute force\n\n### Problème : L'iframe ne s'affiche pas\n\n**Solution :**\n1. Vérifiez que votre Replit est bien déployé et accessible publiquement\n2. Testez l'URL directement dans votre navigateur\n3. Vérifiez les paramètres CSP (Content Security Policy) de Circle.so\n4. Essayez de désactiver temporairement les bloqueurs de pub/scripts\n\n## 🔒 Vérification de sécurité\n\n### Checklist avant la mise en production :\n\n- [ ] Pages Circle.so configurées en \"Members Only\"\n- [ ] `VITE_CIRCLE_ORIGIN` correctement configuré dans Replit\n- [ ] `VITE_DEV_MODE=false` en production\n- [ ] `JWT_SECRET` est une chaîne longue et aléatoire (min 32 caractères)\n- [ ] HTTPS activé (automatique sur Replit)\n- [ ] Code JavaScript Circle.so utilise l'URL exacte de votre Replit\n- [ ] Test de connexion réussi avec un compte membre\n- [ ] Test de rate limiting (5 tentatives échouées)\n- [ ] Session expire bien après 60 minutes d'inactivité\n\n## 📞 Support\n\nSi vous rencontrez des problèmes :\n\n1. **Vérifiez la console du navigateur** (F12) pour les erreurs JavaScript\n2. **Vérifiez les logs Replit** pour les erreurs backend\n3. **Testez en mode DEV** pour isoler le problème\n4. **Consultez** `replit.md` pour la documentation technique complète\n\n## 🎯 Ressources\n\n- [Documentation Circle.so - Custom Code](https://community.circle.so/c/platform-updates/)\n- [Documentation Replit - Deployment](https://docs.replit.com/hosting/deployments/about-deployments)\n- [Guide de sécurité - Defense in Depth](https://www.fortinet.com/resources/cyberglossary/defense-in-depth)\n\n---\n\n**Félicitations !** Votre webapp est maintenant intégrée de manière sécurisée dans Circle.so. 🎉\n","path":null,"size_bytes":7791,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"server/storage.ts":{"content":"import { type User, type InsertUser, type LoginAttempt, type InsertLoginAttempt, type AppConfig, type PaidMember, type InsertPaidMember, type Feedback, type InsertFeedback, users, loginAttempts, appConfig, paidMembers, feedbacks } from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport { drizzle } from \"drizzle-orm/neon-serverless\";\nimport { eq, and, gt } from \"drizzle-orm\";\nimport { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport ws from \"ws\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByPublicUid(publicUid: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserLastLogin(userId: string): Promise<void>;\n  updateUserRole(userId: string, isAdmin: boolean): Promise<void>;\n  updateUserPublicUid(userId: string, publicUid: string): Promise<void>;\n  updateUserPin(userId: string, pinHash: string | null): Promise<void>;\n  deleteUser(userId: string): Promise<void>;\n\n  // Login attempt operations\n  logLoginAttempt(attempt: InsertLoginAttempt): Promise<LoginAttempt>;\n  getRecentLoginAttempts(userId: string, windowMs: number): Promise<LoginAttempt[]>;\n\n  // App config operations\n  getAppConfig(): Promise<AppConfig>;\n  updateAppConfig(config: Partial<Omit<AppConfig, 'id' | 'updatedAt'>>): Promise<AppConfig>;\n\n  // Paid members operations\n  getPaidMemberByEmail(email: string): Promise<PaidMember | undefined>;\n  createPaidMember(member: InsertPaidMember): Promise<PaidMember>;\n  getAllPaidMembers(): Promise<PaidMember[]>;\n  deletePaidMember(email: string): Promise<void>;\n\n  // Feedback operations\n  createFeedback(feedback: InsertFeedback): Promise<Feedback>;\n  getAllFeedbacks(): Promise<Feedback[]>;\n  getArchivedFeedbacks(): Promise<Feedback[]>;\n  archiveFeedback(id: string): Promise<void>;\n  unarchiveFeedback(id: string): Promise<void>;\n  deleteFeedback(id: string): Promise<void>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User>;\n  private loginAttempts: Map<string, LoginAttempt>;\n  private paidMembersMap: Map<string, PaidMember>;\n  private feedbacks: Map<string, Feedback>;\n  private configState: AppConfig;\n\n  constructor() {\n    this.users = new Map();\n    this.loginAttempts = new Map();\n    this.paidMembersMap = new Map();\n    this.feedbacks = new Map();\n    this.configState = {\n      id: \"main\",\n      requireCircleDomain: true,\n      requireCircleLogin: true,\n      requirePaywall: false,\n      requirePin: true,\n      paywallPurchaseUrl: \"\",\n      paywallInfoUrl: \"\",\n      paywallTitle: \"Accès Réservé\",\n      paywallMessage: \"Cette application est réservée aux membres ayant souscrit à l'offre.\",\n      webhookAppUrl: \"\",\n      environment: \"development\", // Added environment here\n      updatedAt: new Date(),\n    };\n\n    // Seed admin user\n    this.createUser({\n      email: \"fastusone@gmail.com\",\n      pinHash: \"$2b$10$FKDhHfgZhXVQWeeDzl1q0Oz9DYDoRkoG3bmQYfR2ERaWfnKSbMUy6\",\n      isAdmin: true,\n      name: \"Admin Fastus\",\n      publicUid: \"admin-fastus\",\n    }).then(() => {\n      console.log(\"Admin user seeded: fastusone@gmail.com\");\n    });\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.email === email,\n    );\n  }\n\n  async getUserByPublicUid(publicUid: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.publicUid === publicUid,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const now = new Date();\n    const user: User = {\n      ...insertUser,\n      id,\n      pinHash: insertUser.pinHash ?? null,\n      isAdmin: insertUser.isAdmin ?? false,\n      createdAt: now,\n      lastLogin: null,\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async updateUserLastLogin(userId: string): Promise<void> {\n    const user = this.users.get(userId);\n    if (user) {\n      user.lastLogin = new Date();\n      this.users.set(userId, user);\n    }\n  }\n\n  async updateUserRole(userId: string, isAdmin: boolean): Promise<void> {\n    const user = this.users.get(userId);\n    if (user) {\n      user.isAdmin = isAdmin;\n      this.users.set(userId, user);\n    }\n  }\n\n  async updateUserPublicUid(userId: string, publicUid: string): Promise<void> {\n    const user = this.users.get(userId);\n    if (user) {\n      user.publicUid = publicUid;\n      this.users.set(userId, user);\n    }\n  }\n\n  async updateUserPin(userId: string, pinHash: string | null): Promise<void> {\n    const user = this.users.get(userId);\n    if (user) {\n      user.pinHash = pinHash;\n      this.users.set(userId, user);\n    }\n  }\n\n  async deleteUser(userId: string): Promise<void> {\n    this.users.delete(userId);\n    Array.from(this.loginAttempts.entries()).forEach(([id, attempt]) => {\n      if (attempt.userId === userId) {\n        this.loginAttempts.delete(id);\n      }\n    });\n  }\n\n  async logLoginAttempt(attempt: InsertLoginAttempt): Promise<LoginAttempt> {\n    const id = randomUUID();\n    const loginAttempt: LoginAttempt = {\n      id,\n      userId: attempt.userId ?? null,\n      success: attempt.success,\n      ipAddress: attempt.ipAddress || null,\n      timestamp: new Date(),\n    };\n    this.loginAttempts.set(id, loginAttempt);\n    return loginAttempt;\n  }\n\n  async getRecentLoginAttempts(userId: string, windowMs: number): Promise<LoginAttempt[]> {\n    const cutoffTime = new Date(Date.now() - windowMs);\n    return Array.from(this.loginAttempts.values()).filter(\n      (attempt) => attempt.userId === userId && attempt.timestamp > cutoffTime,\n    );\n  }\n\n  async getAppConfig(): Promise<AppConfig> {\n    return this.configState;\n  }\n\n  async updateAppConfig(config: Partial<Omit<AppConfig, 'id' | 'updatedAt'>>): Promise<AppConfig> {\n    this.configState = {\n      ...this.configState,\n      ...config,\n      updatedAt: new Date(),\n    };\n    return this.configState;\n  }\n\n  async getPaidMemberByEmail(email: string): Promise<PaidMember | undefined> {\n    return this.paidMembersMap.get(email.toLowerCase());\n  }\n\n  async createPaidMember(member: InsertPaidMember): Promise<PaidMember> {\n    const id = randomUUID();\n    const paidMember: PaidMember = {\n      id,\n      email: member.email.toLowerCase(),\n      paymentDate: new Date(),\n      paymentPlan: member.paymentPlan ?? null,\n      amountPaid: member.amountPaid ?? null,\n      couponUsed: member.couponUsed ?? null,\n    };\n    this.paidMembersMap.set(paidMember.email, paidMember);\n    return paidMember;\n  }\n\n  async getAllPaidMembers(): Promise<PaidMember[]> {\n    return Array.from(this.paidMembersMap.values());\n  }\n\n  async deletePaidMember(email: string): Promise<void> {\n    this.paidMembersMap.delete(email.toLowerCase());\n  }\n\n\n\n\n  async createFeedback(insertFeedback: InsertFeedback): Promise<Feedback> {\n    const id = randomUUID();\n    const feedback: Feedback = {\n      id,\n      rating: insertFeedback.rating,\n      helpfulAspect: insertFeedback.helpfulAspect ?? null,\n      improvementSuggestion: insertFeedback.improvementSuggestion ?? null,\n      archived: false,\n      createdAt: new Date(),\n    };\n    this.feedbacks.set(id, feedback);\n    return feedback;\n  }\n\n  async getAllFeedbacks(): Promise<Feedback[]> {\n    return Array.from(this.feedbacks.values()).filter(f => !f.archived);\n  }\n\n  async getArchivedFeedbacks(): Promise<Feedback[]> {\n    return Array.from(this.feedbacks.values()).filter(f => f.archived);\n  }\n\n  async archiveFeedback(id: string): Promise<void> {\n    const feedback = this.feedbacks.get(id);\n    if (feedback) {\n      feedback.archived = true;\n      this.feedbacks.set(id, feedback);\n    }\n  }\n\n  async unarchiveFeedback(id: string): Promise<void> {\n    const feedback = this.feedbacks.get(id);\n    if (feedback) {\n      feedback.archived = false;\n      this.feedbacks.set(id, feedback);\n    }\n  }\n\n  async deleteFeedback(id: string): Promise<void> {\n    this.feedbacks.delete(id);\n  }\n}\n\nexport class DbStorage implements IStorage {\n  private db;\n\n  constructor(databaseUrl: string) {\n    neonConfig.webSocketConstructor = ws;\n    const pool = new Pool({ connectionString: databaseUrl });\n    this.db = drizzle({ client: pool });\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await this.db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const result = await this.db.select().from(users).where(eq(users.email, email)).limit(1);\n    return result[0];\n  }\n\n  async getUserByPublicUid(publicUid: string): Promise<User | undefined> {\n    const result = await this.db.select().from(users).where(eq(users.publicUid, publicUid)).limit(1);\n    return result[0];\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const result = await this.db.insert(users).values(insertUser).returning();\n    return result[0];\n  }\n\n  async updateUserLastLogin(userId: string): Promise<void> {\n    await this.db.update(users)\n      .set({ lastLogin: new Date() })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserRole(userId: string, isAdmin: boolean): Promise<void> {\n    await this.db.update(users)\n      .set({ isAdmin })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserPublicUid(userId: string, publicUid: string): Promise<void> {\n    await this.db.update(users)\n      .set({ publicUid })\n      .where(eq(users.id, userId));\n  }\n\n  async updateUserPin(userId: string, pinHash: string | null): Promise<void> {\n    await this.db.update(users)\n      .set({ pinHash })\n      .where(eq(users.id, userId));\n  }\n\n  async deleteUser(userId: string): Promise<void> {\n    await this.db.delete(loginAttempts).where(eq(loginAttempts.userId, userId));\n    await this.db.delete(users).where(eq(users.id, userId));\n  }\n\n  async logLoginAttempt(attempt: InsertLoginAttempt): Promise<LoginAttempt> {\n    const result = await this.db.insert(loginAttempts).values(attempt).returning();\n    return result[0];\n  }\n\n  async getRecentLoginAttempts(userId: string, windowMs: number): Promise<LoginAttempt[]> {\n    const cutoffTime = new Date(Date.now() - windowMs);\n    return await this.db.select().from(loginAttempts)\n      .where(\n        and(\n          eq(loginAttempts.userId, userId),\n          gt(loginAttempts.timestamp, cutoffTime)\n        )\n      );\n  }\n\n  async getAppConfig(): Promise<AppConfig> {\n    const result = await this.db.select().from(appConfig).where(eq(appConfig.id, \"main\")).limit(1);\n    if (result[0]) {\n      return result[0];\n    }\n    try {\n      const newConfig = await this.db.insert(appConfig).values({ id: \"main\" }).returning();\n      return newConfig[0];\n    } catch (error: any) {\n      if (error.code === '23505') {\n        const retry = await this.db.select().from(appConfig).where(eq(appConfig.id, \"main\")).limit(1);\n        if (retry[0]) return retry[0];\n      }\n      throw error;\n    }\n  }\n\n  async updateAppConfig(config: Partial<Omit<AppConfig, 'id' | 'updatedAt'>>): Promise<AppConfig> {\n    const result = await this.db.update(appConfig)\n      .set({\n        ...config,\n        updatedAt: new Date()\n      })\n      .where(eq(appConfig.id, \"main\"))\n      .returning();\n    return result[0];\n  }\n\n  async getPaidMemberByEmail(email: string): Promise<PaidMember | undefined> {\n    const result = await this.db.select().from(paidMembers)\n      .where(eq(paidMembers.email, email.toLowerCase()))\n      .limit(1);\n    return result[0];\n  }\n\n  async createPaidMember(member: InsertPaidMember): Promise<PaidMember> {\n    const result = await this.db.insert(paidMembers).values({\n      ...member,\n      email: member.email.toLowerCase(),\n    }).returning();\n    return result[0];\n  }\n\n  async getAllPaidMembers(): Promise<PaidMember[]> {\n    return await this.db.select().from(paidMembers);\n  }\n\n  async deletePaidMember(email: string): Promise<void> {\n    await this.db.delete(paidMembers).where(eq(paidMembers.email, email.toLowerCase()));\n  }\n\n\n\n\n  async createFeedback(insertFeedback: InsertFeedback): Promise<Feedback> {\n    const [feedback] = await this.db\n      .insert(feedbacks)\n      .values({\n        rating: insertFeedback.rating,\n        helpfulAspect: insertFeedback.helpfulAspect ?? null,\n        improvementSuggestion: insertFeedback.improvementSuggestion ?? null,\n      })\n      .returning();\n    return feedback;\n  }\n\n  async getAllFeedbacks(): Promise<Feedback[]> {\n    return await this.db.select().from(feedbacks)\n      .where(eq(feedbacks.archived, false))\n      .orderBy(feedbacks.createdAt);\n  }\n\n  async getArchivedFeedbacks(): Promise<Feedback[]> {\n    return await this.db.select().from(feedbacks)\n      .where(eq(feedbacks.archived, true))\n      .orderBy(feedbacks.createdAt);\n  }\n\n  async archiveFeedback(id: string): Promise<void> {\n    await this.db.update(feedbacks)\n      .set({ archived: true })\n      .where(eq(feedbacks.id, id));\n  }\n\n  async unarchiveFeedback(id: string): Promise<void> {\n    await this.db.update(feedbacks)\n      .set({ archived: false })\n      .where(eq(feedbacks.id, id));\n  }\n\n  async deleteFeedback(id: string): Promise<void> {\n    await this.db.delete(feedbacks).where(eq(feedbacks.id, id));\n  }\n}\n\n// Use database storage if DATABASE_URL is set, otherwise use memory storage\nconst databaseUrl = process.env.DATABASE_URL;\nexport const storage = databaseUrl && databaseUrl !== 'memory'\n  ? new DbStorage(databaseUrl)\n  : new MemStorage();\n","path":null,"size_bytes":13614,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"server/index-prod.ts":{"content":"import fs from \"node:fs\";\nimport path from \"node:path\";\nimport { type Server } from \"node:http\";\n\nimport express, { type Express } from \"express\";\nimport runApp from \"./app\";\n\nexport async function serveStatic(app: Express, _server: Server) {\n  const distPath = path.resolve(import.meta.dirname, \"..\", \"dist\", \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n\n(async () => {\n  await runApp(serveStatic);\n})();\n","path":null,"size_bytes":726,"size_tokens":null},"replit.md":{"content":"# Duo-Connecté - Guide de Communication et Régulation Émotionnelle\n\n## Vue d'ensemble\n\nApplication de guidance pour la communication authentique et la régulation émotionnelle, intégrée à Circle.so via iframe. L'application propose deux parcours guidés (Solo et Duo) avec une architecture de sécurité à 4 couches configurables.\n\n**Marque** : \"Avancer Simplement\"\n\n## Changements Récents\n\n- **2025-12-09** : Gestion membres améliorée - Deux options de suppression : \"Retirer l'accès payant\" ou \"Supprimer complètement\" (utilisateur + données)\n- **2025-12-09** : Correction bug NIP Layer 4 - Les utilisateurs créés sans NIP peuvent maintenant en créer un quand la couche 4 est activée\n- **2025-12-09** : Nouvel endpoint admin `/api/admin/reset-user-pin` pour réinitialiser le NIP d'un utilisateur\n- **2025-12-08** : **CORRECTION MAJEURE** - Script Circle.so v3 : utilise `window.circleUser` (fourni par Circle.so) au lieu de variables Liquid qui ne fonctionnent pas dans le JS\n- **2025-12-08** : Header retiré pour les utilisateurs non-admin, sélecteur de thème en bas, bouton maison supprimé\n- **2025-12-08** : Correction du statut admin en production (endpoint /api/debug/fix-admin)\n- **2025-12-08** : Ajout de JWT_SECRET en production pour les tokens de session\n\n## Fonctionnalités Principales\n\n### Deux Modes de Parcours\n\n1. **Mode Solo** - Régulation émotionnelle personnelle\n   - 27 étapes guidées\n   - Travail individuel sur ses émotions\n   - Couleur de progression : Rouge\n\n2. **Mode Duo** - Communication authentique à deux\n   - 39 étapes guidées (incluant le parcours inversé)\n   - Dialogue structuré entre émetteur et récepteur\n   - Couleur de progression : Bleu\n   - Possibilité d'inverser les rôles\n\n### Parcours Structuré en 8 Sections\n\n1. **Bienvenue** - Introduction et choix des rôles\n2. **Mettre la table** - Intention et ancrage\n3. **Le vif du sujet - Émetteur** - Situation, vécu, interprétation, impact\n4. **Récepteur - Valider l'émetteur** - Écoute et validation\n5. **Ce que vit le récepteur** - Expression du vécu du récepteur\n6. **Valider le récepteur** - Confirmation mutuelle\n7. **Demande et besoin** - Expression des besoins\n8. **Clôture** - Fermeture et feedback\n\n## Architecture de Sécurité\n\n### 4 Couches d'Authentification (Configurables via Dashboard Admin)\n\n| Couche | Nom | Description |\n|--------|-----|-------------|\n| 1 | Domaine Circle.so | Vérifie que l'app est dans l'iframe Circle.so |\n| 2 | Connexion Circle.so | Validation postMessage (email, publicUid, timestamp 60s max) |\n| 3 | Paywall | Vérifie si l'utilisateur a payé (sync via webhook Circle.so) |\n| 4 | NIP Personnel | 4-6 chiffres, bcrypt 10 rounds, rate limit 5/15min, JWT 60min |\n\n### Configuration via Dashboard Admin\n\nToutes les couches sont configurables via le Dashboard Admin (table `app_config`):\n- `requireCircleDomain` : Couche 1 ON/OFF\n- `requireCircleLogin` : Couche 2 ON/OFF\n- `requirePaywall` : Couche 3 ON/OFF (nécessite Couche 2 activée)\n- `requirePin` : Couche 4 ON/OFF\n\n## Stack Technique\n\n- **Frontend** : React 18, TypeScript, Wouter, TanStack Query v5, shadcn/ui, Tailwind CSS, Framer Motion\n- **Backend** : Node.js 20, Express, Drizzle ORM, PostgreSQL (Neon), JWT, bcrypt, express-rate-limit\n\n## Structure du Projet\n\n```\nclient/src/\n  components/\n    ui/              # Composants shadcn/ui\n    admin/           # Composants admin (AdminFeedbacks)\n    GlobalHeader.tsx # En-tête global avec navigation\n    ProgressBar.tsx  # Barre de progression du parcours\n    Checklist.tsx    # Listes de vérification interactives\n    logo.tsx         # Logo adaptatif (clair/sombre)\n  contexts/\n    SessionContext.tsx  # État de la session de conversation\n    AccessContext.tsx   # Gestion de l'accès et authentification Circle.so\n  hooks/\n    use-circle-auth.ts  # Hook pour l'authentification Circle.so\n    usePageTransition.ts # Transitions entre pages\n  pages/\n    Welcome.tsx         # Page d'accueil\n    Solo*.tsx           # Pages du parcours Solo (27 pages)\n    Duo*.tsx            # Pages du parcours Duo (25 pages)\n    DuoInversion*.tsx   # Pages du parcours inversé (14 pages)\n    PaywallScreen.tsx   # Écran de blocage paywall\n    auth.tsx            # Authentification\n    dashboard.tsx       # Dashboard admin\n  lib/\n    auth.ts           # Utilitaires d'authentification\n    queryClient.ts    # Configuration TanStack Query\n\nserver/\n  app.ts           # Express + CORS + trust proxy\n  routes.ts        # API endpoints\n  storage.ts       # Interface DB (MemStorage ou DbStorage)\n  middleware.ts    # JWT, bcrypt, rate limiting\n\nshared/\n  schema.ts        # Modèles Drizzle + Zod + Configuration des parcours\n```\n\n## Base de Données\n\n```sql\nusers: id, email, public_uid, name, pin_hash, is_admin, created_at, last_login\n\nlogin_attempts: id, user_id, success, ip_address, timestamp\n\napp_config: id, require_circle_domain, require_circle_login, require_paywall, require_pin, \n            paywall_purchase_url, paywall_info_url, paywall_title, paywall_message, \n            webhook_app_url, environment, updated_at\n\npaid_members: id, email (unique), payment_date, payment_plan, amount_paid, coupon_used\n\nfeedbacks: id, rating (1-5), helpful_aspect, improvement_suggestion, created_at\n```\n\n## API Endpoints\n\n### Authentification\n- `POST /api/auth/validate` - Valide données Circle.so\n- `POST /api/auth/create-pin` - Crée NIP avec validation_token\n- `POST /api/auth/create-user-no-pin` - Crée utilisateur sans NIP\n- `POST /api/auth/validate-pin` - Valide NIP (rate limited)\n- `GET /api/auth/me` - Infos utilisateur (protégé JWT)\n\n### Configuration\n- `GET /api/config` - Configuration des couches de sécurité\n- `PATCH /api/config` - Met à jour la configuration (admin)\n- `GET /api/settings` - Alias pour config (AccessContext)\n- `POST /api/check-access` - Vérifie l'accès utilisateur\n\n### Paywall & Membres\n- `POST /api/auth/check-paywall` - Vérifie accès membre payant\n- `POST /webhooks/circle-payment` - Webhook Circle.so paiements\n- `GET /api/admin/paid-members` - Liste membres payants (admin)\n- `POST /api/admin/paid-members` - Ajoute membre payant (admin)\n- `DELETE /api/admin/paid-members/:email` - Supprime membre (admin)\n\n### Feedback\n- `POST /api/feedback` - Soumet un feedback anonyme\n- `GET /api/admin/feedbacks` - Liste tous les feedbacks (admin)\n\n## Variables d'Environnement\n\n| Variable | Description |\n|----------|-------------|\n| DATABASE_URL | PostgreSQL Neon (auto-généré) |\n| SESSION_SECRET | Secret pour JWT (générer unique par app) |\n| VITE_CIRCLE_ORIGIN | Origine Circle.so (ex: https://communaute.avancersimplement.circle.so) |\n| WEBHOOK_SECRET | Secret pour sécuriser le webhook |\n\n## Gestion de Session\n\nL'état de la conversation est stocké dans `SessionContext` :\n\n```typescript\n{\n  senderName: string,      // Nom de l'émetteur\n  receiverName: string,    // Nom du récepteur\n  currentStep: number,     // Étape actuelle (0-38)\n  appType: 'solo' | 'duo', // Type de parcours\n  // Checklists pour validation des étapes\n  checklistSituation: boolean,\n  checklistVecu: boolean,\n  checklistInterpretation: boolean,\n  checklistImpact: boolean,\n  // Checklists parcours inversé\n  checklistVecuInverse: boolean,\n  checklistInterpretationInverse: boolean,\n  checklistImpactInverse: boolean,\n  // Suivi nécessaire\n  suiviNecessaire: boolean,\n}\n```\n\n## Branding \"Avancer Simplement\"\n\n### Logo\n- **Mode clair** : `logo-blue.png`\n- **Mode sombre** : `logo-white.png`\n\n### Typographie\n- Titres de marque : Montserrat Black Italic, uppercase\n- Corps de texte : Inter\n\n### Couleurs\n| Élément | Couleur |\n|---------|---------|\n| Primary (bleu) | `#074491` |\n| Primary light | `#3085F5` |\n| Solo (rouge) | `hsl(0, 84%, 60%)` |\n| Duo (bleu) | `hsl(221, 83%, 53%)` |\n\n## Dashboard Admin\n\nAccessible via `/admin` (nécessite authentification admin)\n\n1. **Sécurité** : 4 couches ON/OFF + environnement dev/prod\n2. **Paywall** : Titre, message, URLs\n3. **Membres** : Liste et gestion des membres payants\n4. **Webhook** : Générateur de script Circle.so\n5. **Feedbacks** : Consultation des retours utilisateurs\n\n## Intégration Circle.so - IMPORTANT\n\n### Comment Circle.so partage les données\n\nCircle.so expose automatiquement un objet JavaScript `window.circleUser` pour les membres connectés :\n\n```javascript\nwindow.circleUser = {\n  email: \"membre@example.com\",    // Email du membre\n  name: \"Nom Complet\",            // Nom du membre\n  publicUid: \"abc123xyz\",         // Identifiant public unique\n  is_admin: true                  // Booléen - statut admin\n}\n```\n\n**ATTENTION - NE JAMAIS FAIRE :**\n- ❌ Utiliser des variables Liquid (`{{member.email}}`) dans le JavaScript\n- ❌ Placer le script dans \"Head Code Snippets\"\n- ❌ Essayer de définir `window.circleUser` manuellement\n\n**TOUJOURS FAIRE :**\n- ✅ Utiliser `window.circleUser` directement (fourni par Circle.so)\n- ✅ Placer le script dans **Settings → Code Snippets → JavaScript**\n- ✅ Attendre que `window.circleUser` soit disponible avant d'envoyer\n\n### Script d'Authentification (Code Snippets → JavaScript)\n\nLe script dans le Dashboard Admin envoie les données de `window.circleUser` vers les iframes Replit via `postMessage`. Il :\n1. Attend que `window.circleUser` soit disponible\n2. Envoie les données à toutes les iframes `.replit.app`\n3. Répond aux demandes `CIRCLE_AUTH_REQUEST`\n\n### Script Webhook Paiement (Paywall Custom Code)\n\nGénéré via Dashboard Admin pour chaque app, à placer dans le Custom Code de chaque paywall.\n\n## Commandes\n\n```bash\nnpm run dev       # Démarre serveur de développement\nnpm run build     # Build production\nnpm run start     # Démarre en production\nnpm run db:push   # Push schema vers la base de données\n```\n\n## Notes Développeurs\n\n- Couche 1 désactivée = Mode développement (utilisateur mock)\n- Sessions JWT expirent après 60min\n- NIP toujours hashé (bcrypt 10 rounds)\n- Thème synchronisé automatiquement avec Circle.so\n- Statut admin sync à chaque connexion\n- Les parcours Solo et Duo partagent la page Welcome\n","path":null,"size_bytes":10068,"size_tokens":null},"client/src/lib/auth.ts":{"content":"export function isAuthenticated(): boolean {\n  const token = localStorage.getItem('session_token');\n  const timestamp = localStorage.getItem('session_timestamp');\n  \n  if (!token || !timestamp) {\n    return false;\n  }\n\n  const elapsed = Date.now() - parseInt(timestamp);\n  const sessionTimeout = 60 * 60 * 1000;\n  \n  if (elapsed > sessionTimeout) {\n    clearAuth();\n    return false;\n  }\n\n  return true;\n}\n\nexport function clearAuth(): void {\n  localStorage.removeItem('session_token');\n  localStorage.removeItem('user_id');\n  localStorage.removeItem('is_admin');\n  localStorage.removeItem('session_timestamp');\n  // Keep Circle.so cache - user identity from Circle.so is still valid\n  // We only clear the app session token, not the Circle.so identity\n}\n\nexport function getSessionToken(): string | null {\n  return localStorage.getItem('session_token');\n}\n\nexport function getUserId(): string | null {\n  return localStorage.getItem('user_id');\n}\n","path":null,"size_bytes":947,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"server/app.ts":{"content":"import { type Server } from \"node:http\";\n\nimport express, {\n  type Express,\n  type Request,\n  Response,\n  NextFunction,\n} from \"express\";\nimport cors from \"cors\";\n\nimport { registerRoutes } from \"./routes\";\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport const app = express();\n\n// Trust proxy for rate limiting behind Replit's reverse proxy\napp.set('trust proxy', 1);\n\n// Configure CORS for Circle.so integration (API routes only)\n// Use CIRCLE_ORIGIN for backend (available in production)\n// Fallback to VITE_CIRCLE_ORIGIN for dev mode compatibility\nconst circleOrigin = process.env.CIRCLE_ORIGIN || process.env.VITE_CIRCLE_ORIGIN;\nconst devMode = process.env.DEV_MODE === 'true';\n\n// Get app's own origin dynamically from Replit environment\n// REPLIT_DOMAINS contains the deployment domain in production\nconst getAppOrigins = (): string[] => {\n  const origins: string[] = [];\n\n  // Dev domain\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    origins.push(`https://${process.env.REPLIT_DEV_DOMAIN}`);\n  }\n\n  // Deployment URL\n  if (process.env.REPLIT_DEPLOYMENT_URL) {\n    origins.push(process.env.REPLIT_DEPLOYMENT_URL);\n  }\n\n  // REPLIT_DOMAINS contains comma-separated list of domains\n  if (process.env.REPLIT_DOMAINS) {\n    process.env.REPLIT_DOMAINS.split(',').forEach(domain => {\n      origins.push(`https://${domain.trim()}`);\n    });\n  }\n\n  return origins;\n};\n\nexport const corsMiddleware = cors({\n  origin: (origin: string | undefined, callback: (err: Error | null, allow?: boolean) => void) => {\n    // Allow requests with no origin (like mobile apps or curl requests)\n    if (!origin) return callback(null, true);\n\n    // In dev mode, allow all origins\n    if (devMode) {\n      return callback(null, true);\n    }\n\n    // In production, allow Circle.so origin AND the app's own origins\n    const allowedOrigins = [\n      circleOrigin,\n      ...getAppOrigins(),\n    ].filter(Boolean);\n\n    if (allowedOrigins.some(allowed => origin.includes(allowed?.replace('https://', '') || ''))) {\n      return callback(null, true);\n    }\n\n    // Otherwise reject with proper CORS error\n    return callback(null, false);\n  },\n  credentials: true,\n});\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\nexport default async function runApp(\n  setup: (app: Express, server: Server) => Promise<void>,\n): Promise<Server> {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    console.error('Global error handler caught:', err);\n    res.status(status).json({ message });\n  });\n\n  // importantly run the final setup after setting up all the other routes so\n  // the catch-all route doesn't interfere with the other routes\n  await setup(app, server);\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  \n  return new Promise((resolve) => {\n    server.listen({\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    }, () => {\n      log(`serving on port ${port}`);\n      resolve(server);\n    });\n  });\n}\n","path":null,"size_bytes":4512,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/contexts/config-context.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { queryClient } from '@/lib/queryClient';\n\ntype AppMode = 'dev' | 'prod';\n\ninterface ConfigContextType {\n  mode: AppMode;\n  toggleMode: () => void;\n  setMode: (mode: AppMode) => void;\n}\n\nconst ConfigContext = createContext<ConfigContextType | undefined>(undefined);\n\ninterface ConfigProviderProps {\n  children: ReactNode;\n}\n\nfunction clearAuthDataAndReload() {\n  localStorage.removeItem('session_token');\n  localStorage.removeItem('user_id');\n  localStorage.removeItem('session_timestamp');\n  localStorage.setItem('app_mode', 'prod');\n  queryClient.clear();\n  console.log('🔒 PROD MODE: Auth data cleared, reloading...');\n  window.location.href = '/';\n}\n\nexport function ConfigProvider({ children }: ConfigProviderProps) {\n  const [mode, setModeState] = useState<AppMode>(() => {\n    const stored = localStorage.getItem('app_mode') as AppMode;\n    if (stored === 'dev' || stored === 'prod') {\n      return stored;\n    }\n    \n    const envDevMode = import.meta.env.VITE_DEV_MODE === 'true';\n    return envDevMode ? 'dev' : 'prod';\n  });\n\n  useEffect(() => {\n    localStorage.setItem('app_mode', mode);\n    console.log(`🔧 App mode set to: ${mode.toUpperCase()}`);\n  }, [mode]);\n\n  const setMode = (newMode: AppMode) => {\n    if (newMode === 'prod' && mode !== 'prod') {\n      clearAuthDataAndReload();\n      return;\n    }\n    setModeState(newMode);\n  };\n\n  const toggleMode = () => {\n    const newMode = mode === 'dev' ? 'prod' : 'dev';\n    if (newMode === 'prod') {\n      clearAuthDataAndReload();\n      return;\n    }\n    setModeState(newMode);\n  };\n\n  return (\n    <ConfigContext.Provider value={{ mode, toggleMode, setMode }}>\n      {children}\n    </ConfigContext.Provider>\n  );\n}\n\nexport function useConfig() {\n  const context = useContext(ConfigContext);\n  if (!context) {\n    throw new Error('useConfig must be used within ConfigProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":1964,"size_tokens":null},"client/src/pages/user-home.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useLocation } from 'wouter';\nimport { useQuery } from '@tanstack/react-query';\nimport { Loader2, Home, Shield, LogOut } from 'lucide-react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { DevModeIndicator } from '@/components/dev-mode-indicator';\nimport { getSessionToken } from '@/lib/auth';\n\nexport default function UserHome() {\n  const [, setLocation] = useLocation();\n\n  const { data: userData, isLoading, error } = useQuery({\n    queryKey: ['/api/auth/me'],\n    queryFn: async () => {\n      const token = getSessionToken();\n      if (!token) {\n        throw new Error('No session token');\n      }\n\n      const response = await fetch('/api/auth/me', {\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n      });\n\n      if (!response.ok) {\n        if (response.status === 401) {\n          throw new Error('Session expired');\n        }\n        throw new Error('Failed to fetch user data');\n      }\n\n      return response.json();\n    },\n    retry: false,\n  });\n\n  useEffect(() => {\n    if (error || !getSessionToken()) {\n      handleLogout();\n    }\n  }, [error]);\n\n  const handleLogout = () => {\n    localStorage.removeItem('session_token');\n    localStorage.removeItem('user_id');\n    localStorage.removeItem('session_timestamp');\n    setLocation('/');\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <DevModeIndicator />\n        <Card className=\"w-full max-w-md shadow-lg\">\n          <CardContent className=\"flex flex-col items-center justify-center py-12 space-y-4\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            <p className=\"text-base text-muted-foreground\">Chargement...</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const firstName = userData?.name?.split(' ')[0] || 'Utilisateur';\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <DevModeIndicator />\n      \n      <header className=\"border-b bg-card\">\n        <div className=\"container mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-primary\">\n              <Home className=\"h-5 w-5 text-primary-foreground\" />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-semibold\">Espace Membre</h1>\n              <p className=\"text-sm text-muted-foreground\">Communauté Avancer Simplement</p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            {userData?.isAdmin && (\n              <Button \n                variant=\"outline\" \n                onClick={() => setLocation('/dashboard')}\n                data-testid=\"button-dashboard\"\n              >\n                <Shield className=\"h-4 w-4 mr-2\" />\n                Dashboard Admin\n              </Button>\n            )}\n            <Button \n              variant=\"outline\" \n              onClick={handleLogout}\n              data-testid=\"button-logout\"\n            >\n              <LogOut className=\"h-4 w-4 mr-2\" />\n              Déconnexion\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"container mx-auto px-4 py-12\">\n        <div className=\"max-w-2xl mx-auto\">\n          <Card className=\"shadow-lg\">\n            <CardHeader className=\"text-center space-y-2 pb-8\">\n              <div className=\"flex items-center justify-center w-16 h-16 mx-auto rounded-full bg-primary/10\">\n                <Home className=\"h-8 w-8 text-primary\" />\n              </div>\n              <CardTitle className=\"text-3xl font-bold\">\n                Bonjour {firstName} !\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"text-center space-y-6 pb-8\">\n              <p className=\"text-lg text-muted-foreground\">\n                Nos applications sont en cours de production.\n              </p>\n              <p className=\"text-lg text-muted-foreground\">\n                Vous pourrez en profiter bientôt !\n              </p>\n              <div className=\"pt-4\">\n                <p className=\"text-sm text-muted-foreground/70\">\n                  Nous vous tiendrons informé dès que nos outils seront disponibles.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":4581,"size_tokens":null},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from 'react';\n\ntype Theme = 'light' | 'dark' | 'system';\n\ninterface ThemeContextType {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  actualTheme: 'light' | 'dark';\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\n// Custom event for Circle.so theme sync\nconst CIRCLE_THEME_EVENT = 'circle-theme-change';\n\ninterface ThemeProviderProps {\n  children: ReactNode;\n  defaultTheme?: Theme;\n}\n\nexport function ThemeProvider({ children, defaultTheme = 'system' }: ThemeProviderProps) {\n  const [theme, setThemeState] = useState<Theme>(() => {\n    const stored = localStorage.getItem('theme') as Theme;\n    return stored || defaultTheme;\n  });\n\n  const [actualTheme, setActualTheme] = useState<'light' | 'dark'>('light');\n\n  // Listen for Circle.so theme changes via internal custom event\n  // This event is dispatched by setThemeFromCircle after Zod validation in useCircleAuth\n  useEffect(() => {\n    const handleCircleTheme = (event: CustomEvent<{ theme: 'light' | 'dark' }>) => {\n      const newTheme = event.detail.theme;\n      localStorage.setItem('theme', newTheme);\n      setThemeState(newTheme);\n    };\n\n    window.addEventListener(CIRCLE_THEME_EVENT, handleCircleTheme as EventListener);\n    return () => window.removeEventListener(CIRCLE_THEME_EVENT, handleCircleTheme as EventListener);\n  }, []);\n\n  // Global listener for Circle.so postMessage - accepts from any origin for theme sync\n  useEffect(() => {\n    const handleGlobalMessage = (event: MessageEvent) => {\n      if (event.data?.type === 'CIRCLE_USER_AUTH' && event.data?.theme) {\n        const newTheme = event.data.theme as 'light' | 'dark';\n        localStorage.setItem('theme', newTheme);\n        setThemeState(newTheme);\n      }\n    };\n\n    window.addEventListener('message', handleGlobalMessage);\n    return () => window.removeEventListener('message', handleGlobalMessage);\n  }, []);\n\n  useEffect(() => {\n    const root = document.documentElement;\n    \n    const applyTheme = (isDark: boolean) => {\n      if (isDark) {\n        root.classList.add('dark');\n        setActualTheme('dark');\n      } else {\n        root.classList.remove('dark');\n        setActualTheme('light');\n      }\n    };\n\n    if (theme === 'system') {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      applyTheme(mediaQuery.matches);\n      \n      const handler = (e: MediaQueryListEvent) => applyTheme(e.matches);\n      mediaQuery.addEventListener('change', handler);\n      return () => mediaQuery.removeEventListener('change', handler);\n    } else {\n      applyTheme(theme === 'dark');\n    }\n  }, [theme]);\n\n  const setTheme = (newTheme: Theme) => {\n    localStorage.setItem('theme', newTheme);\n    setThemeState(newTheme);\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme, actualTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error('useTheme must be used within ThemeProvider');\n  }\n  return context;\n}\n\nexport function setThemeFromCircle(circleTheme: 'light' | 'dark') {\n  // Apply theme immediately to DOM (avoids race condition with React effects)\n  localStorage.setItem('theme', circleTheme);\n  const root = document.documentElement;\n  if (circleTheme === 'dark') {\n    root.classList.add('dark');\n  } else {\n    root.classList.remove('dark');\n  }\n  \n  // Also dispatch custom event to sync with ThemeProvider React state\n  window.dispatchEvent(new CustomEvent('circle-theme-change', { \n    detail: { theme: circleTheme } \n  }));\n}\n","path":null,"size_bytes":3655,"size_tokens":null},"client/src/components/mode-toggle.tsx":{"content":"import { useConfig } from '@/contexts/config-context';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport { Wrench, Globe } from 'lucide-react';\n\nexport function ModeToggle() {\n  const { mode, toggleMode } = useConfig();\n  const isDev = mode === 'dev';\n\n  return (\n    <div className=\"fixed top-4 right-4 z-50 flex items-center gap-2\">\n      <Badge \n        variant={isDev ? \"default\" : \"secondary\"}\n        className=\"text-xs font-medium\"\n        data-testid=\"badge-current-mode\"\n      >\n        {isDev ? 'DEV' : 'PROD'}\n      </Badge>\n      <Button\n        onClick={toggleMode}\n        size=\"sm\"\n        variant=\"outline\"\n        className=\"gap-2\"\n        data-testid=\"button-toggle-mode\"\n      >\n        {isDev ? (\n          <>\n            <Globe className=\"h-4 w-4\" />\n            Passer en PROD\n          </>\n        ) : (\n          <>\n            <Wrench className=\"h-4 w-4\" />\n            Passer en DEV\n          </>\n        )}\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":1021,"size_tokens":null},"client/src/contexts/circle-auth-context.tsx":{"content":"import { createContext, useContext, useEffect, useState, useRef, ReactNode } from 'react';\nimport { circleUserDataSchema, type CircleUserData } from '@shared/schema';\nimport { setThemeFromCircle } from '@/components/theme-provider';\nimport { useConfig } from '@/contexts/config-context';\n\ntype BlockedReason = 'origin' | null;\n\ninterface CircleAuthState {\n  userData: CircleUserData['user'] | null;\n  error: string | null;\n  blocked: BlockedReason;\n  isLoading: boolean;\n  theme: 'light' | 'dark' | null;\n}\n\nconst TIMEOUT_MS = 3000;\n\nconst CircleAuthContext = createContext<CircleAuthState | undefined>(undefined);\n\ninterface CircleAuthProviderProps {\n  children: ReactNode;\n}\n\nexport function CircleAuthProvider({ children }: CircleAuthProviderProps) {\n  const { mode } = useConfig();\n  const [state, setState] = useState<CircleAuthState>({\n    userData: null,\n    error: null,\n    blocked: null,\n    isLoading: true,\n    theme: null,\n  });\n  \n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const messageReceivedRef = useRef(false);\n\n  useEffect(() => {\n    messageReceivedRef.current = false;\n    \n    setState({\n      userData: null,\n      error: null,\n      blocked: null,\n      isLoading: true,\n      theme: null,\n    });\n\n    const devMode = mode === 'dev';\n    const circleOrigin = import.meta.env.VITE_CIRCLE_ORIGIN;\n\n    if (devMode) {\n      console.log('🔧 DEV MODE: Circle.so authentication bypassed');\n      const mockUserData = {\n        publicUid: 'dev123',\n        email: 'dev@example.com',\n        name: 'Dev User',\n        isAdmin: true,\n        timestamp: Date.now(),\n      };\n      setState({\n        userData: mockUserData,\n        error: null,\n        blocked: null,\n        isLoading: false,\n        theme: null,\n      });\n      return;\n    }\n\n    if (!circleOrigin) {\n      console.error('❌ VITE_CIRCLE_ORIGIN is not configured!');\n      setState({\n        userData: null,\n        error: 'Configuration manquante: VITE_CIRCLE_ORIGIN non défini.',\n        blocked: 'origin',\n        isLoading: false,\n        theme: null,\n      });\n      return;\n    }\n\n    console.log('🔍 Waiting for Circle.so message from:', circleOrigin);\n    console.log('⏱️ Timeout set to', TIMEOUT_MS, 'ms');\n\n    const handleMessage = (event: MessageEvent) => {\n      console.log('📨 Message received from:', event.origin);\n      \n      if (event.origin !== circleOrigin) {\n        console.error('❌ Unauthorized origin:', event.origin, '(expected:', circleOrigin + ')');\n        return;\n      }\n\n      try {\n        const data = circleUserDataSchema.parse(event.data);\n        \n        if (data.type === 'CIRCLE_USER_AUTH') {\n          console.log('✅ Circle.so user data received');\n          messageReceivedRef.current = true;\n          \n          if (timeoutRef.current) {\n            clearTimeout(timeoutRef.current);\n            timeoutRef.current = null;\n          }\n          \n          if (data.theme) {\n            console.log('🎨 Applying Circle.so theme:', data.theme);\n            setThemeFromCircle(data.theme);\n          }\n          \n          setState({\n            userData: data.user,\n            error: null,\n            blocked: null,\n            isLoading: false,\n            theme: data.theme || null,\n          });\n        }\n      } catch (error) {\n        console.error('❌ Invalid Circle.so data:', error);\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n\n    timeoutRef.current = setTimeout(() => {\n      if (!messageReceivedRef.current) {\n        console.error('⏱️ Timeout: No Circle.so message received after', TIMEOUT_MS, 'ms');\n        console.error('🚫 Access blocked: App must be accessed from Circle.so iframe');\n        setState(prev => ({\n          ...prev,\n          blocked: 'origin',\n          isLoading: false,\n          error: 'Cette application est accessible uniquement depuis Circle.so',\n        }));\n      }\n    }, TIMEOUT_MS);\n\n    return () => {\n      window.removeEventListener('message', handleMessage);\n      if (timeoutRef.current) {\n        clearTimeout(timeoutRef.current);\n      }\n      messageReceivedRef.current = false;\n    };\n  }, [mode]);\n\n  return (\n    <CircleAuthContext.Provider value={state}>\n      {children}\n    </CircleAuthContext.Provider>\n  );\n}\n\nexport function useCircleAuth() {\n  const context = useContext(CircleAuthContext);\n  if (!context) {\n    throw new Error('useCircleAuth must be used within CircleAuthProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":4473,"size_tokens":null},"client/src/components/access-denied-screen.tsx":{"content":"import { ShieldX } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { ModeToggle } from '@/components/mode-toggle';\n\nconst COMMUNITY_URL = 'https://communaute.avancersimplement.com';\n\nexport function AccessDeniedScreen() {\n  return (\n    <div \n      className=\"min-h-screen flex flex-col items-center justify-center bg-background px-4\"\n      data-testid=\"screen-access-denied\"\n    >\n      <ModeToggle />\n      <div className=\"max-w-md w-full text-center space-y-8\">\n        <div className=\"flex justify-center\">\n          <div className=\"rounded-full bg-destructive/10 p-6\">\n            <ShieldX \n              className=\"h-16 w-16 text-destructive\" \n              data-testid=\"icon-access-denied\"\n            />\n          </div>\n        </div>\n        \n        <div className=\"space-y-4\">\n          <h1 \n            className=\"text-2xl font-semibold text-foreground\"\n            data-testid=\"text-access-denied-title\"\n          >\n            Accès non autorisé\n          </h1>\n          <p \n            className=\"text-base text-muted-foreground\"\n            data-testid=\"text-access-denied-message\"\n          >\n            Cette application est accessible uniquement depuis la communauté Avancer Simplement.\n          </p>\n        </div>\n        \n        <Button \n          asChild\n          size=\"lg\"\n          className=\"w-full h-12\"\n          data-testid=\"button-access-community\"\n        >\n          <a href={COMMUNITY_URL} target=\"_blank\" rel=\"noopener noreferrer\">\n            Accéder à la communauté\n          </a>\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1607,"size_tokens":null},"client/src/components/loading-screen.tsx":{"content":"import { Loader2 } from 'lucide-react';\n\nexport function LoadingScreen() {\n  return (\n    <div \n      className=\"min-h-screen flex flex-col items-center justify-center bg-background\"\n      data-testid=\"screen-loading\"\n    >\n      <div className=\"flex flex-col items-center gap-6\">\n        <Loader2 \n          className=\"h-12 w-12 animate-spin text-primary\" \n          data-testid=\"spinner-loading\"\n        />\n        <p \n          className=\"text-lg font-medium text-muted-foreground\"\n          data-testid=\"text-loading-message\"\n        >\n          Vérification en cours...\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":620,"size_tokens":null},"client/src/pages/DuoReceiverConfirmation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { CheckCheck } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverConfirmation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <CheckCheck className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Tu as été bien entendu {session.receiverName}?\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4 text-center\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName} vient de reformuler ce que tu as partagé\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Si {session.senderName} a bien entendu ce que tu as nommé, tu peux continuer. Sinon, prends le temps de rectifier et de préciser ce qui est important pour toi.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(17)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-confirm\"\n              >\n                <CheckCheck className=\"w-5 h-5 mr-2\" />\n                J'ai été entendu\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2276,"size_tokens":null},"client/src/pages/DuoReceiverValidation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { Checklist } from '@/components/Checklist';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { Ear, VolumeX } from 'lucide-react';\n\nexport default function ReceiverValidation() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const checklistItems = [\n    {\n      id: 'situation',\n      label: 'La situation (qu\\'est-ce qui s\\'est passé)',\n      checked: session.checklistSituation || false,\n      onChange: (checked: boolean) => updateSession({ checklistSituation: checked }),\n    },\n    {\n      id: 'vecu',\n      label: 'Le vécu (comment il/elle s\\'est senti)',\n      checked: session.checklistVecu || false,\n      onChange: (checked: boolean) => updateSession({ checklistVecu: checked }),\n    },\n    {\n      id: 'interpretation',\n      label: 'L\\'interprétation (comment il/elle a perçu la situation)',\n      checked: session.checklistInterpretation || false,\n      onChange: (checked: boolean) => updateSession({ checklistInterpretation: checked }),\n    },\n    {\n      id: 'impact',\n      label: 'L\\'impact (les conséquences pour lui/elle)',\n      checked: session.checklistImpact || false,\n      onChange: (checked: boolean) => updateSession({ checklistImpact: checked }),\n    },\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Ear className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Valide ce que tu as entendu\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName}: écoute attentive\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, nomme ce que tu as entendu...\n            </h2>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Ne parle pas de toi ou de tes émotions à cette étape\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reformule simplement ce que {session.senderName} a partagé\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Valide ta compréhension des 4 points ci-dessous\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sers-toi de la liste pour te guider si nécessaire\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Ton rôle ici est de montrer à {session.senderName} que tu as vraiment écouté et compris. Reformule ce que tu as entendu dans tes propres mots, sans juger, sans minimiser, sans ajouter ton point de vue.\n              </p>\n              <p className=\"mb-4\">\n                Pour chaque point, tu peux dire quelque chose comme :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Situation :</strong> \"Si je comprends bien, ce qui s'est passé c'est...\"</li>\n                <li><strong>Vécu :</strong> \"Face à ça, tu t'es senti...\"</li>\n                <li><strong>Interprétation :</strong> \"Tu as eu l'impression que...\"</li>\n                <li><strong>Impact :</strong> \"Et ça t'a amené à réagir en...\"</li>\n              </ul>\n              <p>\n                Après avoir reformulé chaque point oralement, coche la case correspondante. {session.senderName} pourra ensuite confirmer ou rectifier si nécessaire.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <Checklist items={checklistItems} />\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(13)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":5576,"size_tokens":null},"client/src/pages/DuoSenderConfirmation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { CheckCheck, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderConfirmation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <CheckCheck className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          As-tu été bien entendu?\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, {session.receiverName} vient de reformuler ce que tu as partagé, est-ce que tu as bien été entendu?\n            </h2>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Ajoute des précisions si nécessaire\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Rectifie ce qui n'est pas tout à fait juste\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Appuie sur ce qui est particulièrement important pour toi\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Valide que {session.receiverName} t'as bien entendu si nécessaire\n                </span>\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n            <p className=\"text-sm text-foreground\">\n              L'objectif est que {session.receiverName} comprenne vraiment ce que tu vis. Prends le temps nécessaire pour t'assurer que ton message est bien passé.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(14)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-confirm\"\n              >\n                <CheckCheck className=\"w-5 h-5 mr-2\" />\n                J'ai été entendu\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3910,"size_tokens":null},"client/src/components/PageLayout.tsx":{"content":"import { ReactNode, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport { ProgressBar } from './ProgressBar';\nimport { PersistentNav } from './PersistentNav';\nimport { getFlow } from '@shared/schema';\nimport { useSession } from '@/contexts/SessionContext';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n  DropdownMenuSeparator,\n  DropdownMenuLabel,\n} from '@/components/ui/dropdown-menu';\nimport { ChevronDown } from 'lucide-react';\n\ninterface PageLayoutProps {\n  children: ReactNode;\n  showNav?: boolean;\n}\n\nexport function PageLayout({ children, showNav = true }: PageLayoutProps) {\n  const { session, goToStep, goBack } = useSession();\n  const flow = getFlow(session.appType);\n  const currentPage = flow.pages[session.currentStep];\n\n  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  const animationDuration = prefersReducedMotion ? 0 : 1;\n\n  // Menu déroulant Solo (avec Sender Clarification à la page 14)\n  const soloPageNames = [\n    \"Welcome\",\n    \"Roles\",\n    \"Warnings\",\n    \"Intention\",\n    \"Sender Grounding\",\n    \"Receiver Grounding\",\n    \"Transition 1\",\n    \"Sender Situation\",\n    \"Sender Experience\",\n    \"Sender Interpretation\",\n    \"Sender Impact\",\n    \"Sender Summary\",\n    \"Receiver Validation\",\n    \"Sender Confirmation\",\n    \"Sender Clarification\",\n    \"Receiver Experience\",\n    \"Sender Validation\",\n    \"Receiver Confirmation\",\n    \"Transition 2\",\n    \"Sender Needs\",\n    \"Receiver Response\",\n    \"Transition 3\",\n    \"Sender Closing\",\n    \"Receiver Closing\",\n    \"Thanks\",\n    \"Feedback\",\n    \"Completion\",\n  ];\n\n  // Menu déroulant Duo (sans Sender Clarification)\n  const duoPageNames = [\n    \"Welcome\",\n    \"Roles\",\n    \"Warnings\",\n    \"Intention\",\n    \"Sender Grounding\",\n    \"Receiver Grounding\",\n    \"Transition 1\",\n    \"Sender Situation\",\n    \"Sender Experience\",\n    \"Sender Interpretation\",\n    \"Sender Impact\",\n    \"Sender Summary\",\n    \"Receiver Validation\",\n    \"Sender Confirmation\",\n    \"Receiver Experience\",\n    \"Sender Validation\",\n    \"Receiver Confirmation\",\n    \"Transition 2\",\n    \"Sender Needs\",\n    \"Receiver Response\",\n    \"Transition - Choix\",\n    \"Sender Closing\",\n    \"Receiver Closing\",\n    \"Feedback\",\n    \"Completion\",\n    // Parcours inversé (7a-20a)\n    \"🔄 Situation (Inversé)\",\n    \"🔄 Experience (Inversé)\",\n    \"🔄 Interpretation (Inversé)\",\n    \"🔄 Impact (Inversé)\",\n    \"🔄 Summary (Inversé)\",\n    \"🔄 Validation (Inversé)\",\n    \"🔄 Confirmation (Inversé)\",\n    \"🔄 Experience Récepteur (Inversé)\",\n    \"🔄 Validation Émetteur (Inversé)\",\n    \"🔄 Confirmation Récepteur (Inversé)\",\n    \"🔄 Transition 2 (Inversé)\",\n    \"🔄 Needs (Inversé)\",\n    \"🔄 Response (Inversé)\",\n    \"🔄 Transition 3 (Inversé)\",\n  ];\n\n  // Choisir le bon menu selon le flow actif\n  const pageNames = session.appType === 'solo' ? soloPageNames : duoPageNames;\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n    const rootElement = document.getElementById('root');\n    if (rootElement) {\n      rootElement.scrollTo(0, 0);\n    }\n  }, [session.currentStep]);\n\n  return (\n    <div className=\"min-h-full flex flex-col\" style={{ background: 'hsl(var(--page-bg))' }}>\n      <ProgressBar\n        section={currentPage.section}\n        currentStep={session.currentStep}\n        totalSteps={flow.pages.length}\n      />\n\n      {/* TEMPORARY: Page navigation for development - to be removed later */}\n      <div className=\"hidden md:block fixed top-4 right-4 z-50\">\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <button \n              className=\"flex px-3 py-1 rounded-md text-sm font-medium shadow-lg items-center gap-1 hover-elevate active-elevate-2\"\n              style={{ \n                backgroundColor: flow.progressColor,\n                color: 'white'\n              }}\n            >\n              Page {session.currentStep}/{flow.pages.length - 1}\n              <ChevronDown className=\"w-3 h-3\" />\n            </button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\" className=\"max-h-96 overflow-y-auto\">\n            <DropdownMenuLabel>Aller à la page</DropdownMenuLabel>\n            <DropdownMenuSeparator />\n            {pageNames.map((name, index) => (\n              <DropdownMenuItem\n                key={index}\n                onClick={() => goToStep(index)}\n                className={session.currentStep === index ? \"bg-primary/10\" : \"\"}\n              >\n                <span className=\"font-medium w-8\">P{index}</span>\n                <span>{name}</span>\n              </DropdownMenuItem>\n            ))}\n          </DropdownMenuContent>\n        </DropdownMenu>\n      </div>\n\n      <main className=\"flex-1 px-4 md:px-6 py-6 md:py-12 pb-32 md:pb-64\">\n        <motion.div\n          key={session.currentStep}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: animationDuration, ease: \"easeOut\" }}\n          className=\"max-w-3xl mx-auto\"\n        >\n          {children}\n        </motion.div>\n      </main>\n\n      {showNav && (\n        <PersistentNav \n          onBack={goBack} \n          canGoBack={session.currentStep > 0} \n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5283,"size_tokens":null},"client/src/pages/SoloTransition1.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { ArrowRight } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Transition1() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Êtes-vous prêts à passer à l'étape suivante?\n        </h1>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n          <p className=\"text-lg leading-relaxed text-foreground\">\n            Vous allez maintenant entrer dans le vif du sujet. L'émetteur va partager son vécu pendant que le récepteur écoute avec attention.\n          </p>\n\n          <p className=\"text-base text-muted-foreground leading-relaxed\">\n            Rappelez-vous : prenez votre temps à chaque étape. Il n'y a aucune urgence.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(8)}\n            disabled={isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-continue\"\n          >\n            Oui, on continue\n            <ArrowRight className=\"w-5 h-5 ml-2\" />\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":1678,"size_tokens":null},"attached_assets/systeme-acces-circle-so_(1)_1765045503613.md":{"content":"# Système de Contrôle d'Accès pour Applications Circle.so\n\n## Protection par Paiement (Paywall)\n\n### Description\n\nCette protection vérifie que l'utilisateur a effectué un paiement en vérifiant son email dans la table `paid_members`.\n\n### Message affiché si bloqué\n\n```\nAccès Réservé\nCette application est réservée aux membres ayant souscrit à l'offre. \nObtenez votre accès pour profiter de tous les parcours de communication \net de régulation émotionnelle.\n\n[Bouton: Acheter maintenant]  [Bouton: Plus d'informations]\n```\n\n### Configuration Admin\n\n- **Toggle** : Développement / Production\n- **Développement** : Accès accordé à tous (bypass du paywall)\n- **Production** : Seuls les membres payants ont accès\n\n### Structure de la base de données\n\n```sql\n-- Table: paid_members\nCREATE TABLE paid_members (\n  id SERIAL PRIMARY KEY,\n  email VARCHAR(255) UNIQUE NOT NULL,\n  payment_date TIMESTAMP DEFAULT NOW(),\n  payment_plan VARCHAR(100),\n  amount_paid VARCHAR(50),\n  coupon_used VARCHAR(100)\n);\n\n-- Table: app_settings\nCREATE TABLE app_settings (\n  id SERIAL PRIMARY KEY,\n  key VARCHAR(100) UNIQUE NOT NULL,\n  value TEXT\n);\n\n-- Paramètres initiaux\nINSERT INTO app_settings (key, value) VALUES ('environment', 'development');\nINSERT INTO app_settings (key, value) VALUES ('circleOnlyMode', 'false');\n```\n\n### Code Frontend (AccessContext.tsx)\n\n```typescript\n// Vérifier l'accès\nconst checkAccess = useCallback(async () => {\n  setAccessStatus('loading');\n  \n  // Récupérer l'environnement\n  const response = await fetch('/api/settings');\n  const { environment } = await response.json();\n  \n  // Mode développement : accès accordé\n  if (environment === 'development') {\n    setAccessStatus('granted');\n    return;\n  }\n  \n  // Mode production : vérifier le paiement\n  if (!userEmail) {\n    setAccessStatus('denied');\n    return;\n  }\n  \n  const accessResponse = await fetch('/api/check-access', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ email: userEmail }),\n  });\n  \n  const { hasAccess } = await accessResponse.json();\n  setAccessStatus(hasAccess ? 'granted' : 'denied');\n}, [userEmail]);\n```\n\n### Code Backend (routes.ts)\n\n```typescript\n// POST /api/check-access - Vérifier si l'utilisateur a payé\napp.post(\"/api/check-access\", async (req, res) => {\n  const { email } = req.body;\n  \n  // Récupérer l'environnement\n  const environment = await storage.getSetting(\"environment\") || \"development\";\n  \n  // Mode développement : accès accordé à tous\n  if (environment === \"development\") {\n    return res.json({ hasAccess: true, mode: \"development\" });\n  }\n  \n  // Mode production : vérifier le paiement\n  if (!email) {\n    return res.json({ hasAccess: false, mode: \"production\" });\n  }\n  \n  const paidMember = await storage.getPaidMemberByEmail(email);\n  res.json({ \n    hasAccess: !!paidMember, \n    mode: \"production\" \n  });\n});\n\n// POST /api/admin/settings/environment - Changer l'environnement\napp.post(\"/api/admin/settings/environment\", async (req, res) => {\n  const adminPin = req.headers[\"x-admin-pin\"];\n  if (adminPin !== process.env.ADMIN_PIN) {\n    return res.status(401).json({ error: \"PIN invalide\" });\n  }\n  \n  const { environment } = req.body;\n  await storage.setSetting(\"environment\", environment);\n  res.json({ environment });\n});\n```\n\n### Webhook Circle.so pour enregistrer les paiements\n\nCe script s'ajoute à la fin du processus de paiement Circle.so :\n\n```html\n<script>\nfetch('https://VOTRE-APP.replit.app/webhooks/circle-payment', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    event: 'payment_received',\n    user: {\n      email: '{member_email}',\n      timestamp: Math.floor(Date.now() / 1000)\n    },\n    payment: {\n      paywall_display_name: '{paywall_display_name}',\n      amount_paid: '{amount_paid}',\n      price_interval: '{paywall_price_interval}',\n      coupon_code: '{coupon_code}'\n    }\n  })\n});\n</script>\n```\n\n### Route Webhook Backend\n\n```typescript\n// POST /webhooks/circle-payment - Recevoir les paiements\napp.post(\"/webhooks/circle-payment\", async (req, res) => {\n  const { user, payment } = req.body;\n  \n  if (!user?.email) {\n    return res.status(400).json({ error: \"Email requis\" });\n  }\n  \n  // Vérifier si déjà enregistré\n  const existing = await storage.getPaidMemberByEmail(user.email);\n  if (existing) {\n    return res.json({ success: true, message: \"Membre déjà enregistré\" });\n  }\n  \n  // Enregistrer le nouveau membre\n  await storage.createPaidMember({\n    email: user.email,\n    paymentPlan: payment?.paywall_display_name,\n    amountPaid: payment?.amount_paid,\n    couponUsed: payment?.coupon_code,\n  });\n  \n  res.json({ success: true, message: \"Accès activé\" });\n});\n```\n\n---\n\n## 3. Interface Admin\n\n### Accès\n\n- **URL** : `/admin`\n- **Protection** : Code PIN à 6 chiffres (variable d'environnement `ADMIN_PIN`)\n\n### Fonctionnalités\n\n1. **Toggle Développement / Production** : Contrôle le paywall\n2. **Toggle Ouvert / Circle.so** : Contrôle la vérification d'origine\n3. **Liste des feedbacks** : Voir tous les retours utilisateurs\n4. **Export** : Exporter les données au format Markdown\n\n### Code du Toggle Admin\n\n```tsx\n// Toggle Environnement\n<div className=\"flex items-center gap-1 bg-muted rounded-lg p-1\">\n  <Button\n    variant={environment === 'development' ? 'default' : 'ghost'}\n    size=\"sm\"\n    onClick={() => handleEnvironmentChange('development')}\n  >\n    Développement\n  </Button>\n  <Button\n    variant={environment === 'production' ? 'default' : 'ghost'}\n    size=\"sm\"\n    onClick={() => handleEnvironmentChange('production')}\n  >\n    Production\n  </Button>\n</div>\n\n// Toggle Circle.so\n<div className=\"flex items-center gap-1 bg-muted rounded-lg p-1\">\n  <Button\n    variant={!circleOnlyMode ? 'default' : 'ghost'}\n    size=\"sm\"\n    onClick={() => handleCircleOnlyChange(false)}\n  >\n    Ouvert\n  </Button>\n  <Button\n    variant={circleOnlyMode ? 'default' : 'ghost'}\n    size=\"sm\"\n    onClick={() => handleCircleOnlyChange(true)}\n  >\n    Circle.so\n  </Button>\n</div>\n```\n\n---\n\n## 4. Récapitulatif des Variables d'Environnement\n\n| Variable | Description | Exemple |\n|----------|-------------|---------|\n| `DATABASE_URL` | URL de connexion PostgreSQL | `postgresql://user:pass@host:5432/db` |\n| `ADMIN_PIN` | Code PIN pour l'accès admin | `074491` |\n| `SESSION_SECRET` | Secret pour les sessions | `votre-secret-aleatoire` |\n\n---\n\n## 5. Schéma Drizzle (schema.ts)\n\n```typescript\nimport { pgTable, serial, text, timestamp, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Table des membres payants\nexport const paidMembers = pgTable(\"paid_members\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  paymentDate: timestamp(\"payment_date\").defaultNow(),\n  paymentPlan: text(\"payment_plan\"),\n  amountPaid: text(\"amount_paid\"),\n  couponUsed: text(\"coupon_used\"),\n});\n\n// Table des paramètres\nexport const appSettings = pgTable(\"app_settings\", {\n  id: serial(\"id\").primaryKey(),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\"),\n});\n\n// Schemas Zod\nexport const insertPaidMemberSchema = createInsertSchema(paidMembers).omit({ id: true, paymentDate: true });\nexport type InsertPaidMember = z.infer<typeof insertPaidMemberSchema>;\nexport type PaidMember = typeof paidMembers.$inferSelect;\n```\n\n---\n\n## 6. Checklist de Déploiement\n\n### Avant la mise en production\n\n- [ ] Définir `ADMIN_PIN` dans les variables d'environnement\n- [ ] Définir `DATABASE_URL` pour PostgreSQL\n- [ ] Pousser le schéma avec `npm run db:push`\n- [ ] Configurer le mode \"Production\" dans l'admin\n- [ ] Configurer le mode \"Circle.so\" dans l'admin\n- [ ] Ajouter le script postMessage dans Circle.so (Code Snippets)\n- [ ] Ajouter le script webhook paiement dans Circle.so\n- [ ] Tester le flux complet depuis Circle.so\n\n### URLs à personnaliser\n\n- `ALLOWED_ORIGIN` : L'URL de votre communauté Circle.so\n- Liens dans PaywallScreen : Page d'achat et page d'informations\n- URL du webhook dans le script de paiement\n\n---\n\n## 7. Dépannage\n\n### \"Accès non autorisé\" s'affiche même depuis Circle.so\n\n1. Vérifier que le script postMessage est bien ajouté dans Circle.so\n2. Vérifier que `ALLOWED_ORIGIN` correspond exactement à l'URL Circle.so\n3. Vérifier les logs de la console pour voir l'origine reçue\n\n### \"Accès Réservé\" s'affiche pour un membre payant\n\n1. Vérifier que l'email est bien enregistré dans `paid_members`\n2. Vérifier que le webhook de paiement fonctionne\n3. Vérifier que l'email Circle.so correspond à l'email de paiement\n\n### Le toggle admin ne fonctionne pas\n\n1. Vérifier que le PIN est correct\n2. Vérifier les logs du serveur pour les erreurs\n3. Vérifier que la table `app_settings` existe en base\n\n---\n\n","path":null,"size_bytes":8841,"size_tokens":null},"client/src/pages/SoloTransition3.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { ArrowRight } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Transition3() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Êtes-vous prêts à passer à la clôture?\n        </h1>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n          <p className=\"text-lg leading-relaxed text-foreground\">\n            Vous allez maintenant conclure cette conversation en partageant comment vous vous sentez après cet échange.\n          </p>\n\n          <p className=\"text-base text-muted-foreground leading-relaxed\">\n            C'est le moment de reconnaître le chemin parcouru ensemble.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(23)}\n            disabled={isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-continue\"\n          >\n            Oui, on continue\n            <ArrowRight className=\"w-5 h-5 ml-2\" />\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":1631,"size_tokens":null},"client/src/contexts/AccessContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode, useCallback, useRef } from 'react';\n\ntype AccessStatus = 'loading' | 'granted' | 'denied' | 'origin_invalid';\n\ninterface AccessContextType {\n  accessStatus: AccessStatus;\n  userEmail: string | null;\n  circleIsAdmin: boolean;\n  appEnvironment: 'development' | 'production';\n  circleOnlyMode: boolean;\n  checkAccess: () => Promise<void>;\n  refreshEnvironment: () => Promise<'development' | 'production'>;\n  forceRecheck: () => void;\n}\n\nconst ALLOWED_ORIGIN = 'https://communaute.avancersimplement.com';\n\ninterface CircleUserMessage {\n  type: 'CIRCLE_USER_AUTH';\n  theme?: string;\n  user?: {\n    email?: string;\n    name?: string;\n    isAdmin?: boolean;\n  };\n}\n\ndeclare global {\n  interface Window {\n    __CIRCLE_USER_EMAIL__: string | null;\n    __CIRCLE_ORIGIN_VALIDATED__: boolean;\n  }\n}\n\nconst AccessContext = createContext<AccessContextType | undefined>(undefined);\n\nconst USER_EMAIL_KEY = 'duo-connecte-user-email';\n\nfunction getStoredEmail(): string | null {\n  try {\n    return localStorage.getItem(USER_EMAIL_KEY);\n  } catch {\n    return null;\n  }\n}\n\nfunction storeEmail(email: string) {\n  try {\n    localStorage.setItem(USER_EMAIL_KEY, email);\n  } catch {\n    // localStorage non disponible\n  }\n}\n\nexport function AccessProvider({ children }: { children: ReactNode }) {\n  const [accessStatus, setAccessStatus] = useState<AccessStatus>('loading');\n  const [userEmail, setUserEmail] = useState<string | null>(() => {\n    return window.__CIRCLE_USER_EMAIL__ ?? getStoredEmail();\n  });\n  const [circleIsAdmin, setCircleIsAdmin] = useState<boolean>(false);\n  const [appEnvironment, setAppEnvironment] = useState<'development' | 'production'>('development');\n  const [circleOnlyMode, setCircleOnlyMode] = useState<boolean>(false);\n  const [originValidated, setOriginValidated] = useState<boolean>(() => {\n    return window.__CIRCLE_ORIGIN_VALIDATED__ ?? false;\n  });\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [settingsLoaded, setSettingsLoaded] = useState(false);\n  const [recheckTrigger, setRecheckTrigger] = useState(0);\n  const lastProcessedEmailRef = useRef<string | null>(null);\n  const circleOnlyModeRef = useRef<boolean>(false);\n  const originTimeoutRef = useRef<number | null>(null);\n\n  // Garder la ref synchronisée avec l'état\n  circleOnlyModeRef.current = circleOnlyMode;\n\n  // Récupérer l'environnement de l'app depuis le backend\n  const refreshEnvironment = useCallback(async (): Promise<'development' | 'production'> => {\n    try {\n      const response = await fetch('/api/settings');\n      if (response.ok) {\n        const data = await response.json();\n        const env = data.environment || 'development';\n        const circleOnly = data.circleOnlyMode ?? false;\n        setAppEnvironment(env);\n        setCircleOnlyMode(circleOnly);\n        circleOnlyModeRef.current = circleOnly;\n        setSettingsLoaded(true);\n        return env;\n      }\n    } catch (error) {\n      console.error('Error fetching app settings:', error);\n    }\n    setSettingsLoaded(true);\n    return 'development';\n  }, []);\n\n  // Vérifier l'accès\n  const checkAccess = useCallback(async () => {\n    setAccessStatus('loading');\n\n    // Récupérer l'environnement actuel\n    const currentEnv = await refreshEnvironment();\n\n    // Si mode Circle.so uniquement et origine non validée\n    if (circleOnlyModeRef.current && !originValidated && !window.__CIRCLE_ORIGIN_VALIDATED__) {\n      // L'accès sera refusé après le timeout si aucun message Circle.so valide n'est reçu\n      setAccessStatus('loading');\n      setIsInitialized(true);\n      return;\n    }\n\n    // Si pas d'email\n    if (!userEmail) {\n      // En mode développement sans email, accorder l'accès par défaut\n      if (currentEnv === 'development') {\n        setAccessStatus('granted');\n      } else {\n        // En mode production sans email, refuser l'accès\n        setAccessStatus('denied');\n      }\n      setIsInitialized(true);\n      return;\n    }\n\n    // Avec email, vérifier l'accès via le backend\n    try {\n      const response = await fetch('/api/check-access', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email: userEmail }),\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        setAccessStatus(data.hasAccess ? 'granted' : 'denied');\n        setAppEnvironment(data.mode || 'development');\n      } else {\n        setAccessStatus('denied');\n      }\n    } catch (error) {\n      console.error('Error checking access:', error);\n      // En cas d'erreur, refuser l'accès\n      setAccessStatus('denied');\n    }\n\n    setIsInitialized(true);\n  }, [userEmail, refreshEnvironment, originValidated]);\n\n  // Écouter les messages de Circle.so pour recevoir l'email\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      const data = event.data as CircleUserMessage;\n\n      // Vérifier si c'est un message de type CIRCLE_USER_AUTH\n      if (data?.type !== 'CIRCLE_USER_AUTH') {\n        return;\n      }\n\n      // Vérifier l'origine si le mode Circle uniquement est activé\n      if (circleOnlyModeRef.current) {\n        if (event.origin !== ALLOWED_ORIGIN) {\n          return;\n        } else {\n          // Origine valide - marquer comme validée\n          setOriginValidated(true);\n          window.__CIRCLE_ORIGIN_VALIDATED__ = true;\n\n          // Annuler le timeout de rejet\n          if (originTimeoutRef.current) {\n            clearTimeout(originTimeoutRef.current);\n            originTimeoutRef.current = null;\n          }\n        }\n      }\n\n      if (data.user?.email) {\n        const email = data.user.email;\n\n        // Ignorer les messages dupliqués avec le même email\n        if (email === lastProcessedEmailRef.current) {\n          return;\n        }\n\n        lastProcessedEmailRef.current = email;\n        setUserEmail(email);\n        storeEmail(email);\n        window.__CIRCLE_USER_EMAIL__ = email;\n        \n        // Stocker le statut admin de Circle.so\n        if (data.user.isAdmin === true) {\n          setCircleIsAdmin(true);\n        }\n      }\n\n      // Forcer une re-vérification immédiate\n      setRecheckTrigger(prev => prev + 1);\n    };\n\n    window.addEventListener('message', handleMessage);\n    return () => window.removeEventListener('message', handleMessage);\n  }, []);\n\n  // Timeout pour rejeter l'accès si aucun message Circle.so valide n'est reçu\n  useEffect(() => {\n    if (settingsLoaded && circleOnlyMode && !originValidated && !window.__CIRCLE_ORIGIN_VALIDATED__) {\n      // Donner 3 secondes pour recevoir un message Circle.so valide\n      originTimeoutRef.current = window.setTimeout(() => {\n        if (!originValidated && !window.__CIRCLE_ORIGIN_VALIDATED__) {\n          setAccessStatus('origin_invalid');\n        }\n      }, 3000);\n\n      return () => {\n        if (originTimeoutRef.current) {\n          clearTimeout(originTimeoutRef.current);\n        }\n      };\n    }\n  }, [settingsLoaded, circleOnlyMode, originValidated]);\n\n  // Fonction pour forcer une re-vérification de l'accès\n  const forceRecheck = useCallback(() => {\n    setRecheckTrigger(prev => prev + 1);\n  }, []);\n\n  // Vérifier l'accès au chargement, quand l'email change, ou quand une re-vérification est demandée\n  useEffect(() => {\n    checkAccess();\n  }, [checkAccess, recheckTrigger, originValidated]);\n\n  return (\n    <AccessContext.Provider value={{\n      accessStatus,\n      userEmail,\n      circleIsAdmin,\n      appEnvironment,\n      circleOnlyMode,\n      checkAccess,\n      refreshEnvironment,\n      forceRecheck,\n    }}>\n      {children}\n    </AccessContext.Provider>\n  );\n}\n\nexport function useAccess() {\n  const context = useContext(AccessContext);\n  if (context === undefined) {\n    throw new Error('useAccess must be used within an AccessProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":7891,"size_tokens":null},"client/src/pages/DuoCompletion.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { useSession } from '@/contexts/SessionContext';\nimport { CheckCircle2, RotateCcw, ExternalLink, User, Users, Smile } from 'lucide-react';\nimport { PageLayout } from '@/components/PageLayout';\n\nexport default function Completion() {\n  const { resetSession } = useSession();\n  const [hasChosenOption, setHasChosenOption] = useState(false);\n\n  const handleRestart = () => {\n    if (window.confirm('Êtes-vous sûr de vouloir recommencer une nouvelle session? Toutes les données actuelles seront effacées.')) {\n      resetSession();\n    }\n  };\n\n  const handleNoThanks = () => {\n    setHasChosenOption(true);\n  };\n\n  const handleTherapyClick = () => {\n    setHasChosenOption(true);\n  };\n\n  return (\n    <PageLayout showNav={false}>\n      <div className=\"flex flex-col items-center space-y-6 md:space-y-8\">\n        <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <CheckCircle2 className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Conversation terminée\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <p className=\"text-base md:text-lg text-foreground leading-relaxed\">\n            Vous avez terminé ce processus de communication guidée. C'est un bel accomplissement!\n          </p>\n\n          <p className=\"text-sm md:text-base text-muted-foreground leading-relaxed\">\n            Prendre le temps d'avoir ce type de conversation demande du courage et de la vulnérabilité. Prenez un moment pour vous remercier mutuellement pour votre présence et votre écoute.\n          </p>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4 text-left space-y-2\">\n            <p className=\"text-sm font-medium text-foreground\">\n              Rappelez-vous :\n            </p>\n            <ul className=\"space-y-1 text-xs md:text-sm text-muted-foreground\">\n              <li>• La communication authentique demande de la pratique</li>\n              <li>• Chaque conversation est une opportunité d'apprendre</li>\n              <li>• La connexion est plus importante que la perfection</li>\n            </ul>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-semibold text-foreground text-center\">\n              Un suivi est-il nécessaire?\n            </h2>\n\n            <div className=\"grid md:grid-cols-3 gap-3 md:gap-4\">\n              {/* Option 1 - Thérapie individuelle */}\n              <div className=\"flex flex-col items-center p-4 md:p-5 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n                <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2 md:mb-3\">\n                  <User className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n                </div>\n                <h3 className=\"text-sm md:text-base font-bold text-foreground mb-2 text-center\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                  Besoin d'une thérapie individuelle\n                </h3>\n                <p className=\"text-xs md:text-sm text-foreground mb-3 text-center\">\n                  Yannick Delorme, Thérapeute\n                </p>\n                <Button\n                  size=\"sm\"\n                  asChild\n                  onClick={handleTherapyClick}\n                  className=\"text-xs md:text-sm px-4 w-full mt-auto\"\n                  data-testid=\"button-therapy-individual\"\n                >\n                  <a href=\"https://www.gorendezvous.com/en/yannickdelormetherapeute\" target=\"_blank\" rel=\"noopener noreferrer\">\n                    Prendre rendez-vous\n                  </a>\n                </Button>\n              </div>\n\n              {/* Option 2 - Thérapie de couple */}\n              <div className=\"flex flex-col items-center p-4 md:p-5 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n                <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2 md:mb-3\">\n                  <Users className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n                </div>\n                <h3 className=\"text-sm md:text-base font-bold text-foreground mb-2 text-center\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                  Besoin d'une thérapie de couple\n                </h3>\n                <p className=\"text-xs md:text-sm text-foreground mb-3 text-center\">\n                  Diane Lapensée, TRA\n                </p>\n                <Button\n                  size=\"sm\"\n                  asChild\n                  onClick={handleTherapyClick}\n                  className=\"text-xs md:text-sm px-4 w-full mt-auto\"\n                  data-testid=\"button-therapy-couple\"\n                >\n                  <a href=\"https://www.gorendezvous.com/fr/Diane_Lapensee_TRA\" target=\"_blank\" rel=\"noopener noreferrer\">\n                    Prendre rendez-vous\n                  </a>\n                </Button>\n              </div>\n\n              {/* Option 3 - Non merci */}\n              <div className=\"flex flex-col items-center p-4 md:p-5 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n                <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2 md:mb-3\">\n                  <Smile className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n                </div>\n                <h3 className=\"text-sm md:text-base font-bold text-foreground mb-2 text-center leading-snug\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                  Non merci, je n'ai pas besoin d'un suivi en thérapie pour l'instant 🙂\n                </h3>\n                <Button\n                  size=\"sm\"\n                  onClick={handleNoThanks}\n                  className=\"text-xs md:text-sm px-4 w-full mt-auto\"\n                  data-testid=\"button-no-thanks\"\n                >\n                  Non merci\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Boutons finaux - toujours visibles mais désactivés jusqu'à ce qu'une option soit choisie */}\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center pt-4\">\n            <Button\n              size=\"lg\"\n              onClick={handleRestart}\n              disabled={!hasChosenOption}\n              className=\"gap-2\"\n              data-testid=\"button-restart\"\n            >\n              <RotateCcw className=\"w-5 h-5\" />\n              Retour à la page d'accueil\n            </Button>\n\n            <Button\n              size=\"lg\"\n              variant=\"outline\"\n              disabled={!hasChosenOption}\n              onClick={() => window.open('https://communaute.avancersimplement.com/feed', '_blank')}\n              className=\"gap-2\"\n              data-testid=\"button-resources\"\n            >\n              <ExternalLink className=\"w-4 h-4\" />\n              Ressources supplémentaires\n            </Button>\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":7267,"size_tokens":null},"client/src/hooks/use-circle-auth.ts":{"content":"import { useEffect, useState, useCallback, useMemo } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { circleUserDataSchema, type CircleUserData } from '@shared/schema';\nimport { setThemeFromCircle } from '@/components/theme-provider';\n\ninterface CircleAuthState {\n  isLoading: boolean;\n  userData: CircleUserData['user'] | null;\n  error: string | null;\n}\n\ninterface AppConfig {\n  requireCircleDomain: boolean;\n  requireCircleLogin: boolean;\n  requirePin: boolean;\n}\n\nconst CIRCLE_ORIGIN = import.meta.env.VITE_CIRCLE_ORIGIN;\nconst CIRCLE_USER_STORAGE_KEY = 'circle_user_data';\nconst CIRCLE_USER_TIMESTAMP_KEY = 'circle_user_timestamp';\nconst MAX_CACHE_AGE_MS = 7 * 24 * 60 * 60 * 1000; // 7 jours de cache\n\nfunction getParentOrigin(): string | null {\n  try {\n    if (document.referrer) {\n      const url = new URL(document.referrer);\n      return url.origin;\n    }\n  } catch {\n    // Invalid referrer\n  }\n  return null;\n}\n\nfunction isValidCircleOrigin(origin: string): boolean {\n  if (!origin) return false;\n  \n  const normalizedOrigin = origin.replace(/\\/$/, '').toLowerCase();\n  \n  // Accept configured origin\n  if (CIRCLE_ORIGIN) {\n    const normalizedConfigured = CIRCLE_ORIGIN.replace(/\\/$/, '').toLowerCase();\n    if (normalizedOrigin === normalizedConfigured) {\n      return true;\n    }\n  }\n  \n  // Accept any Circle.so domain (including custom subdomains)\n  if (normalizedOrigin.includes('circle.so')) {\n    return true;\n  }\n  \n  // Accept communaute.avancersimplement.com\n  if (normalizedOrigin.includes('avancersimplement.com')) {\n    return true;\n  }\n  \n  // In development, be more permissive\n  if (import.meta.env.DEV) {\n    return true;\n  }\n  \n  return false;\n}\n\nfunction getCachedUserData(): CircleUserData['user'] | null {\n  try {\n    const timestamp = localStorage.getItem(CIRCLE_USER_TIMESTAMP_KEY);\n    const data = localStorage.getItem(CIRCLE_USER_STORAGE_KEY);\n    \n    if (!timestamp || !data) return null;\n    \n    const age = Date.now() - parseInt(timestamp, 10);\n    if (age > MAX_CACHE_AGE_MS) {\n      localStorage.removeItem(CIRCLE_USER_STORAGE_KEY);\n      localStorage.removeItem(CIRCLE_USER_TIMESTAMP_KEY);\n      return null;\n    }\n    \n    return JSON.parse(data);\n  } catch {\n    return null;\n  }\n}\n\nfunction setCachedUserData(userData: CircleUserData['user']): void {\n  try {\n    localStorage.setItem(CIRCLE_USER_STORAGE_KEY, JSON.stringify(userData));\n    localStorage.setItem(CIRCLE_USER_TIMESTAMP_KEY, Date.now().toString());\n  } catch {\n    // Silent fail - cache not critical\n  }\n}\n\nexport function clearCircleUserCache(): void {\n  localStorage.removeItem(CIRCLE_USER_STORAGE_KEY);\n  localStorage.removeItem(CIRCLE_USER_TIMESTAMP_KEY);\n}\n\nexport function useCircleAuth() {\n  const { data: configData, isLoading: configLoading } = useQuery<AppConfig>({\n    queryKey: ['/api/config'],\n  });\n  \n  const [state, setState] = useState<CircleAuthState>({\n    isLoading: true,\n    userData: null,\n    error: null,\n  });\n\n  // Detect parent origin - use '*' as fallback to be permissive like the old app\n  const parentOrigin = useMemo(() => {\n    const detected = getParentOrigin();\n    return detected || CIRCLE_ORIGIN || '*';\n  }, []);\n\n  const requestAuthFromParent = useCallback(() => {\n    try {\n      window.parent.postMessage({ type: 'CIRCLE_AUTH_REQUEST' }, parentOrigin);\n    } catch {\n      // Silent fail - parent may not be available\n    }\n  }, [parentOrigin]);\n\n  useEffect(() => {\n    // Wait for config to load\n    if (configLoading) return;\n    \n    const requireCircleDomain = configData?.requireCircleDomain ?? true;\n    const requireCircleLogin = configData?.requireCircleLogin ?? true;\n    \n    // We need Circle handshake if domain OR login is required\n    const needsCircleHandshake = requireCircleDomain || requireCircleLogin;\n\n    // Reset state\n    setState({\n      isLoading: needsCircleHandshake,\n      userData: null,\n      error: null,\n    });\n\n    if (!needsCircleHandshake) {\n      clearCircleUserCache();\n      return;\n    }\n\n    // Check cache first\n    const cachedUser = getCachedUserData();\n    if (cachedUser) {\n      setState({\n        isLoading: false,\n        userData: cachedUser,\n        error: null,\n      });\n      // Still request fresh data in background\n      requestAuthFromParent();\n    }\n\n    let messageReceived = false;\n    let retryCount = 0;\n    const MAX_RETRIES = 20;\n    const RETRY_INTERVAL = 300;\n\n    const handleMessage = (event: MessageEvent) => {\n      // Be permissive with origin validation - accept if it looks like Circle data\n      const hasCircleData = event.data && event.data.type === 'CIRCLE_USER_AUTH';\n      \n      if (!hasCircleData) {\n        return;\n      }\n      \n      try {\n        const data = circleUserDataSchema.parse(event.data);\n        \n        if (data.type === 'CIRCLE_USER_AUTH') {\n          messageReceived = true;\n          setCachedUserData(data.user);\n          \n          if (data.theme) {\n            setThemeFromCircle(data.theme);\n          }\n          \n          setState({\n            isLoading: false,\n            userData: data.user,\n            error: null,\n          });\n        }\n      } catch {\n        // Try to extract email directly as fallback\n        const rawEmail = event.data?.user?.email;\n        if (rawEmail && typeof rawEmail === 'string' && rawEmail.length > 0) {\n          // Check if Liquid template was not replaced\n          if (rawEmail.includes('{{') || rawEmail.includes('}}') || rawEmail.includes('member.')) {\n            console.warn('[Circle Auth] Liquid template not replaced:', rawEmail);\n            setState({\n              isLoading: false,\n              userData: null,\n              error: 'Données Circle.so non chargées. Veuillez vous reconnecter à votre communauté.',\n            });\n            return;\n          }\n          \n          const fallbackUser = {\n            publicUid: event.data.user.publicUid || '',\n            email: rawEmail,\n            name: event.data.user.name || 'Membre',\n            isAdmin: event.data.user.isAdmin === true || event.data.user.isAdmin === 'true',\n            timestamp: Date.now(),\n          };\n          messageReceived = true;\n          setCachedUserData(fallbackUser);\n          setState({\n            isLoading: false,\n            userData: fallbackUser,\n            error: null,\n          });\n        }\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n\n    if (!cachedUser) {\n      requestAuthFromParent();\n\n      const retryInterval = setInterval(() => {\n        if (messageReceived) {\n          clearInterval(retryInterval);\n          return;\n        }\n        \n        retryCount++;\n        \n        if (retryCount >= MAX_RETRIES) {\n          clearInterval(retryInterval);\n          setState({\n            isLoading: false,\n            userData: null,\n            error: 'Accès depuis Circle.so requis. Veuillez vous connecter à votre communauté.',\n          });\n          return;\n        }\n        \n        requestAuthFromParent();\n      }, RETRY_INTERVAL);\n\n      return () => {\n        window.removeEventListener('message', handleMessage);\n        clearInterval(retryInterval);\n      };\n    }\n\n    return () => {\n      window.removeEventListener('message', handleMessage);\n    };\n  }, [configData?.requireCircleDomain, configData?.requireCircleLogin, configLoading, parentOrigin, requestAuthFromParent]);\n\n  return state;\n}\n","path":null,"size_bytes":7399,"size_tokens":null},"client/src/pages/DuoInversionPage7a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { RefreshCw, ArrowRight } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage7a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <RefreshCw className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Découvrir la perspective de {session.senderName}\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n            <p className=\"text-lg leading-relaxed text-foreground\">\n              Vous allez maintenant inverser les rôles pour explorer la même situation du point de vue de {session.receiverName}.\n            </p>\n\n            <p className=\"text-lg font-medium leading-relaxed text-foreground\">\n              À {session.receiverName} d'exprimer son vécu!\n            </p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              Ce qui change :\n            </h2>\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  <strong>{session.receiverName}</strong> partage son vécu et sa vision <strong>de la même situation</strong>\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  <strong>{session.senderName}</strong> écoute bienveillant dans le silence, comme lors du premier tour\n                </span>\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              Pourquoi c'est important :\n            </h2>\n            <p className=\"text-base md:text-lg leading-relaxed text-muted-foreground\">\n              Cette étape permet d'explorer les deux perspectives d'une même situation. Chacun a vécu les mêmes événements différemment, et comprendre le point de vue de l'autre enrichit votre compréhension mutuelle.\n            </p>\n          </div>\n\n          <p className=\"text-base md:text-lg leading-relaxed text-muted-foreground text-center italic\">\n            Prenez le temps de bien vous installer dans vos nouveaux rôles. L'écoute bienveillante reste tout aussi importante dans ce deuxième tour.\n          </p>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(26)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-start\"\n            >\n              C'est parti !\n              <ArrowRight className=\"w-5 h-5 ml-2\" />\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3868,"size_tokens":null},"client/src/pages/DuoInversionPage14a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Heart, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage14a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Ton vécu après l'écoute\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, comment te sens-tu maintenant?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Parle de ce que tu vis en lien avec ce que tu viens d'entendre de la part de {session.receiverName}\n            </p>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à ce que tu viens de me dire, je me sens...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Tu peux avoir plusieurs émotions en même temps\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste dans le moment présent\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste en lien avec ton vécu face à celui de {session.receiverName}\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                C'est le moment d'exprimer honnêtement ce que TU ressens maintenant, après avoir écouté {session.receiverName}. Tu peux te sentir triste, touché, inconfortable, coupable, incompris, ou toute autre émotion.\n              </p>\n              <p className=\"mb-4\">\n                Il est normal de vouloir te défendre ou te justifier, mais ce n'est pas le moment. Pour l'instant, nomme simplement tes émotions face à ce que tu viens d'entendre.\n              </p>\n              <p>\n                Tu pourras relever certains points qui te semblent importants, mais reviens toujours à ton vécu émotionnel. Par exemple : \"Quand tu dis que tu t'es senti ignoré, je me sens incompris parce que dans ma tête j'étais concentré, mais je reconnais que je me sens aussi mal à l'aise en réalisant l'impact que ça a eu sur toi.\"\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"rounded-lg border border-destructive/30 bg-destructive/5 p-4 space-y-2\">\n            <p className=\"text-sm font-medium text-destructive\">À éviter à cette étape :</p>\n            <ul className=\"text-sm text-destructive space-y-1 pl-4\">\n              <li>• Te justifier ou te défendre</li>\n              <li>• Expliquer ton point de vue sur la situation</li>\n              <li>• Minimiser ce que {session.receiverName} ressent</li>\n            </ul>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(33)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-next\"\n              >\n                J'ai terminé\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":5197,"size_tokens":null},"client/src/pages/Welcome.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Progress } from '@/components/ui/progress';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { useSession } from '@/contexts/SessionContext';\nimport { Heart, Users } from 'lucide-react';\n\nexport default function Welcome() {\n  const { updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const handleChoice = (type: 'solo' | 'duo') => {\n    updateSession({ appType: type });\n    transitionToStep(1);\n  };\n\n  return (\n    <PageLayout showNav={true}>\n      <div className=\"flex items-center justify-center min-h-[calc(100vh-180px)] md:min-h-[60vh]\">\n        <div className=\"max-w-2xl mx-auto text-center space-y-4 md:space-y-8 py-4\">\n          <div className=\"space-y-1\">\n            <div className=\"inline-flex items-center justify-center w-[80px] h-[80px] md:w-[120px] md:h-[120px]\">\n              <img \n                src=\"/logo-blue.png\" \n                alt=\"Avancer Simplement Logo\" \n                className=\"w-[80px] h-[80px] md:w-[120px] md:h-[120px] dark:hidden\"\n              />\n              <img \n                src=\"/logo-white.png\" \n                alt=\"Avancer Simplement Logo\" \n                className=\"w-[80px] h-[80px] md:w-[120px] md:h-[120px] hidden dark:block\"\n              />\n            </div>\n            <div className=\"text-lg md:text-2xl font-black italic text-primary\" style={{ fontFamily: 'Montserrat, sans-serif' }}>\n              AVANCER SIMPLEMENT\n            </div>\n          </div>\n\n          <div className=\"text-sm md:text-lg text-muted-foreground tracking-wide italic\">\n            Présente\n          </div>\n\n          <h1 className=\"text-4xl md:text-6xl lg:text-7xl font-bold text-foreground pt-2 md:pt-6 tracking-tight\" style={{ fontFamily: 'Figtree, sans-serif', textShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>\n            Duo-Connecte\n          </h1>\n\n          <p className=\"text-sm md:text-lg text-foreground leading-relaxed max-w-lg mx-auto pt-3 md:pt-4 px-4\">\n            Un outil pour faciliter la gestion des émotions (relation à soi) et la communication authentique (relation à l'autre)\n          </p>\n\n          <div className=\"grid md:grid-cols-2 gap-3 md:gap-4 pt-6 md:pt-8 max-w-2xl mx-auto px-4\">\n            <div className=\"flex flex-col items-center space-y-2 md:space-y-3 p-4 md:p-6 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n              <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                <Heart className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n              </div>\n              <h2 className=\"text-base md:text-lg font-bold text-foreground\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                Régulation émotionnelle\n              </h2>\n              <p className=\"text-xs md:text-sm text-muted-foreground text-center leading-relaxed\">\n                Gérer vos émotions en solo\n              </p>\n              <Button\n                size=\"default\"\n                onClick={() => handleChoice('solo')}\n                disabled={isTransitioning}\n                className=\"text-xs md:text-sm px-4 md:px-6 w-full mt-2\"\n                data-testid=\"button-solo\"\n              >\n                Parcours Solo\n              </Button>\n            </div>\n\n            <div className=\"flex flex-col items-center space-y-2 md:space-y-3 p-4 md:p-6 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n              <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                <Users className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n              </div>\n              <h2 className=\"text-base md:text-lg font-bold text-foreground\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                Communication authentique\n              </h2>\n              <p className=\"text-xs md:text-sm text-muted-foreground text-center leading-relaxed\">\n                Dialoguer et se comprendre à deux\n              </p>\n              <Button\n                size=\"default\"\n                onClick={() => handleChoice('duo')}\n                disabled={isTransitioning}\n                className=\"text-xs md:text-sm px-4 md:px-6 w-full mt-2\"\n                data-testid=\"button-duo\"\n              >\n                Parcours Duo\n              </Button>\n            </div>\n          </div>\n\n          {isTransitioning && (\n            <div className=\"pt-4\">\n              <Progress value={progress} className=\"w-full md:w-96 mx-auto\" />\n            </div>\n          )}\n\n          <p className=\"text-xs md:text-sm text-muted-foreground pt-4 md:pt-6 max-w-lg mx-auto leading-relaxed px-4\">\n            Cet outil s'utilise uniquement en présentiel pour l'instant.<br />\n            Assurez-vous d'être ensemble et disposés à vous connecter.\n          </p>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":5058,"size_tokens":null},"client/src/pages/DuoInversionPage17a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Lightbulb } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage17a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Lightbulb className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Passons aux besoins!\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4 text-center\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              Êtes-vous prêts à passer à l'étape suivante?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-foreground leading-relaxed\">\n              Vous allez maintenant aborder la question des besoins et des demandes du point de vue de {session.receiverName}. C'est le moment de formuler ce qui pourrait améliorer la situation.\n            </p>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Continuez à prendre votre temps et à écouter avec bienveillance.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(36)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-continue\"\n              >\n                Oui, on continue\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2376,"size_tokens":null},"client/src/pages/DuoReceiverGrounding.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Anchor } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverGrounding() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Anchor className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <div className=\"flex flex-col items-center gap-2\">\n          <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n            Ici et maintenant\n          </h1>\n          <span className=\"text-sm text-muted-foreground\">2/2</span>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, prends le temps de te déposer...\n            </h2>\n\n            <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n              Comment te sens-tu à l'idée d'écouter {session.senderName}?\n            </p>\n          </div>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Parle de ce que tu ressens maintenant, en ce moment précis\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Exprime ton état d'esprit face à cette conversation qui arrive\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends le temps de reconnaître tes émotions présentes\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                En tant que récepteur, ton rôle est d'écouter avec bienveillance. Mais avant de pouvoir vraiment écouter l'autre, il est important que tu reconnaisses ton propre état émotionnel.\n              </p>\n              <p>\n                Peut-être ressens-tu de l'ouverture, de la curiosité, mais aussi peut-être de l'appréhension ou de la défensive. Tous ces ressentis sont valides. Les exprimer maintenant te permet de les reconnaître et de te préparer à accueillir ce que {session.senderName} va partager.\n              </p>\n            </ExpandableSection>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col items-center pt-4 space-y-4\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(6)}\n            disabled={isTransitioning}\n            className=\"px-12\"\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-64\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3796,"size_tokens":null},"client/src/pages/SoloRoles.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Users } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Roles() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n  const [senderName, setSenderName] = useState(session.senderName || '');\n  const [receiverName, setReceiverName] = useState(session.receiverName || '');\n\n  const handleContinue = () => {\n    if (senderName.trim() && receiverName.trim()) {\n      updateSession({ senderName: senderName.trim(), receiverName: receiverName.trim() });\n      transitionToStep(2);\n    }\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-2\">\n          <Users className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Qui est qui?\n        </h1>\n\n        <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n          Identifiez vos rôles pour cette conversation. Ces noms seront utilisés tout au long du processus pour personnaliser l'expérience.\n        </p>\n\n        <div className=\"rounded-lg border border-border bg-muted/30 p-6 space-y-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"w-6 h-6 rounded-full bg-primary flex items-center justify-center flex-shrink-0 mt-1\">\n              <span className=\"text-xs font-semibold text-primary-foreground\">1</span>\n            </div>\n            <div>\n              <h3 className=\"font-medium text-foreground mb-1\">L'émetteur</h3>\n              <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                La personne qui souhaite parler d'une situation et partager son vécu\n              </p>\n            </div>\n          </div>\n          <div className=\"flex items-start gap-3\">\n            <div className=\"w-6 h-6 rounded-full bg-accent flex items-center justify-center flex-shrink-0 mt-1\">\n              <span className=\"text-xs font-semibold text-accent-foreground\">2</span>\n            </div>\n            <div>\n              <h3 className=\"font-medium text-foreground mb-1\">Le récepteur</h3>\n              <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                La personne qui écoute avec attention et bienveillance\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"space-y-5 md:space-y-6\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"sender-name\" className=\"text-base\">\n              Nom de l'émetteur\n            </Label>\n            <Input\n              id=\"sender-name\"\n              type=\"text\"\n              placeholder=\"Prénom ou surnom\"\n              value={senderName}\n              onChange={(e) => setSenderName(e.target.value)}\n              className=\"text-base\"\n              data-testid=\"input-sender-name\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"receiver-name\" className=\"text-base\">\n              Nom du récepteur\n            </Label>\n            <Input\n              id=\"receiver-name\"\n              type=\"text\"\n              placeholder=\"Prénom ou surnom\"\n              value={receiverName}\n              onChange={(e) => setReceiverName(e.target.value)}\n              className=\"text-base\"\n              data-testid=\"input-receiver-name\"\n            />\n          </div>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={handleContinue}\n            disabled={!senderName.trim() || !receiverName.trim() || isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4415,"size_tokens":null},"client/src/pages/DuoInversionPage19a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Handshake, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage19a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Handshake className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          On peut s'entendre?\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName}: écoute avec ouverture\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, est-ce que la demande de {session.receiverName} fait du sens pour toi?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Est-ce que tu es capable et volontaire pour répondre à la demande de {session.receiverName}?\n            </p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Exprime ce que tu peux ou ne peux pas offrir\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Propose des alternatives si nécessaire\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sois honnête sur tes limites\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                {session.receiverName} vient de formuler une demande. Ton rôle maintenant est d'y répondre avec authenticité. Tu peux :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Accepter complètement :</strong> \"Oui, je peux faire ça\"</li>\n                <li><strong>Accepter partiellement :</strong> \"Je ne peux pas promettre tous les soirs, mais je peux m'engager à le faire trois fois par semaine\"</li>\n                <li><strong>Proposer une alternative :</strong> \"Ce que tu demandes est difficile pour moi, mais je pourrais plutôt...\"</li>\n                <li><strong>Refuser avec respect :</strong> \"Je ne peux pas faire ça parce que... mais je comprends que c'est important pour toi\"</li>\n              </ul>\n              <p>\n                L'important est d'être honnête. Une fausse promesse créera plus de problèmes qu'une limite clairement exprimée.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(38)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-finished\"\n              >\n                Prochaine étape\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4537,"size_tokens":null},"client/src/pages/DuoSenderGrounding.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Anchor } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderGrounding() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Anchor className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <div className=\"flex flex-col items-center gap-2\">\n          <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n            Ici et maintenant\n          </h1>\n          <span className=\"text-sm text-muted-foreground\">1/2</span>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, prends le temps de te déposer...\n            </h2>\n\n            <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n              Comment te sens-tu à l'idée de t'exprimer à {session.receiverName}?\n            </p>\n          </div>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Parle de ce que tu ressens maintenant, en ce moment précis\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Ne parle pas encore du sujet de la conversation\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends tout ton temps pour exprimer ton état présent\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Cette étape te permet de te connecter à ton état émotionnel actuel avant d'aborder le sujet qui te préoccupe. C'est un moment pour toi de reconnaître ce que tu vis maintenant : peut-être de la nervosité, de l'appréhension, de l'espoir, ou toute autre émotion.\n              </p>\n              <p>\n                En exprimant ces ressentis à voix haute, tu te prépares intérieurement et tu permets à l'autre de comprendre ton état d'esprit avant même que la conversation commence vraiment.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(5)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3833,"size_tokens":null},"client/src/components/admin/AdminFeedbacks.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Star, Download, Archive, ArchiveRestore, Trash2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Feedback } from \"@shared/schema\";\nimport {\n    AlertDialog,\n    AlertDialogAction,\n    AlertDialogCancel,\n    AlertDialogContent,\n    AlertDialogDescription,\n    AlertDialogFooter,\n    AlertDialogHeader,\n    AlertDialogTitle,\n    AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\n\nexport function AdminFeedbacks() {\n    const { toast } = useToast();\n    const queryClient = useQueryClient();\n    const [showArchived, setShowArchived] = useState(false);\n\n    const getAuthHeader = () => {\n        const token = localStorage.getItem('session_token');\n        return {\n            \"Authorization\": `Bearer ${token}`,\n            \"Content-Type\": \"application/json\",\n        };\n    };\n\n    const { data: feedbacks, isLoading, error } = useQuery<Feedback[]>({\n        queryKey: [\"/api/admin/feedbacks\", showArchived ? \"archived\" : \"active\"],\n        queryFn: async () => {\n            const endpoint = showArchived ? \"/api/admin/feedbacks/archived\" : \"/api/admin/feedbacks\";\n            const response = await fetch(endpoint, {\n                headers: getAuthHeader(),\n            });\n\n            if (!response.ok) {\n                throw new Error(\"Accès non autorisé\");\n            }\n\n            return response.json();\n        },\n    });\n\n    const archiveMutation = useMutation({\n        mutationFn: async (id: string) => {\n            const response = await fetch(`/api/admin/feedbacks/${id}/archive`, {\n                method: 'PATCH',\n                headers: getAuthHeader(),\n            });\n            if (!response.ok) throw new Error(\"Erreur lors de l'archivage\");\n            return response.json();\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/admin/feedbacks\"] });\n            toast({\n                title: \"Feedback archivé\",\n                description: \"Le feedback a été déplacé dans les archives\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Erreur\",\n                description: \"Impossible d'archiver le feedback\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const unarchiveMutation = useMutation({\n        mutationFn: async (id: string) => {\n            const response = await fetch(`/api/admin/feedbacks/${id}/unarchive`, {\n                method: 'PATCH',\n                headers: getAuthHeader(),\n            });\n            if (!response.ok) throw new Error(\"Erreur lors de la restauration\");\n            return response.json();\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/admin/feedbacks\"] });\n            toast({\n                title: \"Feedback restauré\",\n                description: \"Le feedback a été restauré\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Erreur\",\n                description: \"Impossible de restaurer le feedback\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    const deleteMutation = useMutation({\n        mutationFn: async (id: string) => {\n            const response = await fetch(`/api/admin/feedbacks/${id}`, {\n                method: 'DELETE',\n                headers: getAuthHeader(),\n            });\n            if (!response.ok) throw new Error(\"Erreur lors de la suppression\");\n            return response.json();\n        },\n        onSuccess: () => {\n            queryClient.invalidateQueries({ queryKey: [\"/api/admin/feedbacks\"] });\n            toast({\n                title: \"Feedback supprimé\",\n                description: \"Le feedback a été supprimé définitivement\",\n            });\n        },\n        onError: () => {\n            toast({\n                title: \"Erreur\",\n                description: \"Impossible de supprimer le feedback\",\n                variant: \"destructive\",\n            });\n        },\n    });\n\n    useEffect(() => {\n        if (error) {\n            toast({\n                title: \"Erreur\",\n                description: \"Impossible de charger les feedbacks\",\n                variant: \"destructive\",\n            });\n        }\n    }, [error, toast]);\n\n    const generateMarkdown = (feedbacks: Feedback[]) => {\n        let markdown = \"# Feedbacks Duo-Connecte\\n\\n\";\n        markdown += `**Exporté le:** ${new Date().toLocaleString(\"fr-FR\", { dateStyle: \"full\", timeStyle: \"short\" })}\\n\\n`;\n        markdown += `**Total:** ${feedbacks.length} feedback(s)\\n\\n`;\n        markdown += \"---\\n\\n\";\n\n        feedbacks.forEach((feedback, index) => {\n            markdown += `## Feedback #${index + 1}\\n\\n`;\n            markdown += `**Date:** ${new Date(feedback.createdAt).toLocaleString(\"fr-FR\", { dateStyle: \"full\", timeStyle: \"short\" })}\\n\\n`;\n\n            const stars = \"⭐\".repeat(Math.floor(feedback.rating ?? 0));\n            const halfStar = (feedback.rating ?? 0) % 1 !== 0 ? \"½\" : \"\";\n            markdown += `**Note:** ${stars}${halfStar} (${feedback.rating}/5)\\n\\n`;\n\n            if (feedback.helpfulAspect) {\n                markdown += `### Ce qui a été le plus utile\\n\\n`;\n                markdown += `${feedback.helpfulAspect}\\n\\n`;\n            }\n\n            if (feedback.improvementSuggestion) {\n                markdown += `### Ce qui pourrait être amélioré\\n\\n`;\n                markdown += `${feedback.improvementSuggestion}\\n\\n`;\n            }\n\n            if (!feedback.helpfulAspect && !feedback.improvementSuggestion) {\n                markdown += `*Aucun commentaire fourni*\\n\\n`;\n            }\n\n            markdown += \"---\\n\\n\";\n        });\n\n        return markdown;\n    };\n\n    const handleDownloadMarkdown = () => {\n        if (!feedbacks || feedbacks.length === 0) {\n            toast({\n                title: \"Aucun feedback\",\n                description: \"Il n'y a pas de feedbacks à télécharger.\",\n                variant: \"destructive\",\n            });\n            return;\n        }\n\n        const markdown = generateMarkdown(feedbacks);\n        const blob = new Blob([markdown], { type: \"text/markdown;charset=utf-8\" });\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement(\"a\");\n        const filename = `feedbacks-duo-connecte-${showArchived ? 'archives-' : ''}${new Date().toISOString().split('T')[0]}.md`;\n\n        link.href = url;\n        link.download = filename;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n\n        toast({\n            title: \"Téléchargement réussi\",\n            description: `${feedbacks.length} feedback(s) exporté(s) en Markdown`,\n        });\n    };\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                <div>\n                    <h2 className=\"text-xl font-semibold\">\n                        {showArchived ? \"Feedbacks archivés\" : \"Feedbacks des utilisateurs\"}\n                    </h2>\n                    <p className=\"text-muted-foreground\">\n                        {feedbacks?.length || 0} feedback(s) {showArchived ? \"archivé(s)\" : \"actif(s)\"}\n                    </p>\n                </div>\n                <div className=\"flex items-center gap-2 flex-wrap\">\n                    <Button\n                        variant={showArchived ? \"default\" : \"outline\"}\n                        onClick={() => setShowArchived(!showArchived)}\n                        data-testid=\"button-toggle-archived\"\n                    >\n                        {showArchived ? (\n                            <>\n                                <ArchiveRestore className=\"h-4 w-4 mr-2\" />\n                                Voir les actifs\n                            </>\n                        ) : (\n                            <>\n                                <Archive className=\"h-4 w-4 mr-2\" />\n                                Voir les archives\n                            </>\n                        )}\n                    </Button>\n                    <Button\n                        variant=\"default\"\n                        onClick={handleDownloadMarkdown}\n                        disabled={!feedbacks || feedbacks.length === 0}\n                        data-testid=\"button-download-markdown\"\n                    >\n                        <Download className=\"h-4 w-4 mr-2\" />\n                        Télécharger Markdown\n                    </Button>\n                </div>\n            </div>\n\n            {isLoading && (\n                <div className=\"text-center py-12\">\n                    <p className=\"text-muted-foreground\">Chargement des feedbacks...</p>\n                </div>\n            )}\n\n            {feedbacks && feedbacks.length === 0 && (\n                <Card>\n                    <CardContent className=\"py-12 text-center\">\n                        <p className=\"text-muted-foreground\">\n                            {showArchived ? \"Aucun feedback archivé\" : \"Aucun feedback pour le moment\"}\n                        </p>\n                    </CardContent>\n                </Card>\n            )}\n\n            <div className=\"grid gap-4\">\n                {feedbacks?.map((feedback) => (\n                    <Card key={feedback.id} data-testid={`card-feedback-${feedback.id}`}>\n                        <CardHeader>\n                            <div className=\"flex items-start justify-between gap-4\">\n                                <div className=\"space-y-2\">\n                                    <div className=\"flex items-center gap-2\">\n                                        {[1, 2, 3, 4, 5].map((star) => (\n                                            <Star\n                                                key={star}\n                                                className={`h-5 w-5 ${star <= (feedback.rating ?? 0)\n                                                    ? \"fill-yellow-400 text-yellow-400\"\n                                                    : \"text-gray-300\"\n                                                    }`}\n                                            />\n                                        ))}\n                                        <span className=\"font-semibold text-lg ml-2\">\n                                            {feedback.rating}/5\n                                        </span>\n                                    </div>\n                                    <p className=\"text-sm text-muted-foreground\">\n                                        {new Date(feedback.createdAt).toLocaleString(\"fr-FR\", {\n                                            dateStyle: \"full\",\n                                            timeStyle: \"short\",\n                                        })}\n                                    </p>\n                                </div>\n                                <div className=\"flex items-center gap-2\">\n                                    {showArchived ? (\n                                        <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            onClick={() => unarchiveMutation.mutate(feedback.id)}\n                                            disabled={unarchiveMutation.isPending}\n                                            data-testid={`button-unarchive-${feedback.id}`}\n                                        >\n                                            <ArchiveRestore className=\"h-4 w-4 mr-1\" />\n                                            Restaurer\n                                        </Button>\n                                    ) : (\n                                        <Button\n                                            variant=\"outline\"\n                                            size=\"sm\"\n                                            onClick={() => archiveMutation.mutate(feedback.id)}\n                                            disabled={archiveMutation.isPending}\n                                            data-testid={`button-archive-${feedback.id}`}\n                                        >\n                                            <Archive className=\"h-4 w-4 mr-1\" />\n                                            Archiver\n                                        </Button>\n                                    )}\n                                    <AlertDialog>\n                                        <AlertDialogTrigger asChild>\n                                            <Button\n                                                variant=\"destructive\"\n                                                size=\"sm\"\n                                                data-testid={`button-delete-${feedback.id}`}\n                                            >\n                                                <Trash2 className=\"h-4 w-4\" />\n                                            </Button>\n                                        </AlertDialogTrigger>\n                                        <AlertDialogContent>\n                                            <AlertDialogHeader>\n                                                <AlertDialogTitle>Supprimer ce feedback ?</AlertDialogTitle>\n                                                <AlertDialogDescription>\n                                                    Cette action est irréversible. Le feedback sera définitivement supprimé.\n                                                </AlertDialogDescription>\n                                            </AlertDialogHeader>\n                                            <AlertDialogFooter>\n                                                <AlertDialogCancel>Annuler</AlertDialogCancel>\n                                                <AlertDialogAction\n                                                    onClick={() => deleteMutation.mutate(feedback.id)}\n                                                    data-testid={`button-confirm-delete-${feedback.id}`}\n                                                >\n                                                    Supprimer\n                                                </AlertDialogAction>\n                                            </AlertDialogFooter>\n                                        </AlertDialogContent>\n                                    </AlertDialog>\n                                </div>\n                            </div>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                            {feedback.helpfulAspect && (\n                                <div>\n                                    <h3 className=\"font-semibold mb-1 text-sm text-muted-foreground\">\n                                        Ce qui a été le plus utile :\n                                    </h3>\n                                    <p className=\"text-base\">{feedback.helpfulAspect}</p>\n                                </div>\n                            )}\n                            {feedback.improvementSuggestion && (\n                                <div>\n                                    <h3 className=\"font-semibold mb-1 text-sm text-muted-foreground\">\n                                        Ce qui pourrait être amélioré :\n                                    </h3>\n                                    <p className=\"text-base\">{feedback.improvementSuggestion}</p>\n                                </div>\n                            )}\n                            {!feedback.helpfulAspect && !feedback.improvementSuggestion && (\n                                <p className=\"text-muted-foreground italic\">\n                                    Aucun commentaire fourni\n                                </p>\n                            )}\n                        </CardContent>\n                    </Card>\n                ))}\n            </div>\n        </div>\n    );\n}\n","path":null,"size_bytes":16314,"size_tokens":null},"client/src/components/PersistentNav.tsx":{"content":"import { ArrowLeft, Lock, Home } from 'lucide-react';\nimport { useLocation } from 'wouter';\nimport { Button } from '@/components/ui/button';\nimport { ThemeToggle } from '@/components/ThemeToggle';\nimport { getSessionToken } from '@/lib/auth';\nimport { useQuery } from '@tanstack/react-query';\n\ninterface PersistentNavProps {\n  showBack?: boolean;\n  onBack?: () => void;\n  canGoBack?: boolean;\n}\n\nexport function PersistentNav({ \n  showBack = true, \n  onBack,\n  canGoBack = false\n}: PersistentNavProps) {\n  const [location, setLocation] = useLocation();\n  const sessionToken = getSessionToken();\n  const isLoggedIn = !!sessionToken;\n\n  const { data: userData } = useQuery({\n    queryKey: ['/api/auth/me'],\n    queryFn: async () => {\n      if (!sessionToken) return null;\n      const response = await fetch('/api/auth/me', {\n        headers: {\n          'Authorization': `Bearer ${sessionToken}`,\n        },\n      });\n      if (!response.ok) return null;\n      return response.json();\n    },\n    enabled: isLoggedIn,\n    retry: false,\n  });\n\n  const isAdmin = userData?.isAdmin || false;\n  const isOnAuthPage = location === '/admin-login';\n  const isOnAdminPage = location === '/admin';\n\n  return (\n    <div className=\"fixed bottom-0 left-0 right-0 bg-background/95 backdrop-blur-sm border-t border-border p-3 md:p-6 z-40\" data-testid=\"persistent-nav\">\n      <div className=\"max-w-3xl mx-auto flex flex-wrap items-center gap-2 md:gap-3 justify-between pointer-events-auto\">\n        <div className=\"flex items-center gap-2 md:gap-3\">\n          {showBack && canGoBack && onBack && (\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={onBack}\n              className=\"gap-2\"\n              data-testid=\"button-back\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n              <span className=\"hidden md:inline\">Retour</span>\n            </Button>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {isLoggedIn && isAdmin ? (\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setLocation('/')}\n              data-testid=\"button-nav-home\"\n            >\n              <Home className=\"w-4 h-4\" />\n            </Button>\n          ) : !isOnAuthPage && (\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => setLocation('/admin-login')}\n              data-testid=\"button-nav-login\"\n            >\n              <Lock className=\"w-4 h-4\" />\n            </Button>\n          )}\n          <ThemeToggle />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2646,"size_tokens":null},"client/src/pages/DuoTransition1.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Play, ArrowRight } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Transition1() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Play className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Prêts à continuer?\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n            <p className=\"text-lg leading-relaxed text-foreground\">\n              Vous allez maintenant entrer dans le vif du sujet. L'émetteur va partager son vécu pendant que le récepteur écoute avec attention.\n            </p>\n\n            <p className=\"text-base text-muted-foreground leading-relaxed\">\n              Rappelez-vous : prenez votre temps à chaque étape. Il n'y a aucune urgence.\n            </p>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(7)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-continue\"\n            >\n              Oui, on continue\n              <ArrowRight className=\"w-5 h-5 ml-2\" />\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2025,"size_tokens":null},"client/src/pages/DuoWarnings.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { AlertTriangle } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Warnings() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const warnings = [\n    \"Cet outil n'est pas un substitut à une thérapie relationnelle\",\n    \"Vous devez avoir un minimum de compétences relationnelles, de responsabilité et de gestion émotionnelle pour pouvoir utiliser cet outil convenablement\",\n    \"Cet outil n'est pas fait pour gérer les crises, si vous êtes trop déclenché et que vous avez de la difficulté à gérer vos émotions, prenez un temps chacun de votre côté pour décanter\",\n    \"Le piège principal est d'aller trop vite. Un rythme lent est essentiel pour que cet outil soit efficace\",\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-destructive/10\">\n          <AlertTriangle className=\"w-8 h-8 text-destructive\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Avant de commencer\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-3 md:space-y-4\">\n          {warnings.map((warning, index) => (\n            <div\n              key={index}\n              className=\"flex items-start gap-4 p-4 rounded-lg bg-card border border-card-border\"\n              data-testid={`warning-${index}`}\n            >\n              <div className=\"w-6 h-6 rounded-full bg-destructive/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n                <span className=\"text-sm font-semibold text-destructive\">!</span>\n              </div>\n              <p className=\"text-base md:text-lg leading-relaxed text-foreground\">\n                {warning}\n              </p>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"flex flex-col items-center pt-4 space-y-4\">\n          <Button\n            size=\"lg\"\n            variant=\"outline\"\n            onClick={() => transitionToStep(3)}\n            disabled={isTransitioning}\n            className=\"px-12 text-destructive border-destructive hover:bg-destructive/10\"\n            data-testid=\"button-understood\"\n          >\n            J'ai compris, continuer\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-64 [&>div]:bg-destructive\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2720,"size_tokens":null},"client/src/pages/SoloReceiverClosing.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverClosing() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.receiverName}, comment te sens-tu maintenant?\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Après cet échange, partage ton ressenti\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Après cet échange, je me sens...\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ce qui me reste de cette conversation...\n              </span>\n            </li>\n          </ul>\n        </div>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n          <p className=\"text-sm text-foreground\">\n            Reconnaissez mutuellement l'effort et le courage qu'il a fallu pour avoir cette conversation.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(25)}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            disabled={isTransitioning}\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2250,"size_tokens":null},"client/src/pages/DuoInversionPage8a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage8a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme ton vécu\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, parle de ce que tu as vécu face à cette même situation\n            </h2>\n\n            <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à cette situation, je me sens...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste sur toi et tes émotions\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends ton temps pour identifier et nommer ce que tu ressens\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                C'est le moment de partager tes émotions face à la situation dont {session.senderName} vient de parler. Nomme précisément ce que tu ressens : tristesse, colère, frustration, déception, peur, etc.\n              </p>\n              <p className=\"mb-4\">\n                Reste dans le moment présent et parle de TES émotions, pas de ce que l'autre a fait ou devrait faire. Utilise des phrases comme \"Je me sens...\" plutôt que \"Tu m'as fait sentir...\".\n              </p>\n              <p>\n                Il est normal d'avoir plusieurs émotions en même temps. Prends le temps de les identifier et de les exprimer toutes.\n              </p>\n            </ExpandableSection>\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(27)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-continue\"\n            >\n              On continue!\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3929,"size_tokens":null},"client/src/pages/DuoInversionPage16a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { CheckCheck } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage16a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <CheckCheck className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Tu as été bien entendu {session.senderName}?\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4 text-center\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName} vient de reformuler ce que tu as partagé\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Si {session.receiverName} a bien compris tes émotions, tu peux continuer. Sinon, prends le temps de rectifier et de préciser ce qui est important pour toi.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(35)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-confirm\"\n              >\n                <CheckCheck className=\"w-5 h-5 mr-2\" />\n                J'ai été entendu\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2271,"size_tokens":null},"client/src/pages/DuoInversionPage13a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { CheckCheck, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage13a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <CheckCheck className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Valide et rectifie si nécessaire\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName} : écoute attentive\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName} vient de reformuler ce que tu as partagé, est-ce que tu as bien été entendu?\n            </h2>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Si {session.senderName} a bien compris, tu peux continuer\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sinon, prends le temps de clarifier et préciser\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  C'est normal de devoir ajuster la compréhension\n                </span>\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n            <p className=\"text-base font-medium text-foreground mb-2\">\n              Prends le temps nécessaire\n            </p>\n            <p className=\"text-sm text-foreground\">\n              Il est important que tu te sentes vraiment entendu avant de passer à la suite. N'hésite pas à rectifier ou préciser si quelque chose n'a pas été bien compris.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(32)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-confirm\"\n              >\n                <CheckCheck className=\"w-5 h-5 mr-2\" />\n                J'ai bien été entendu\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3734,"size_tokens":null},"client/src/pages/SoloReceiverExperience.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverExperience() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <WarningBanner type=\"speaker\" speaker={session.senderName}>\n            {session.senderName} écoute sans parler\n          </WarningBanner>\n\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.receiverName}, comment te sens-tu maintenant?\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Parle de ton vécu immédiat\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à ce que tu viens de me dire, je me sens...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Tu peux avoir plusieurs émotions en même temps\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste dans le moment présent\n                </span>\n              </li>\n            </ul>\n\n            <div className=\"rounded-lg border border-destructive/30 bg-destructive/5 p-4 space-y-2\">\n              <p className=\"text-sm font-medium text-destructive\">À éviter à cette étape :</p>\n              <ul className=\"text-sm text-destructive space-y-1 pl-4\">\n                <li>• Te justifier ou te défendre</li>\n                <li>• Expliquer ton point de vue sur la situation</li>\n                <li>• Minimiser ce que {session.senderName} ressent</li>\n              </ul>\n            </div>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                C'est le moment d'exprimer honnêtement ce que TU ressens maintenant, après avoir écouté {session.senderName}. Tu peux te sentir triste, touché, inconfortable, coupable, incompris, ou toute autre émotion.\n              </p>\n              <p className=\"mb-4\">\n                Il est normal de vouloir te défendre ou te justifier, mais ce n'est pas le moment. Pour l'instant, nomme simplement tes émotions face à ce que tu viens d'entendre.\n              </p>\n              <p>\n                Tu pourras relever certains points qui te semblent importants, mais reviens toujours à ton vécu émotionnel. Par exemple : \"Quand tu dis que je t'ai ignoré, je me sens incompris parce que dans ma tête j'étais concentré, mais je reconnais que je me sens aussi mal à l'aise en réalisant l'impact que ça a eu sur toi.\"\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(17)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":4116,"size_tokens":null},"client/src/pages/DuoThanks.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Award, CheckCircle2 } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Thanks() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n  const [followUpNeeded, setFollowUpNeeded] = useState<boolean | null>(\n    session.suiviNecessaire ?? null\n  );\n\n  const handleContinue = () => {\n    if (followUpNeeded !== null) {\n      updateSession({ suiviNecessaire: followUpNeeded });\n      transitionToStep(25);\n    }\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/10 mb-2\">\n          <Award className=\"w-10 h-10 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Félicitations!\n        </h1>\n\n        <div className=\"space-y-5 md:space-y-6\">\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n            <p className=\"text-lg leading-relaxed text-foreground\">\n              Vous avez terminé ce processus de communication guidée. C'est un bel accomplissement!\n            </p>\n\n            <p className=\"text-base text-muted-foreground leading-relaxed\">\n              Prendre le temps d'avoir ce type de conversation demande du courage et de la vulnérabilité. Prenez un moment pour vous remercier mutuellement pour votre présence et votre écoute.\n            </p>\n          </div>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <h3 className=\"text-lg font-medium text-foreground\">\n              Un suivi est-il nécessaire?\n            </h3>\n\n            <p className=\"text-sm text-muted-foreground\">\n              Avez-vous besoin de planifier une autre conversation ou un moment pour vérifier comment les choses évoluent?\n            </p>\n\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button\n                size=\"lg\"\n                variant={followUpNeeded === true ? \"default\" : \"outline\"}\n                onClick={() => setFollowUpNeeded(true)}\n                className=\"gap-2\"\n                data-testid=\"button-followup-yes\"\n              >\n                <CheckCircle2 className=\"w-5 h-5\" />\n                Oui, un suivi serait utile\n              </Button>\n\n              <Button\n                size=\"lg\"\n                variant={followUpNeeded === false ? \"default\" : \"outline\"}\n                onClick={() => setFollowUpNeeded(false)}\n                className=\"gap-2\"\n                data-testid=\"button-followup-no\"\n              >\n                Non, pas nécessaire\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"pt-8 pb-8 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={handleContinue}\n            disabled={followUpNeeded === null || isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-next\"\n          >\n            Terminer\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3559,"size_tokens":null},"client/src/pages/DuoInversionPage12a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { Checklist } from '@/components/Checklist';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { Ear, VolumeX } from 'lucide-react';\n\nexport default function DuoInversionPage12a() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const checklistItems = [\n    {\n      id: 'vecu-inverse',\n      label: 'Le vécu (comment il/elle s\\'est senti)',\n      checked: session.checklistVecuInverse || false,\n      onChange: (checked: boolean) => updateSession({ checklistVecuInverse: checked }),\n    },\n    {\n      id: 'interpretation-inverse',\n      label: 'L\\'interprétation (comment il/elle a perçu la situation)',\n      checked: session.checklistInterpretationInverse || false,\n      onChange: (checked: boolean) => updateSession({ checklistInterpretationInverse: checked }),\n    },\n    {\n      id: 'impact-inverse',\n      label: 'L\\'impact (les conséquences pour lui/elle)',\n      checked: session.checklistImpactInverse || false,\n      onChange: (checked: boolean) => updateSession({ checklistImpactInverse: checked }),\n    },\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Ear className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Valide ce que tu as entendu\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, nomme ce que tu as entendu, sers toi de la liste pour te guider si nécessaire\n            </h2>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Ton rôle ici est de montrer à {session.receiverName} que tu as vraiment écouté et compris. Reformule ce que tu as entendu dans tes propres mots, sans juger, sans minimiser, sans ajouter ton point de vue.\n              </p>\n              <p className=\"mb-4\">\n                Pour chaque point, tu peux dire quelque chose comme :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Vécu :</strong> \"Face à ça, tu t'es senti...\"</li>\n                <li><strong>Interprétation :</strong> \"Tu as eu l'impression que...\"</li>\n                <li><strong>Impact :</strong> \"Et ça t'a amené à réagir en...\"</li>\n              </ul>\n              <p>\n                Après avoir reformulé chaque point oralement, coche la case correspondante. {session.receiverName} pourra ensuite confirmer ou rectifier si nécessaire.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"space-y-3\">\n            <p className=\"text-base md:text-lg text-muted-foreground\">\n              Coche les cases au fur et à mesure que tu reformules chaque point :\n            </p>\n            <Checklist items={checklistItems} />\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(31)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              OK, next\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4295,"size_tokens":null},"client/src/pages/DuoSenderNeeds.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Heart, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderNeeds() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Exprime des besoins\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName}: écoute avec ouverture\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, de quoi aurais-tu besoin?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Formule une demande claire et concrète\n            </p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à cette situation, j'aurais besoin que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sois spécifique et concret\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Formule une demande, pas une exigence\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Maintenant que tu as partagé ton vécu et que {session.receiverName} l'a entendu, il est temps d'exprimer ce dont tu as besoin pour améliorer la situation.\n              </p>\n              <p className=\"mb-4\">\n                Une bonne demande est :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Spécifique :</strong> \"J'aurais besoin que tu me regardes quand je te parle\" plutôt que \"J'ai besoin de plus d'attention\"</li>\n                <li><strong>Réalisable :</strong> Quelque chose que l'autre peut concrètement faire</li>\n                <li><strong>Formulée comme une demande :</strong> \"Est-ce que tu pourrais...\" au lieu de \"Tu dois...\"</li>\n              </ul>\n              <p>\n                Exemples : \"J'aurais besoin qu'on prenne 15 minutes chaque soir pour discuter sans téléphone\" ou \"J'aurais besoin que tu me préviennes si tu rentres tard\".\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(19)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-finished\"\n              >\n                J'ai terminé\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4422,"size_tokens":null},"client/src/pages/DuoRoles.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Users } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Roles() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n  const [senderName, setSenderName] = useState(session.senderName || '');\n  const [receiverName, setReceiverName] = useState(session.receiverName || '');\n\n  const handleContinue = () => {\n    if (senderName.trim() && receiverName.trim()) {\n      updateSession({ senderName: senderName.trim(), receiverName: receiverName.trim() });\n      transitionToStep(2);\n    }\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-10 md:space-y-12\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Users className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <div className=\"text-center space-y-4 max-w-2xl\">\n          <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground\">\n            Qui est qui?\n          </h1>\n\n          <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n            Identifiez vos rôles pour cette conversation. Ces noms seront utilisés tout au long du processus pour personnaliser l'expérience.\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-lg space-y-8\">\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-sm font-semibold text-primary-foreground\">1</span>\n              </div>\n              <h3 className=\"text-lg md:text-xl font-semibold text-foreground\">\n                L'émetteur\n              </h3>\n            </div>\n            <p className=\"text-sm md:text-base text-muted-foreground leading-relaxed\">\n              La personne qui a besoin de s'exprimer\n            </p>\n            <Input\n              type=\"text\"\n              placeholder=\"Prénom ou surnom\"\n              value={senderName}\n              onChange={(e) => setSenderName(e.target.value)}\n              className=\"text-base\"\n              data-testid=\"input-sender-name\"\n              aria-label=\"Nom de l'émetteur\"\n            />\n          </div>\n\n          <div className=\"space-y-3\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-sm font-semibold text-primary-foreground\">2</span>\n              </div>\n              <h3 className=\"text-lg md:text-xl font-semibold text-foreground\">\n                Le récepteur\n              </h3>\n            </div>\n            <p className=\"text-sm md:text-base text-muted-foreground leading-relaxed\">\n              La personne qui écoute avec attention et bienveillance\n            </p>\n            <Input\n              type=\"text\"\n              placeholder=\"Prénom ou surnom\"\n              value={receiverName}\n              onChange={(e) => setReceiverName(e.target.value)}\n              className=\"text-base\"\n              data-testid=\"input-receiver-name\"\n              aria-label=\"Nom du récepteur\"\n            />\n          </div>\n\n          <div className=\"flex flex-col items-center pt-4 space-y-4\">\n            <Button\n              size=\"lg\"\n              onClick={handleContinue}\n              disabled={!senderName.trim() || !receiverName.trim() || isTransitioning}\n              className=\"w-full md:w-auto px-12\"\n              data-testid=\"button-next\"\n            >\n              Continuer\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-64\" aria-label=\"Chargement en cours\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4276,"size_tokens":null},"client/src/pages/DuoSenderSituation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderSituation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme la situation\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, nomme la situation : de quoi veux-tu parler?\n            </h2>\n\n            <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Reste objectif et factuel\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ne parle pas encore de tes émotions\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Sois bref - maximum 1 minute\n              </span>\n            </li>\n          </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                À cette étape, décris uniquement ce qui s'est passé de manière factuelle, comme si tu racontais une scène à une caméra. Évite d'interpréter les intentions de l'autre ou d'exprimer tes émotions pour l'instant.\n              </p>\n              <p>\n                Par exemple, au lieu de dire \"Tu m'as ignoré\", dis plutôt \"Hier soir, quand je t'ai parlé, tu as continué à regarder ton téléphone\". Concentre-toi sur les faits observables.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(8)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3583,"size_tokens":null},"client/src/pages/SoloReceiverResponse.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverResponse() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.receiverName}, que peux-tu offrir?\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Réponds honnêtement à la demande\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Exprime ce que tu peux ou ne peux pas offrir\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Propose des alternatives si nécessaire\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sois honnête sur tes limites\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                {session.senderName} vient de formuler une demande. Ton rôle maintenant est d'y répondre avec authenticité. Tu peux :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Accepter complètement :</strong> \"Oui, je peux faire ça\"</li>\n                <li><strong>Accepter partiellement :</strong> \"Je ne peux pas promettre tous les soirs, mais je peux m'engager à le faire trois fois par semaine\"</li>\n                <li><strong>Proposer une alternative :</strong> \"Ce que tu demandes est difficile pour moi, mais je pourrais plutôt...\"</li>\n                <li><strong>Refuser avec respect :</strong> \"Je ne peux pas faire ça parce que... mais je comprends que c'est important pour toi\"</li>\n              </ul>\n              <p>\n                L'important est d'être honnête. Une fausse promesse créera plus de problèmes qu'une limite clairement exprimée.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(22)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3469,"size_tokens":null},"client/src/components/GlobalHeader.tsx":{"content":"import { useLocation } from 'wouter';\nimport { Shield, LogOut, Home, LogIn } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Logo } from '@/components/logo';\nimport { ThemeToggle } from '@/components/theme-toggle';\nimport { getSessionToken, clearAuth } from '@/lib/auth';\nimport { useQuery } from '@tanstack/react-query';\nimport { useAccess } from '@/contexts/AccessContext';\n\nexport function GlobalHeader() {\n    const [location, setLocation] = useLocation();\n    const sessionToken = getSessionToken();\n    const isLoggedIn = !!sessionToken;\n    const { circleIsAdmin } = useAccess();\n\n    const { data: userData } = useQuery({\n        queryKey: ['/api/auth/me'],\n        queryFn: async () => {\n            if (!sessionToken) return null;\n            const response = await fetch('/api/auth/me', {\n                headers: {\n                    'Authorization': `Bearer ${sessionToken}`,\n                },\n            });\n            if (!response.ok) return null;\n            return response.json();\n        },\n        enabled: isLoggedIn,\n        retry: false,\n    });\n\n    // Admin si connecté avec JWT ET admin, OU si Circle.so dit admin\n    const isAdmin = userData?.isAdmin || circleIsAdmin;\n\n    const handleLogout = () => {\n        clearAuth();\n        window.location.href = '/';\n    };\n\n    // Non-admin users: no header at all (except on admin pages)\n    const isAdminPage = location === '/admin' || location === '/admin-login';\n    \n    if (!isAdmin && !isAdminPage) {\n        return null;\n    }\n\n    // Determine title and subtitle based on location\n    let title = \"Espace Membre\";\n    let subtitle = \"Communauté Avancer Simplement\";\n\n    if (location === '/admin') {\n        title = \"Dashboard Admin\";\n        subtitle = \"Espace d'administration\";\n    } else if (location === '/welcome' || location.startsWith('/solo') || location.startsWith('/duo')) {\n        title = \"Jumelage\";\n        subtitle = \"Application Duo Connecté\";\n    }\n\n    return (\n        <header className=\"border-b bg-card sticky top-0 z-50\">\n            <div className=\"container mx-auto px-4 py-4 flex items-center justify-between flex-wrap gap-2\">\n                <div className=\"flex items-center gap-3 cursor-pointer\" onClick={() => setLocation(isLoggedIn ? '/welcome' : '/')}>\n                    <Logo size=\"md\" />\n                    <div>\n                        <h1 className=\"text-xl font-semibold\">{title}</h1>\n                        <p className=\"text-sm text-muted-foreground\">{subtitle}</p>\n                    </div>\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                    <ThemeToggle />\n\n                    {isLoggedIn && isAdmin && location !== '/admin' && (\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => setLocation('/admin')}\n                            data-testid=\"button-dashboard\"\n                        >\n                            <Shield className=\"h-4 w-4 mr-2\" />\n                            <span className=\"hidden sm:inline\">Dashboard Admin</span>\n                        </Button>\n                    )}\n\n                    {isLoggedIn && location === '/admin' && (\n                        <Button\n                            variant=\"outline\"\n                            onClick={() => setLocation('/welcome')}\n                            data-testid=\"button-user-home\"\n                        >\n                            <Home className=\"h-4 w-4 mr-2\" />\n                            <span className=\"hidden sm:inline\">Page d'accueil</span>\n                        </Button>\n                    )}\n\n                    {isLoggedIn ? (\n                        <Button\n                            variant=\"outline\"\n                            onClick={handleLogout}\n                            data-testid=\"button-logout\"\n                        >\n                            <LogOut className=\"h-4 w-4 mr-2\" />\n                            <span className=\"hidden sm:inline\">Déconnexion</span>\n                        </Button>\n                    ) : (\n                        location !== '/admin-login' && (\n                            <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => setLocation('/admin-login')}\n                                data-testid=\"button-admin-login\"\n                            >\n                                <LogIn className=\"h-4 w-4 mr-2\" />\n                                Admin\n                            </Button>\n                        )\n                    )}\n                </div>\n            </div>\n        </header>\n    );\n}\n","path":null,"size_bytes":4751,"size_tokens":null},"client/src/pages/DuoReceiverExperience.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Heart, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverExperience() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Ton vécu après l'écoute\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, comment te sens-tu maintenant?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Parle de ce que tu vis en lien avec ce que tu viens d'entendre de la part de {session.senderName}\n            </p>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à ce que tu viens de me dire, je me sens...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Tu peux avoir plusieurs émotions en même temps\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste dans le moment présent\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste en lien avec ton vécu face à celui de {session.senderName}\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                C'est le moment d'exprimer honnêtement ce que TU ressens maintenant, après avoir écouté {session.senderName}. Tu peux te sentir triste, touché, inconfortable, coupable, incompris, ou toute autre émotion.\n              </p>\n              <p className=\"mb-4\">\n                Il est normal de vouloir te défendre ou te justifier, mais ce n'est pas le moment. Pour l'instant, nomme simplement tes émotions face à ce que tu viens d'entendre.\n              </p>\n              <p>\n                Tu pourras relever certains points qui te semblent importants, mais reviens toujours à ton vécu émotionnel. Par exemple : \"Quand tu dis que je t'ai ignoré, je me sens incompris parce que dans ma tête j'étais concentré, mais je reconnais que je me sens aussi mal à l'aise en réalisant l'impact que ça a eu sur toi.\"\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"rounded-lg border border-destructive/30 bg-destructive/5 p-4 space-y-2\">\n            <p className=\"text-sm font-medium text-destructive\">À éviter à cette étape :</p>\n            <ul className=\"text-sm text-destructive space-y-1 pl-4\">\n              <li>• Te justifier ou te défendre</li>\n              <li>• Expliquer ton point de vue sur la situation</li>\n              <li>• Minimiser ce que {session.senderName} ressent</li>\n            </ul>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(15)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-next\"\n              >\n                J'ai terminé\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":5182,"size_tokens":null},"client/src/pages/SoloSenderGrounding.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderGrounding() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.senderName}, prends le temps de te déposer\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Comment te sens-tu à l'idée de t'exprimer?\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Parle de ce que tu ressens maintenant, en ce moment précis\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Ne parle pas encore du sujet de la conversation\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends tout ton temps pour exprimer ton état présent\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Cette étape te permet de te connecter à ton état émotionnel actuel avant d'aborder le sujet qui te préoccupe. C'est un moment pour toi de reconnaître ce que tu vis maintenant : peut-être de la nervosité, de l'appréhension, de l'espoir, ou toute autre émotion.\n              </p>\n              <p>\n                En exprimant ces ressentis à voix haute, tu te prépares intérieurement et tu permets à l'autre de comprendre ton état d'esprit avant même que la conversation commence vraiment.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(6)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3113,"size_tokens":null},"client/src/components/WarningBanner.tsx":{"content":"import { AlertCircle, Volume2, VolumeX } from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface WarningBannerProps {\n  type?: 'info' | 'warning' | 'speaker' | 'listener';\n  children: React.ReactNode;\n  speaker?: string;\n}\n\nexport function WarningBanner({ type = 'info', children, speaker }: WarningBannerProps) {\n  const variants = {\n    info: 'bg-primary/10 border-primary/20 text-primary-foreground',\n    warning: 'bg-destructive/10 border-destructive/20 text-destructive',\n    speaker: 'bg-accent border-accent-border text-accent-foreground',\n    listener: 'bg-destructive/10 border-destructive/20 text-destructive',\n  };\n\n  const icons = {\n    info: <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />,\n    warning: <AlertCircle className=\"w-5 h-5 flex-shrink-0\" />,\n    speaker: speaker ? <Volume2 className=\"w-5 h-5 flex-shrink-0\" /> : <VolumeX className=\"w-5 h-5 flex-shrink-0\" />,\n    listener: <VolumeX className=\"w-5 h-5 flex-shrink-0\" />,\n  };\n\n  return (\n    <div\n      className={cn(\n        'rounded-lg border p-3 md:p-4 flex items-center gap-2 md:gap-3 mb-4 md:mb-6',\n        variants[type]\n      )}\n      data-testid={`banner-${type}`}\n    >\n      {icons[type]}\n      <p className=\"text-sm md:text-base font-medium\">\n        {children}\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":1290,"size_tokens":null},"client/src/pages/DuoInversionPage20a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { ArrowRight } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage20a() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <ArrowRight className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Transition vers la clôture\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4 text-center\">\n            <p className=\"text-base md:text-lg text-foreground leading-relaxed\">\n              Les deux perspectives ont été partagées. Il est maintenant temps de clôturer en vous partageant un dernier feedback sur comment vous vous sentez après tous ces échanges.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(21)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-continue\"\n              >\n                Oui, on continue\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":1940,"size_tokens":null},"client/src/components/theme-toggle.tsx":{"content":"import { Moon, Sun } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useTheme } from './theme-provider';\n\nexport function ThemeToggle() {\n  const { actualTheme, setTheme } = useTheme();\n\n  const toggleTheme = () => {\n    setTheme(actualTheme === 'dark' ? 'light' : 'dark');\n  };\n\n  return (\n    <Button\n      onClick={toggleTheme}\n      size=\"icon\"\n      variant=\"outline\"\n      data-testid=\"button-theme-toggle\"\n    >\n      {actualTheme === 'dark' ? (\n        <Sun className=\"h-4 w-4\" />\n      ) : (\n        <Moon className=\"h-4 w-4\" />\n      )}\n    </Button>\n  );\n}\n","path":null,"size_bytes":599,"size_tokens":null},"client/src/pages/SoloCompletion.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { useSession } from '@/contexts/SessionContext';\nimport { CheckCircle2, RotateCcw, ExternalLink } from 'lucide-react';\nimport { PageLayout } from '@/components/PageLayout';\n\nexport default function Completion() {\n  const { resetSession } = useSession();\n\n  const handleRestart = () => {\n    if (window.confirm('Êtes-vous sûr de vouloir recommencer une nouvelle session? Toutes les données actuelles seront effacées.')) {\n      resetSession();\n    }\n  };\n\n  return (\n    <PageLayout showNav={false}>\n      <div className=\"text-center space-y-8 py-12\">\n        <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/10 mb-4\">\n          <CheckCircle2 className=\"w-10 h-10 text-primary\" />\n        </div>\n\n        <h1 className=\"text-4xl md:text-5xl font-semibold font-serif text-foreground\">\n          Conversation terminée\n        </h1>\n\n        <div className=\"space-y-6 max-w-xl mx-auto\">\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Merci d'avoir utilisé Communication en Navette pour faciliter votre conversation.\n          </p>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 text-left space-y-3\">\n            <p className=\"text-base text-foreground leading-relaxed\">\n              Rappelez-vous :\n            </p>\n            <ul className=\"space-y-2 text-sm text-muted-foreground\">\n              <li>• La communication authentique demande de la pratique</li>\n              <li>• Chaque conversation est une opportunité d'apprendre</li>\n              <li>• La connexion est plus importante que la perfection</li>\n            </ul>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center pt-4\">\n          <Button\n            size=\"lg\"\n            onClick={handleRestart}\n            className=\"gap-2\"\n            data-testid=\"button-restart\"\n          >\n            <RotateCcw className=\"w-5 h-5\" />\n            Recommencer une nouvelle session\n          </Button>\n\n          <Button\n            size=\"lg\"\n            variant=\"outline\"\n            asChild\n            className=\"gap-2\"\n          >\n            <a href=\"#\" target=\"_blank\" rel=\"noopener noreferrer\">\n              <ExternalLink className=\"w-4 h-4\" />\n              Ressources supplémentaires\n            </a>\n          </Button>\n        </div>\n\n        <p className=\"text-sm text-muted-foreground pt-8\">\n          Pour approfondir vos compétences en communication, explorez nos formations et ressources\n        </p>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2658,"size_tokens":null},"client/src/contexts/SessionContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { type SessionState } from '@shared/schema';\n\ninterface SessionContextType {\n  session: SessionState;\n  updateSession: (updates: Partial<SessionState>) => void;\n  resetSession: () => void;\n  goToStep: (step: number) => void;\n  goBack: () => void;\n}\n\nconst SessionContext = createContext<SessionContextType | undefined>(undefined);\n\nconst defaultSession: SessionState = {\n  senderName: '',\n  receiverName: '',\n  currentStep: 0,\n  lastUpdated: new Date().toISOString(),\n};\n\n// Charger les noms sauvegardés depuis localStorage\nconst loadSavedNames = (): Pick<SessionState, 'senderName' | 'receiverName'> => {\n  try {\n    const savedNames = localStorage.getItem('duo-connecte-names');\n    if (savedNames) {\n      const parsed = JSON.parse(savedNames);\n      return {\n        senderName: parsed.senderName || '',\n        receiverName: parsed.receiverName || '',\n      };\n    }\n  } catch (error) {\n    console.error('Erreur lors du chargement des noms:', error);\n  }\n  return { senderName: '', receiverName: '' };\n};\n\nexport function SessionProvider({ children }: { children: ReactNode }) {\n  const savedNames = loadSavedNames();\n  const [session, setSession] = useState<SessionState>({\n    ...defaultSession,\n    ...savedNames,\n  });\n\n  const updateSession = (updates: Partial<SessionState>) => {\n    setSession(prev => ({\n      ...prev,\n      ...updates,\n      lastUpdated: new Date().toISOString(),\n    }));\n  };\n\n  // Sauvegarder les noms dans localStorage quand ils changent\n  useEffect(() => {\n    if (session.senderName || session.receiverName) {\n      try {\n        localStorage.setItem('duo-connecte-names', JSON.stringify({\n          senderName: session.senderName,\n          receiverName: session.receiverName,\n        }));\n      } catch (error) {\n        console.error('Erreur lors de la sauvegarde des noms:', error);\n      }\n    }\n  }, [session.senderName, session.receiverName]);\n\n  const resetSession = () => {\n    setSession(defaultSession);\n  };\n\n  const goToStep = (step: number) => {\n    updateSession({ currentStep: step });\n  };\n\n  const goBack = () => {\n    if (session.currentStep > 0) {\n      goToStep(session.currentStep - 1);\n    }\n  };\n\n  return (\n    <SessionContext.Provider value={{ session, updateSession, resetSession, goToStep, goBack }}>\n      {children}\n    </SessionContext.Provider>\n  );\n}\n\nexport function useSession() {\n  const context = useContext(SessionContext);\n  if (!context) {\n    throw new Error('useSession must be used within SessionProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":2604,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Sun, Moon } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useTheme } from '@/components/theme-provider';\n\nexport function ThemeToggle() {\n  const { theme, setTheme } = useTheme();\n\n  const toggleTheme = () => {\n    setTheme(theme === 'light' ? 'dark' : 'light');\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      className=\"h-9 w-9\"\n      data-testid=\"button-theme-toggle\"\n    >\n      {theme === 'dark' ? (\n        <Moon className=\"h-4 w-4\" />\n      ) : (\n        <Sun className=\"h-4 w-4\" />\n      )}\n      <span className=\"sr-only\">\n        {theme === 'dark' ? 'Passer en mode clair' : 'Passer en mode sombre'}\n      </span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":742,"size_tokens":null},"client/src/pages/DuoReceiverResponse.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Handshake, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverResponse() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Handshake className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          On peut s'entendre?\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName}: écoute avec ouverture\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, est-ce que la demande de {session.senderName} fait du sens pour toi?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Est-ce que tu es capable et volontaire pour répondre à la demande de {session.senderName}?\n            </p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Exprime ce que tu peux ou ne peux pas offrir\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Propose des alternatives si nécessaire\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sois honnête sur tes limites\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                {session.senderName} vient de formuler une demande. Ton rôle maintenant est d'y répondre avec authenticité. Tu peux :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Accepter complètement :</strong> \"Oui, je peux faire ça\"</li>\n                <li><strong>Accepter partiellement :</strong> \"Je ne peux pas promettre tous les soirs, mais je peux m'engager à le faire trois fois par semaine\"</li>\n                <li><strong>Proposer une alternative :</strong> \"Ce que tu demandes est difficile pour moi, mais je pourrais plutôt...\"</li>\n                <li><strong>Refuser avec respect :</strong> \"Je ne peux pas faire ça parce que... mais je comprends que c'est important pour toi\"</li>\n              </ul>\n              <p>\n                L'important est d'être honnête. Une fausse promesse créera plus de problèmes qu'une limite clairement exprimée.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(20)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-finished\"\n              >\n                J'ai terminé\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4525,"size_tokens":null},"client/src/pages/SoloSenderNeeds.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderNeeds() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.senderName}, de quoi as-tu besoin?\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Formule une demande claire et concrète\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à cette situation, j'aurais besoin que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sois spécifique et concret\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Formule une demande, pas une exigence\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Maintenant que tu as partagé ton vécu et que {session.receiverName} l'a entendu, il est temps d'exprimer ce dont tu as besoin pour améliorer la situation.\n              </p>\n              <p className=\"mb-4\">\n                Une bonne demande est :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Spécifique :</strong> \"J'aurais besoin que tu me regardes quand je te parle\" plutôt que \"J'ai besoin de plus d'attention\"</li>\n                <li><strong>Réalisable :</strong> Quelque chose que l'autre peut concrètement faire</li>\n                <li><strong>Formulée comme une demande :</strong> \"Est-ce que tu pourrais...\" au lieu de \"Tu dois...\"</li>\n              </ul>\n              <p>\n                Exemples : \"J'aurais besoin qu'on prenne 15 minutes chaque soir pour discuter sans téléphone\" ou \"J'aurais besoin que tu me préviennes si tu rentres tard\".\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(21)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3474,"size_tokens":null},"client/src/components/CountdownTimer.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { Play, Pause } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ninterface CountdownTimerProps {\n  duration: number; // in seconds\n  autoStart?: boolean;\n}\n\nexport function CountdownTimer({ duration, autoStart = false }: CountdownTimerProps) {\n  const [timeLeft, setTimeLeft] = useState(duration);\n  const [isRunning, setIsRunning] = useState(autoStart);\n\n  useEffect(() => {\n    if (!isRunning || timeLeft <= 0) return;\n\n    const timer = setInterval(() => {\n      setTimeLeft((prev) => {\n        if (prev <= 1) {\n          setIsRunning(false);\n          return 0;\n        }\n        return prev - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [isRunning, timeLeft]);\n\n  const minutes = Math.floor(timeLeft / 60);\n  const seconds = timeLeft % 60;\n  const progress = ((duration - timeLeft) / duration) * 100;\n\n  return (\n    <div className=\"flex flex-col items-center gap-6 py-8\" data-testid=\"countdown-timer\">\n      <div className=\"relative w-40 h-40 md:w-48 md:h-48\">\n        {/* Background circle */}\n        <svg className=\"w-full h-full -rotate-90\">\n          <circle\n            cx=\"50%\"\n            cy=\"50%\"\n            r=\"45%\"\n            fill=\"none\"\n            stroke=\"hsl(var(--muted))\"\n            strokeWidth=\"8\"\n          />\n          {/* Progress circle */}\n          <circle\n            cx=\"50%\"\n            cy=\"50%\"\n            r=\"45%\"\n            fill=\"none\"\n            stroke=\"hsl(var(--primary))\"\n            strokeWidth=\"8\"\n            strokeDasharray={`${2 * Math.PI * 45} ${2 * Math.PI * 45}`}\n            strokeDashoffset={`${2 * Math.PI * 45 * (1 - progress / 100)}`}\n            strokeLinecap=\"round\"\n            className=\"transition-all duration-1000 ease-linear\"\n          />\n        </svg>\n        {/* Time display */}\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <span className=\"text-4xl md:text-5xl font-semibold font-serif\" data-testid=\"timer-display\">\n            {minutes}:{seconds.toString().padStart(2, '0')}\n          </span>\n        </div>\n      </div>\n\n      <Button\n        variant={isRunning ? \"outline\" : \"default\"}\n        size=\"lg\"\n        onClick={() => setIsRunning(!isRunning)}\n        className=\"gap-2\"\n        disabled={timeLeft === 0}\n        data-testid=\"button-timer-toggle\"\n      >\n        {isRunning ? (\n          <>\n            <Pause className=\"w-5 h-5\" />\n            Pause\n          </>\n        ) : (\n          <>\n            <Play className=\"w-5 h-5\" />\n            {timeLeft === duration ? 'Démarrer' : 'Reprendre'}\n          </>\n        )}\n      </Button>\n    </div>\n  );\n}\n","path":null,"size_bytes":2679,"size_tokens":null},"client/src/pages/DuoInversionPage11a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { ListChecks, VolumeX, CheckCircle2 } from 'lucide-react';\n\nexport default function DuoInversionPage11a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const checklistItems = [\n    \"Mon vécu (comment je me suis senti)\",\n    \"Mon interprétation (comment j'ai perçu la situation)\",\n    \"L'impact (les conséquences pour moi)\",\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <ListChecks className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Fais un résumé\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, reprends les 3 points que tu viens de partager\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground\">\n              Fais un bref résumé oral en reprenant ces 3 éléments :\n            </p>\n\n            <div className=\"space-y-3\">\n              {checklistItems.map((item, index) => (\n                <div\n                  key={index}\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-card border border-card-border hover-elevate transition-colors\"\n                >\n                  <CheckCircle2 className=\"w-5 h-5 text-primary flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    {index + 1}. {item}\n                  </span>\n                </div>\n              ))}\n            </div>\n\n            <p className=\"text-base text-muted-foreground italic\">\n              Ce résumé aide {session.senderName} à bien comprendre l'ensemble de ton message avant de le reformuler.\n            </p>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(30)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Étape suivante\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3210,"size_tokens":null},"client/src/pages/SoloSenderSummary.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { CheckCircle2 } from 'lucide-react';\n\nexport default function SenderSummary() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const checklistItems = [\n    \"La situation (qu'est-ce qui s'est passé)\",\n    \"Mon vécu (comment je me suis senti)\",\n    \"Mon interprétation (comment j'ai perçu la situation)\",\n    \"L'impact (les conséquences pour moi)\",\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <WarningBanner type=\"speaker\">\n          {session.receiverName} écoute sans parler\n        </WarningBanner>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.senderName}, fais un résumé\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Reprends les 4 points que tu viens de partager\n        </p>\n\n        <div className=\"rounded-lg border border-border bg-card p-6 space-y-4\">\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Fais un bref résumé oral en reprenant ces 4 éléments :\n          </p>\n\n          <div className=\"space-y-3\">\n            {checklistItems.map((item, index) => (\n              <div\n                key={index}\n                className=\"flex items-start gap-3 p-3 rounded-lg bg-background\"\n              >\n                <CheckCircle2 className=\"w-5 h-5 text-primary flex-shrink-0 mt-0.5\" />\n                <span className=\"text-base leading-relaxed\">\n                  {item}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n          <p className=\"text-sm text-foreground\">\n            Ce résumé aide {session.receiverName} à bien comprendre l'ensemble de ton message avant de le reformuler.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(13)}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            disabled={isTransitioning}\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2757,"size_tokens":null},"client/src/pages/SoloSenderClarification.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderClarification() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <WarningBanner type=\"speaker\">\n          {session.receiverName} écoute sans parler\n        </WarningBanner>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.senderName}, précise ce qui est important\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Clarifie ou corrige ce qui n'a pas été bien compris\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Reprends les points qui nécessitent une clarification\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ajoute ce qui manquait à ta première explication\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Sois précis sur ce qui te semble mal compris\n              </span>\n            </li>\n          </ul>\n\n          <ExpandableSection>\n            <p className=\"mb-4\">\n              Cette étape te permet de rectifier ou d'ajouter des précisions importantes. Peut-être que {session.receiverName} a reformulé quelque chose de façon inexacte, ou peut-être as-tu oublié de mentionner un élément important.\n            </p>\n            <p className=\"mb-4\">\n              Concentre-toi sur ce qui a besoin d'être clarifié. Tu n'as pas besoin de tout répéter, seulement les points qui demandent une correction ou un ajout.\n            </p>\n            <p className=\"mb-4\">\n              Par exemple: \"Quand tu as dit que je me sentais en colère, c'était plus de la déception que de la colère\" ou \"J'aimerais ajouter que l'impact sur moi est aussi que je deviens distant\".\n            </p>\n          </ExpandableSection>\n        </div>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n          <p className=\"text-sm text-foreground\">\n            {session.receiverName} va ensuite reformuler à nouveau ces clarifications pour s'assurer d'avoir bien compris.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(13)}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            disabled={isTransitioning}\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3671,"size_tokens":null},"client/src/components/ProgressBar.tsx":{"content":"import { sectionNames, getFlow } from '@shared/schema';\nimport { useSession } from '@/contexts/SessionContext';\n\ninterface ProgressBarProps {\n  section: number;\n  currentStep: number;\n  totalSteps: number;\n}\n\nexport function ProgressBar({ section, currentStep, totalSteps }: ProgressBarProps) {\n  const { session } = useSession();\n  const progress = ((currentStep + 1) / totalSteps) * 100;\n  const flow = getFlow(session.appType);\n\n  if (section === 0) return null;\n\n  return (\n    <div className=\"w-full bg-card border-b border-card-border py-4 px-4 md:px-6\" data-testid=\"progress-bar\">\n      <div className=\"max-w-3xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-sm font-medium text-foreground\">\n            Section {section}/7\n          </span>\n          <span className=\"text-sm font-medium text-muted-foreground\">\n            {sectionNames[section]}\n          </span>\n        </div>\n        <div className=\"w-full h-1.5 md:h-2 bg-muted rounded-full overflow-hidden\">\n          <div\n            className=\"h-full transition-all duration-500 ease-out rounded-full\"\n            style={{ \n              width: `${progress}%`,\n              backgroundColor: flow.progressColor\n            }}\n            data-testid=\"progress-bar-fill\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1357,"size_tokens":null},"client/src/pages/SoloThanks.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Award, CheckCircle2 } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Thanks() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n  const [followUpNeeded, setFollowUpNeeded] = useState<boolean | null>(\n    session.suiviNecessaire ?? null\n  );\n\n  const handleContinue = () => {\n    if (followUpNeeded !== null) {\n      updateSession({ suiviNecessaire: followUpNeeded });\n      transitionToStep(26);\n    }\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-primary/10 mb-2\">\n          <Award className=\"w-10 h-10 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Félicitations!\n        </h1>\n\n        <div className=\"space-y-5 md:space-y-6\">\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n            <p className=\"text-lg leading-relaxed text-foreground\">\n              Vous avez terminé ce processus de communication guidée. C'est un bel accomplissement!\n            </p>\n\n            <p className=\"text-base text-muted-foreground leading-relaxed\">\n              Prendre le temps d'avoir ce type de conversation demande du courage et de la vulnérabilité. Prenez un moment pour vous remercier mutuellement pour votre présence et votre écoute.\n            </p>\n          </div>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <h3 className=\"text-lg font-medium text-foreground\">\n              Un suivi est-il nécessaire?\n            </h3>\n\n            <p className=\"text-sm text-muted-foreground\">\n              Avez-vous besoin de planifier une autre conversation ou un moment pour vérifier comment les choses évoluent?\n            </p>\n\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button\n                size=\"lg\"\n                variant={followUpNeeded === true ? \"default\" : \"outline\"}\n                onClick={() => setFollowUpNeeded(true)}\n                className=\"gap-2\"\n                data-testid=\"button-followup-yes\"\n              >\n                <CheckCircle2 className=\"w-5 h-5\" />\n                Oui, un suivi serait utile\n              </Button>\n\n              <Button\n                size=\"lg\"\n                variant={followUpNeeded === false ? \"default\" : \"outline\"}\n                onClick={() => setFollowUpNeeded(false)}\n                className=\"gap-2\"\n                data-testid=\"button-followup-no\"\n              >\n                Non, pas nécessaire\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"pt-8 pb-8 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={handleContinue}\n            disabled={followUpNeeded === null || isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-next\"\n          >\n            Terminer\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3559,"size_tokens":null},"client/src/pages/DuoInversionPage9a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage9a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme ta vision des choses\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, parle de comment tu as perçu la situation\n            </h2>\n\n            <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Quand c'est arrivé, j'ai eu l'impression que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  J'ai vu ça de cette façon...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Pour moi, ça voulait dire que...\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Nos émotions sont créées par notre interprétation personnelle des situations. Ce que tu as ressenti découle de comment tu as interprété ce qui s'est passé.\n              </p>\n              <p className=\"mb-4\">\n                Par exemple : si quelqu'un ne te salue pas le matin, tu pourrais interpréter que cette personne est fâchée contre toi (ce qui pourrait créer de l'anxiété), ou qu'elle est préoccupée par quelque chose (ce qui créerait de l'empathie).\n              </p>\n              <p>\n                Partage maintenant comment TOI tu as interprété la situation. Utilise des formules comme \"J'ai eu l'impression que...\", \"Je me suis dit que...\", \"Pour moi, ça signifiait que...\". Reconnais que c'est ton interprétation, pas nécessairement la réalité.\n              </p>\n            </ExpandableSection>\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(28)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Étape suivante\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4065,"size_tokens":null},"client/src/pages/SoloSenderSituation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderSituation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <WarningBanner type=\"speaker\">\n          {session.receiverName} écoute sans parler\n        </WarningBanner>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.senderName}, de quoi veux-tu parler?\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Nomme la situation\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Reste objectif et factuel\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ne parle pas encore de tes émotions\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Sois bref - environ 1 minute\n              </span>\n            </li>\n          </ul>\n\n          <ExpandableSection>\n            <p className=\"mb-4\">\n              À cette étape, décris uniquement ce qui s'est passé de manière factuelle, comme si tu racontais une scène à une caméra. Évite d'interpréter les intentions de l'autre ou d'exprimer tes émotions pour l'instant.\n            </p>\n            <p>\n              Par exemple, au lieu de dire \"Tu m'as ignoré\", dis plutôt \"Hier soir, quand je t'ai parlé, tu as continué à regarder ton téléphone\". Concentre-toi sur les faits observables.\n            </p>\n          </ExpandableSection>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(9)}\n            disabled={isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3029,"size_tokens":null},"client/src/pages/DuoSenderExperience.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderExperience() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme ton vécu\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, parle de ce que tu as vécu face à la situation\n            </h2>\n\n            <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à cette situation, je me sens...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste sur toi et tes émotions\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends ton temps pour identifier et nommer ce que tu ressens\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                C'est le moment de partager tes émotions face à la situation que tu viens de décrire. Nomme précisément ce que tu ressens : tristesse, colère, frustration, déception, peur, etc.\n              </p>\n              <p className=\"mb-4\">\n                Reste dans le moment présent et parle de TES émotions, pas de ce que l'autre a fait ou devrait faire. Utilise des phrases comme \"Je me sens...\" plutôt que \"Tu m'as fait sentir...\".\n              </p>\n              <p>\n                Il est normal d'avoir plusieurs émotions en même temps. Prends le temps de les identifier et de les exprimer toutes.\n              </p>\n            </ExpandableSection>\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(9)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3891,"size_tokens":null},"client/src/pages/SoloReceiverConfirmation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { CheckCircle2, Edit3 } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverConfirmation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.receiverName}, as-tu été bien entendu?\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          {session.senderName} vient de reformuler ce que tu as partagé\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <p className=\"text-base md:text-lg leading-relaxed\">\n            Si {session.senderName} a bien compris tes émotions, tu peux continuer. Sinon, prends le temps de préciser ce qui est important pour toi.\n          </p>\n        </div>\n\n        <div className=\"space-y-4 pt-4\">\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <Button\n              size=\"lg\"\n              variant=\"outline\"\n              onClick={() => transitionToStep(16)}\n              disabled={isTransitioning}\n              className=\"min-w-48\"\n              data-testid=\"button-clarify\"\n            >\n              <Edit3 className=\"w-5 h-5 mr-2\" />\n              Je veux préciser\n            </Button>\n\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(19)}\n              disabled={isTransitioning}\n              className=\"min-w-48\"\n              data-testid=\"button-confirm\"\n            >\n              <CheckCircle2 className=\"w-5 h-5 mr-2\" />\n              Oui, c'est bien ça\n            </Button>\n          </div>\n          \n          {isTransitioning && (\n            <div className=\"flex justify-center\">\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            </div>\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2264,"size_tokens":null},"client/src/pages/SoloSenderExperience.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderExperience() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <WarningBanner type=\"speaker\">\n            {session.receiverName} écoute sans parler\n          </WarningBanner>\n\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.senderName}, parle de ton vécu\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Dis ce que tu as vécu\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à cette situation, je me sens...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Reste sur toi et tes émotions\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends ton temps pour identifier et nommer ce que tu ressens\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                C'est le moment de partager tes émotions face à la situation que tu viens de décrire. Nomme précisément ce que tu ressens : tristesse, colère, frustration, déception, peur, etc.\n              </p>\n              <p className=\"mb-4\">\n                Reste dans le moment présent et parle de TES émotions, pas de ce que l'autre a fait ou devrait faire. Utilise des phrases comme \"Je me sens...\" plutôt que \"Tu m'as fait sentir...\".\n              </p>\n              <p>\n                Il est normal d'avoir plusieurs émotions en même temps. Prends le temps de les identifier et de les exprimer toutes.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(10)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3338,"size_tokens":null},"client/src/pages/SoloSenderClosing.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderClosing() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.senderName}, comment te sens-tu maintenant?\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Après cet échange, partage ton ressenti\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Après cet échange, je me sens...\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ce qui me reste de cette conversation...\n              </span>\n            </li>\n          </ul>\n        </div>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n          <p className=\"text-sm text-foreground\">\n            Prends un moment pour reconnaître le chemin parcouru ensemble lors de cette conversation.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(24)}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            disabled={isTransitioning}\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2243,"size_tokens":null},"client/src/pages/DuoFeedback.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Star } from 'lucide-react';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport type { InsertFeedback } from '@shared/schema';\n\nexport default function Feedback() {\n  const { transitionToStep } = usePageTransition();\n  const { toast } = useToast();\n  const [rating, setRating] = useState<number | null>(null);\n  const [hoverRating, setHoverRating] = useState<number | null>(null);\n  const [helpfulAspect, setHelpfulAspect] = useState('');\n  const [improvementSuggestion, setImprovementSuggestion] = useState('');\n\n  const submitFeedbackMutation = useMutation({\n    mutationFn: async (feedback: InsertFeedback) => {\n      return apiRequest('POST', '/api/feedback', feedback);\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Merci!',\n        description: 'Votre feedback a été enregistré avec succès.',\n      });\n      transitionToStep(24);\n    },\n    onError: () => {\n      toast({\n        title: 'Erreur',\n        description: 'Une erreur est survenue lors de l\\'envoi de votre feedback.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleSubmit = () => {\n    if (rating) {\n      submitFeedbackMutation.mutate({\n        rating,\n        helpfulAspect: helpfulAspect.trim() || null,\n        improvementSuggestion: improvementSuggestion.trim() || null,\n      });\n    }\n  };\n\n  const handleSkip = () => {\n    transitionToStep(24);\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 text-center\">\n        {/* Logo et texte Avancer Simplement - même design que page 0 */}\n        <div className=\"space-y-1\">\n          <div className=\"inline-flex items-center justify-center w-[80px] h-[80px] md:w-[120px] md:h-[120px]\">\n            <img \n              src=\"/logo-blue.png\" \n              alt=\"Avancer Simplement Logo\" \n              className=\"w-[80px] h-[80px] md:w-[120px] md:h-[120px] dark:hidden\"\n            />\n            <img \n              src=\"/logo-white.png\" \n              alt=\"Avancer Simplement Logo\" \n              className=\"w-[80px] h-[80px] md:w-[120px] md:h-[120px] hidden dark:block\"\n            />\n          </div>\n          <div className=\"text-lg md:text-2xl font-black italic text-primary text-center\" style={{ fontFamily: 'Montserrat, sans-serif' }}>\n            AVANCER SIMPLEMENT\n          </div>\n        </div>\n\n        {/* Vous remercie d'avoir choisi */}\n        <div className=\"text-sm md:text-lg text-muted-foreground tracking-wide italic text-center\">\n          Vous remercie d'avoir choisi\n        </div>\n\n        {/* Titre Duo-Connecte - même style que page 0 */}\n        <h1 className=\"text-4xl md:text-6xl lg:text-7xl font-bold text-foreground pt-2 md:pt-6 tracking-tight text-center\" style={{ fontFamily: 'Figtree, sans-serif', textShadow: '0 2px 4px rgba(0,0,0,0.05)' }}>\n          Duo-Connecte\n        </h1>\n\n        {/* Texte explicatif */}\n        <p className=\"text-base text-foreground leading-relaxed text-center\">\n          Nous avons besoin de votre feedback pour nous aider à améliorer cet outil. Tout est anonyme. Merci\n        </p>\n\n        <div className=\"space-y-6\">\n          {/* Rating avec demi-étoiles - CENTRÉ */}\n          <div className=\"space-y-3 flex flex-col items-center\">\n            <div \n              className=\"flex gap-2\"\n              onMouseLeave={() => setHoverRating(null)}\n            >\n              {[1, 2, 3, 4, 5].map((starIndex) => {\n                const fullStarValue = starIndex;\n                const halfStarValue = starIndex - 0.5;\n                const displayRating = hoverRating ?? rating ?? 0;\n                \n                return (\n                  <div key={starIndex} className=\"relative w-10 h-10\">\n                    {/* Étoile de fond (grise) */}\n                    <Star className=\"w-10 h-10 text-muted-foreground stroke-muted-foreground\" />\n                    \n                    {/* Étoile jaune avec clip-path pour l'effet demi-étoile */}\n                    <div \n                      className=\"absolute inset-0 overflow-hidden transition-all duration-150\"\n                      style={{\n                        clipPath: displayRating >= fullStarValue \n                          ? 'inset(0 0 0 0)' \n                          : displayRating >= halfStarValue \n                          ? 'inset(0 50% 0 0)' \n                          : 'inset(0 100% 0 0)'\n                      }}\n                    >\n                      <Star className=\"w-10 h-10 fill-yellow-400 text-yellow-400\" />\n                    </div>\n                    \n                    {/* Zone cliquable gauche (demi-étoile) */}\n                    <button\n                      onClick={() => setRating(halfStarValue)}\n                      onMouseEnter={() => setHoverRating(halfStarValue)}\n                      className=\"absolute left-0 top-0 w-5 h-10 cursor-pointer\"\n                      data-testid={`rating-${halfStarValue}`}\n                      aria-label={`Note ${halfStarValue}`}\n                    />\n                    \n                    {/* Zone cliquable droite (étoile complète) */}\n                    <button\n                      onClick={() => setRating(fullStarValue)}\n                      onMouseEnter={() => setHoverRating(fullStarValue)}\n                      className=\"absolute right-0 top-0 w-5 h-10 cursor-pointer\"\n                      data-testid={`rating-${fullStarValue}`}\n                      aria-label={`Note ${fullStarValue}`}\n                    />\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Espace supplémentaire après les étoiles */}\n          <div className=\"pt-4\"></div>\n\n          {/* Helpful aspect - ALIGNÉ À GAUCHE */}\n          <div className=\"space-y-2 text-left\">\n            <label htmlFor=\"helpful\" className=\"text-base font-medium text-foreground\">\n              Qu'est-ce qui a été le plus utile? (optionnel)\n            </label>\n            <Textarea\n              id=\"helpful\"\n              placeholder=\"Par exemple: la structure étape par étape, les explications détaillées, le temps de pause...\"\n              value={helpfulAspect}\n              onChange={(e) => setHelpfulAspect(e.target.value)}\n              className=\"min-h-24\"\n              data-testid=\"input-helpful\"\n            />\n          </div>\n\n          {/* Improvement suggestion - ALIGNÉ À GAUCHE */}\n          <div className=\"space-y-2 text-left\">\n            <label htmlFor=\"improvement\" className=\"text-base font-medium text-foreground\">\n              Qu'est-ce qui pourrait être amélioré? (optionnel)\n            </label>\n            <Textarea\n              id=\"improvement\"\n              placeholder=\"Vos suggestions pour rendre cet outil encore plus efficace...\"\n              value={improvementSuggestion}\n              onChange={(e) => setImprovementSuggestion(e.target.value)}\n              className=\"min-h-24\"\n              data-testid=\"input-improvement\"\n            />\n          </div>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row gap-3 pt-4\">\n          <Button\n            size=\"lg\"\n            variant=\"outline\"\n            onClick={handleSkip}\n            data-testid=\"button-skip\"\n          >\n            Passer\n          </Button>\n\n          <Button\n            size=\"lg\"\n            onClick={handleSubmit}\n            disabled={!rating || submitFeedbackMutation.isPending}\n            className=\"px-8\"\n            data-testid=\"button-submit-feedback\"\n          >\n            {submitFeedbackMutation.isPending ? 'Envoi...' : 'Envoyer le feedback'}\n          </Button>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":7979,"size_tokens":null},"client/src/pages/PaywallScreen.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { Lock, ShoppingCart, Info } from 'lucide-react';\nimport { useTheme } from '@/components/theme-provider';\n\ninterface PaywallScreenProps {\n  paywallUrl?: string;\n  infoUrl?: string;\n}\n\nexport default function PaywallScreen({\n  paywallUrl = 'https://communaute.avancersimplement.com/checkout/communication-navette',\n  infoUrl = 'https://communaute.avancersimplement.com/untitled-page-6476'\n}: PaywallScreenProps) {\n  const { theme, setTheme } = useTheme();\n\n  const handleBuyClick = () => {\n    if (paywallUrl && paywallUrl !== '#') {\n      window.open(paywallUrl, '_blank');\n    }\n  };\n\n  const handleInfoClick = () => {\n    if (infoUrl && infoUrl !== '#') {\n      window.open(infoUrl, '_blank');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background flex flex-col\">\n      <div className=\"flex items-center justify-center flex-1 p-4\">\n        <div className=\"max-w-lg mx-auto text-center space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <div className=\"inline-flex items-center justify-center w-[80px] h-[80px] md:w-[100px] md:h-[100px]\">\n              <img\n                src=\"/logo-blue.png\"\n                alt=\"Avancer Simplement Logo\"\n                className=\"w-[80px] h-[80px] md:w-[100px] md:h-[100px] dark:hidden\"\n              />\n              <img\n                src=\"/logo-white.png\"\n                alt=\"Avancer Simplement Logo\"\n                className=\"w-[80px] h-[80px] md:w-[100px] md:h-[100px] hidden dark:block\"\n              />\n            </div>\n            <div className=\"text-base md:text-xl font-black italic text-primary\" style={{ fontFamily: 'Montserrat, sans-serif' }}>\n              AVANCER SIMPLEMENT\n            </div>\n          </div>\n\n          <div className=\"w-16 h-16 md:w-20 md:h-20 mx-auto bg-primary/10 rounded-full flex items-center justify-center\">\n            <Lock className=\"w-8 h-8 md:w-10 md:h-10 text-primary\" />\n          </div>\n\n          <div className=\"space-y-3\">\n            <h1 className=\"text-2xl md:text-4xl font-bold text-foreground\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n              Accès Réservé\n            </h1>\n            <p className=\"text-sm md:text-base text-muted-foreground leading-relaxed max-w-md mx-auto px-4\">\n              Cette application est réservée aux membres ayant souscrit à l'offre.\n              Obtenez votre accès pour profiter de tous les parcours de communication et de régulation émotionnelle.\n            </p>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row gap-3 justify-center pt-4 px-4\">\n            <Button\n              size=\"lg\"\n              onClick={handleBuyClick}\n              className=\"flex items-center gap-2 w-full sm:w-auto\"\n              data-testid=\"button-buy-access\"\n            >\n              <ShoppingCart className=\"w-4 h-4\" />\n              Acheter maintenant\n            </Button>\n            <Button\n              size=\"lg\"\n              variant=\"outline\"\n              onClick={handleInfoClick}\n              className=\"flex items-center gap-2 w-full sm:w-auto\"\n              data-testid=\"button-more-info\"\n            >\n              <Info className=\"w-4 h-4\" />\n              Plus d'informations\n            </Button>\n          </div>\n\n          <p className=\"text-xs text-muted-foreground pt-4 px-4\">\n            Vous avez déjà payé et vous voyez cet écran?<br />\n            Contactez le support pour résoudre ce problème.\n          </p>\n        </div>\n      </div>\n\n      <div className=\"fixed bottom-0 left-0 right-0 p-4 flex justify-center\">\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}\n          className=\"text-xs text-muted-foreground\"\n          data-testid=\"button-theme-toggle-paywall\"\n        >\n          {theme === 'dark' ? 'Mode clair' : 'Mode sombre'}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3972,"size_tokens":null},"client/src/pages/DuoTransition3.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { useSession } from '@/contexts/SessionContext';\nimport { GitBranch, MessageSquare, Repeat } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Transition3() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n  const { session } = useSession();\n\n  const handleOption1 = () => {\n    transitionToStep(21);\n  };\n\n  const handleOption2 = () => {\n    transitionToStep(25);\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"flex items-center justify-center min-h-[calc(100vh-180px)] md:min-h-[60vh]\">\n        <div className=\"max-w-2xl mx-auto text-center space-y-4 md:space-y-8 py-4\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 rounded-full bg-primary/10 mb-2\">\n            <GitBranch className=\"w-8 h-8 md:w-10 md:h-10 text-primary\" />\n          </div>\n\n          <h1 className=\"text-2xl md:text-3xl lg:text-4xl font-bold text-foreground tracking-tight px-4\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n            Conclure ou explorer la perspective de {session.receiverName}?\n          </h1>\n\n          <p className=\"text-sm md:text-base text-foreground leading-relaxed max-w-lg mx-auto px-4\">\n            Vous avez maintenant partagé vos vécus, vos besoins et trouvé des pistes d'entente. Deux options s'offrent à vous :\n          </p>\n\n          <div className=\"grid md:grid-cols-2 gap-3 md:gap-4 pt-4 md:pt-6 max-w-2xl mx-auto px-4\">\n            <div className=\"flex flex-col items-center p-4 md:p-6 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n              <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2 md:mb-3\">\n                <MessageSquare className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n              </div>\n              <h2 className=\"text-base md:text-lg font-bold text-foreground mb-2 md:mb-3\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                Option 1 : Clôturer maintenant\n              </h2>\n              <p className=\"text-xs md:text-sm font-semibold text-foreground mb-2 md:mb-3\">\n                Un dernier feedback dans l'ici et maintenant\n              </p>\n              <p className=\"text-xs md:text-sm text-muted-foreground text-center leading-relaxed mb-4 flex-grow\">\n                Partagez comment vous vous sentez après cet échange.\n              </p>\n              <Button\n                size=\"default\"\n                onClick={handleOption1}\n                disabled={isTransitioning}\n                className=\"text-xs md:text-sm px-4 md:px-6 w-full\"\n                data-testid=\"button-option1\"\n              >\n                Clôturer maintenant\n              </Button>\n            </div>\n\n            <div className=\"flex flex-col items-center p-4 md:p-6 rounded-lg border-2 border-border hover-elevate active-elevate-2 transition-all\">\n              <div className=\"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center mb-2 md:mb-3\">\n                <Repeat className=\"w-5 h-5 md:w-6 md:h-6 text-primary\" />\n              </div>\n              <h2 className=\"text-base md:text-lg font-bold text-foreground mb-2 md:mb-3\" style={{ fontFamily: 'Figtree, sans-serif' }}>\n                Option 2 : Inverser les rôles\n              </h2>\n              <p className=\"text-xs md:text-sm font-semibold text-foreground mb-2 md:mb-3\">\n                Le récepteur s'exprime sur la même situation\n              </p>\n              <p className=\"text-xs md:text-sm text-muted-foreground text-center leading-relaxed mb-4 flex-grow\">\n                {session.receiverName} devient l'émetteur pour explorer les deux perspectives.\n              </p>\n              <Button\n                size=\"default\"\n                onClick={handleOption2}\n                disabled={isTransitioning}\n                className=\"text-xs md:text-sm px-4 md:px-6 w-full\"\n                data-testid=\"button-option2\"\n              >\n                Inverser les rôles\n              </Button>\n            </div>\n          </div>\n\n          {isTransitioning && (\n            <div className=\"pt-4\">\n              <Progress value={progress} className=\"w-full md:w-96 mx-auto\" />\n            </div>\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4527,"size_tokens":null},"client/src/pages/DuoSenderSummary.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { ListChecks, VolumeX, CheckCircle2 } from 'lucide-react';\n\nexport default function SenderSummary() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const checklistItems = [\n    \"La situation (qu'est-ce qui s'est passé)\",\n    \"Mon vécu (comment je me suis senti)\",\n    \"Mon interprétation (comment j'ai perçu la situation)\",\n    \"L'impact (les conséquences pour moi)\",\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <ListChecks className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Fais un résumé\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, reprends les 4 points que tu viens de partager\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground\">\n              Refais brièvement le tour des principaux points que tu as adressé :\n            </p>\n\n            <div className=\"space-y-3\">\n              {checklistItems.map((item, index) => (\n                <div\n                  key={index}\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-card border border-card-border hover-elevate transition-colors\"\n                >\n                  <CheckCircle2 className=\"w-5 h-5 text-primary flex-shrink-0 mt-0.5\" />\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    {item}\n                  </span>\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(12)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3037,"size_tokens":null},"client/src/pages/DuoInversionPage10a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage10a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme l'impact et ta réaction\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, quel a été l'impact sur toi, comment as-tu réagis?\n            </h2>\n\n            <div className=\"space-y-3 md:space-y-4\">\n              <ul className=\"space-y-3\">\n                <li className=\"flex items-start gap-3\">\n                  <span className=\"text-primary text-xl\">•</span>\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    Quand ça arrive, je me sens rejeté / pas important / incompris...\n                  </span>\n                </li>\n                <li className=\"flex items-start gap-3\">\n                  <span className=\"text-primary text-xl\">•</span>\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    L'impact sur moi est que...\n                  </span>\n                </li>\n                <li className=\"flex items-start gap-3\">\n                  <span className=\"text-primary text-xl\">•</span>\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    Je réagis généralement en...\n                  </span>\n                </li>\n              </ul>\n\n              <ExpandableSection>\n                <p className=\"mb-4\">\n                  Maintenant, partage les conséquences que cette situation a sur toi. Comment cela affecte-t-il ton bien-être, ta relation, ta façon d'agir?\n                </p>\n                <p className=\"mb-4\">\n                  Les impacts peuvent être variés :\n                </p>\n                <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                  <li>Défensif : tu te protèges, tu te justifies</li>\n                  <li>Coupure : tu te retires, tu crées de la distance</li>\n                  <li>Accrochage : tu contre-attaques, tu reproches</li>\n                  <li>Bouderie : tu te renfermes, tu deviens silencieux</li>\n                  <li>Anxiété : tu te sens insécure, inquiet</li>\n                </ul>\n                <p>\n                  Partage honnêtement comment cette situation t'affecte et comment tu as tendance à réagir quand cela arrive.\n                </p>\n              </ExpandableSection>\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(29)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              OK, next!\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4230,"size_tokens":null},"client/src/components/logo.tsx":{"content":"import { useTheme } from './theme-provider';\nimport logoBleu from '@assets/logo-bleu-320_1764950756900.png';\nimport logoBlanc from '@assets/logo-blanc-320_1764950756900.png';\n\ninterface LogoProps {\n  className?: string;\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport function Logo({ className = '', size = 'md' }: LogoProps) {\n  const { actualTheme } = useTheme();\n  \n  const sizeClasses = {\n    sm: 'h-8 w-8',\n    md: 'h-10 w-10',\n    lg: 'h-16 w-16',\n  };\n\n  const logoSrc = actualTheme === 'dark' ? logoBlanc : logoBleu;\n\n  return (\n    <img \n      src={logoSrc} \n      alt=\"Avancer Simplement\" \n      className={`${sizeClasses[size]} object-contain ${className}`}\n      data-testid=\"img-logo\"\n    />\n  );\n}\n","path":null,"size_bytes":703,"size_tokens":null},"client/src/pages/SoloFeedback.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Star, Loader2 } from 'lucide-react';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\nimport type { InsertFeedback } from '@shared/schema';\n\nexport default function Feedback() {\n  const { transitionToStep } = usePageTransition();\n  const { toast } = useToast();\n  const [rating, setRating] = useState<number | null>(null);\n  const [helpfulAspect, setHelpfulAspect] = useState('');\n  const [improvementSuggestion, setImprovementSuggestion] = useState('');\n\n  const submitFeedbackMutation = useMutation({\n    mutationFn: async (feedback: InsertFeedback) => {\n      return apiRequest('POST', '/api/feedback', feedback);\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Merci!',\n        description: 'Votre feedback a été enregistré avec succès.',\n      });\n      transitionToStep(26);\n    },\n    onError: () => {\n      toast({\n        title: 'Erreur',\n        description: 'Une erreur est survenue lors de l\\'envoi de votre feedback.',\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleSubmit = () => {\n    if (rating) {\n      submitFeedbackMutation.mutate({\n        rating,\n        helpfulAspect: helpfulAspect.trim() || null,\n        improvementSuggestion: improvementSuggestion.trim() || null,\n      });\n    }\n  };\n\n  const handleSkip = () => {\n    transitionToStep(26);\n  };\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Comment s'est passée votre expérience?\n        </h1>\n\n        <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n          Votre feedback anonyme nous aide à améliorer cet outil. Il est totalement optionnel.\n        </p>\n\n        <div className=\"space-y-5 md:space-y-6\">\n          {/* Rating */}\n          <div className=\"space-y-3\">\n            <label className=\"text-base font-medium text-foreground\">\n              Comment évalueriez-vous cette expérience?\n            </label>\n            <div className=\"flex gap-2\">\n              {[1, 2, 3, 4, 5].map((value) => (\n                <button\n                  key={value}\n                  onClick={() => setRating(value)}\n                  className=\"group\"\n                  data-testid={`rating-${value}`}\n                >\n                  <Star\n                    className={`w-10 h-10 transition-colors ${\n                      rating && value <= rating\n                        ? 'fill-primary text-primary'\n                        : 'text-muted stroke-muted-foreground group-hover:text-primary'\n                    }`}\n                  />\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Helpful aspect */}\n          <div className=\"space-y-2\">\n            <label htmlFor=\"helpful\" className=\"text-base font-medium text-foreground\">\n              Qu'est-ce qui a été le plus utile? (optionnel)\n            </label>\n            <Textarea\n              id=\"helpful\"\n              placeholder=\"Par exemple: la structure étape par étape, les explications détaillées, le temps de pause...\"\n              value={helpfulAspect}\n              onChange={(e) => setHelpfulAspect(e.target.value)}\n              className=\"min-h-24\"\n              data-testid=\"input-helpful\"\n            />\n          </div>\n\n          {/* Improvement suggestion */}\n          <div className=\"space-y-2\">\n            <label htmlFor=\"improvement\" className=\"text-base font-medium text-foreground\">\n              Qu'est-ce qui pourrait être amélioré? (optionnel)\n            </label>\n            <Textarea\n              id=\"improvement\"\n              placeholder=\"Vos suggestions pour rendre cet outil encore plus efficace...\"\n              value={improvementSuggestion}\n              onChange={(e) => setImprovementSuggestion(e.target.value)}\n              className=\"min-h-24\"\n              data-testid=\"input-improvement\"\n            />\n          </div>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row gap-3 pt-4\">\n          <Button\n            size=\"lg\"\n            variant=\"outline\"\n            onClick={handleSkip}\n            data-testid=\"button-skip\"\n          >\n            Passer\n          </Button>\n\n          <Button\n            size=\"lg\"\n            onClick={handleSubmit}\n            disabled={!rating || submitFeedbackMutation.isPending}\n            className=\"px-8\"\n            data-testid=\"button-submit-feedback\"\n          >\n            {submitFeedbackMutation.isPending ? 'Envoi...' : 'Envoyer le feedback'}\n          </Button>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4977,"size_tokens":null},"client/src/pages/DuoInversionPage18a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Heart, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage18a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          {session.receiverName}, exprime tes besoins\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.senderName}: écoute avec ouverture\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, de quoi as-tu besoin?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Formule une demande claire et concrète\n            </p>\n          </div>\n\n          <div className=\"space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Face à cette situation, j'aurais besoin que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Sois spécifique et concret\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Formule une demande, pas une exigence\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Maintenant que tu as partagé ton vécu et que {session.senderName} l'a entendu, il est temps d'exprimer ce dont tu as besoin pour améliorer la situation.\n              </p>\n              <p className=\"mb-4\">\n                Une bonne demande est :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li><strong>Spécifique :</strong> \"J'aurais besoin que tu me regardes quand je te parle\" plutôt que \"J'ai besoin de plus d'attention\"</li>\n                <li><strong>Réalisable :</strong> Quelque chose que l'autre peut concrètement faire</li>\n                <li><strong>Formulée comme une demande :</strong> \"Est-ce que tu pourrais...\" au lieu de \"Tu dois...\"</li>\n              </ul>\n              <p>\n                Exemples : \"J'aurais besoin qu'on prenne 15 minutes chaque soir pour discuter sans téléphone\" ou \"J'aurais besoin que tu me préviennes si tu rentres tard\".\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(37)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-finished\"\n              >\n                J'ai terminé\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4448,"size_tokens":null},"client/src/components/Checklist.tsx":{"content":"import { Checkbox } from '@/components/ui/checkbox';\n\ninterface ChecklistItem {\n  id: string;\n  label: string;\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n}\n\ninterface ChecklistProps {\n  items: ChecklistItem[];\n}\n\nexport function Checklist({ items }: ChecklistProps) {\n  return (\n    <div className=\"space-y-3\" data-testid=\"checklist\">\n      {items.map((item) => (\n        <div\n          key={item.id}\n          className=\"flex items-start gap-3 p-4 rounded-lg bg-card border border-card-border hover-elevate transition-colors\"\n        >\n          <Checkbox\n            id={item.id}\n            checked={item.checked}\n            onCheckedChange={item.onChange}\n            className=\"mt-0.5\"\n            data-testid={`checkbox-${item.id}`}\n          />\n          <label\n            htmlFor={item.id}\n            className=\"text-base md:text-lg leading-relaxed cursor-pointer flex-1\"\n          >\n            {item.label}\n          </label>\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":999,"size_tokens":null},"client/src/pages/DuoTransition2.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Lightbulb } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Transition2() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Lightbulb className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Passons au besoin!\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4 text-center\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              Êtes-vous prêts à passer à l'étape suivante?\n            </h2>\n\n            <p className=\"text-base md:text-lg text-foreground leading-relaxed\">\n              Vous allez maintenant aborder la question des besoins et des demandes. C'est le moment de formuler ce qui pourrait améliorer la situation.\n            </p>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Continuez à prendre votre temps et à écouter avec bienveillance.\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(18)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-continue\"\n              >\n                Oui, on continue\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2232,"size_tokens":null},"client/src/pages/DuoSenderImpact.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderImpact() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme l'impact et ta réaction\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, quel a été l'impact sur toi, comment as-tu réagis?\n            </h2>\n\n            <div className=\"space-y-3 md:space-y-4\">\n              <ul className=\"space-y-3\">\n                <li className=\"flex items-start gap-3\">\n                  <span className=\"text-primary text-xl\">•</span>\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    Quand ça arrive, je me sens rejeté / pas important / incompris...\n                  </span>\n                </li>\n                <li className=\"flex items-start gap-3\">\n                  <span className=\"text-primary text-xl\">•</span>\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    L'impact sur moi est que...\n                  </span>\n                </li>\n                <li className=\"flex items-start gap-3\">\n                  <span className=\"text-primary text-xl\">•</span>\n                  <span className=\"text-base md:text-lg leading-relaxed\">\n                    Je réagis généralement en...\n                  </span>\n                </li>\n              </ul>\n\n              <ExpandableSection>\n                <p className=\"mb-4\">\n                  Maintenant, partage les conséquences que cette situation a sur toi. Comment cela affecte-t-il ton bien-être, ta relation, ta façon d'agir?\n                </p>\n                <p className=\"mb-4\">\n                  Les impacts peuvent être variés :\n                </p>\n                <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                  <li>Défensif : tu te protèges, tu te justifies</li>\n                  <li>Coupure : tu te retires, tu crées de la distance</li>\n                  <li>Accrochage : tu contre-attaques, tu reproches</li>\n                  <li>Bouderie : tu te renfermes, tu deviens silencieux</li>\n                  <li>Anxiété : tu te sens insécure, inquiet</li>\n                </ul>\n                <p>\n                  Partage honnêtement comment cette situation t'affecte et comment tu as tendance à réagir quand cela arrive.\n                </p>\n              </ExpandableSection>\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(11)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4221,"size_tokens":null},"client/src/pages/SoloReceiverValidation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { Checklist } from '@/components/Checklist';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverValidation() {\n  const { session, updateSession } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const checklistItems = [\n    {\n      id: 'situation',\n      label: 'La situation (qu\\'est-ce qui s\\'est passé)',\n      checked: session.checklistSituation || false,\n      onChange: (checked: boolean) => updateSession({ checklistSituation: checked }),\n    },\n    {\n      id: 'vecu',\n      label: 'Le vécu (comment il/elle s\\'est senti)',\n      checked: session.checklistVecu || false,\n      onChange: (checked: boolean) => updateSession({ checklistVecu: checked }),\n    },\n    {\n      id: 'interpretation',\n      label: 'L\\'interprétation (comment il/elle a perçu la situation)',\n      checked: session.checklistInterpretation || false,\n      onChange: (checked: boolean) => updateSession({ checklistInterpretation: checked }),\n    },\n    {\n      id: 'impact',\n      label: 'L\\'impact (les conséquences pour lui/elle)',\n      checked: session.checklistImpact || false,\n      onChange: (checked: boolean) => updateSession({ checklistImpact: checked }),\n    },\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <WarningBanner type=\"speaker\" speaker={session.receiverName}>\n          C'est au tour de {session.receiverName} de parler\n        </WarningBanner>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.receiverName}, redis ce que tu as entendu\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Valide avec {session.senderName} que tu as bien entendu\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ne parle pas de toi ou de tes émotions à cette étape\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Reformule simplement ce que {session.senderName} a partagé\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Valide ta compréhension des 4 points ci-dessous\n              </span>\n            </li>\n          </ul>\n\n          <ExpandableSection>\n            <p className=\"mb-4\">\n              Ton rôle ici est de montrer à {session.senderName} que tu as vraiment écouté et compris. Reformule ce que tu as entendu dans tes propres mots, sans juger, sans minimiser, sans ajouter ton point de vue.\n            </p>\n            <p className=\"mb-4\">\n              Pour chaque point, tu peux dire quelque chose comme :\n            </p>\n            <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n              <li><strong>Situation :</strong> \"Si je comprends bien, ce qui s'est passé c'est...\"</li>\n              <li><strong>Vécu :</strong> \"Face à ça, tu t'es senti...\"</li>\n              <li><strong>Interprétation :</strong> \"Tu as eu l'impression que...\"</li>\n              <li><strong>Impact :</strong> \"Et ça t'a amené à réagir en...\"</li>\n            </ul>\n            <p>\n              Après avoir reformulé chaque point oralement, coche la case correspondante. {session.senderName} pourra ensuite confirmer ou rectifier si nécessaire.\n            </p>\n          </ExpandableSection>\n        </div>\n\n        <div className=\"space-y-3\">\n          <p className=\"text-sm font-medium text-foreground\">\n            Coche les cases au fur et à mesure que tu reformules chaque point :\n          </p>\n          <Checklist items={checklistItems} />\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(14)}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            disabled={isTransitioning}\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4994,"size_tokens":null},"client/src/pages/DuoSenderValidation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Ear, Volume2 } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderValidation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Ear className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Valide {session.receiverName}\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <Volume2 className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            C'est au tour de {session.senderName} de parler\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, redis ce que tu as entendu\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Valide que tu as bien compris {session.receiverName}\n            </p>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Répète le vécu de {session.receiverName}\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Valide que tu as bien compris ses émotions\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Ne juge pas, ne minimise pas\n                </span>\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n            <p className=\"text-sm text-foreground\">\n              Reformule simplement : \"Si je comprends bien, tu te sens...\"\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(16)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-next\"\n              >\n                J'ai terminé\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3498,"size_tokens":null},"client/src/pages/SoloWarnings.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { AlertTriangle } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Warnings() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  const warnings = [\n    \"Cet outil n'est pas un substitut à une thérapie relationnelle\",\n    \"Vous devez avoir un minimum de compétences relationnelles, de responsabilité et de gestion émotionnelle pour pouvoir utiliser cet outil convenablement\",\n    \"Cet outil n'est pas fait pour gérer les crises, si vous êtes trop déclenché et que vous avez de la difficulté à gérer vos émotions, prenez un temps chacun de votre côté pour décanter\",\n    \"Le piège principal est d'aller trop vite. Un rythme lent est essentiel pour que cet outil soit efficace\",\n  ];\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-destructive/10 mb-2\">\n          <AlertTriangle className=\"w-8 h-8 text-destructive\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Avant de commencer\n        </h1>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          {warnings.map((warning, index) => (\n            <div\n              key={index}\n              className=\"flex items-start gap-4 p-4 rounded-lg bg-card border border-card-border\"\n              data-testid={`warning-${index}`}\n            >\n              <div className=\"w-6 h-6 rounded-full bg-destructive/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n                <span className=\"text-sm font-semibold text-destructive\">!</span>\n              </div>\n              <p className=\"text-base md:text-lg leading-relaxed text-foreground\">\n                {warning}\n              </p>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(3)}\n            disabled={isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-understood\"\n          >\n            J'ai compris, continuer\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2558,"size_tokens":null},"client/src/hooks/usePageTransition.ts":{"content":"import { useState, useCallback, useEffect } from 'react';\nimport { useSession } from '@/contexts/SessionContext';\n\nexport function usePageTransition() {\n  const { goToStep, session } = useSession();\n  const [isTransitioning, setIsTransitioning] = useState(false);\n  const [progress, setProgress] = useState(0);\n\n  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  const transitionDelay = prefersReducedMotion ? 0 : 1200;\n\n  useEffect(() => {\n    setIsTransitioning(false);\n    setProgress(0);\n  }, [session.currentStep]);\n\n  const transitionToStep = useCallback((step: number) => {\n    setIsTransitioning(true);\n    \n    if (transitionDelay === 0) {\n      setProgress(100);\n      goToStep(step);\n      setTimeout(() => {\n        setIsTransitioning(false);\n        setProgress(0);\n      }, 50);\n      return;\n    }\n    \n    setProgress(0);\n    const startTime = Date.now();\n    const interval = setInterval(() => {\n      const elapsed = Date.now() - startTime;\n      const newProgress = Math.min((elapsed / transitionDelay) * 100, 100);\n      setProgress(newProgress);\n      \n      if (newProgress >= 100) {\n        clearInterval(interval);\n        setTimeout(() => {\n          setIsTransitioning(false);\n          setProgress(0);\n          setTimeout(() => {\n            goToStep(step);\n          }, 50);\n        }, 200);\n      }\n    }, 16);\n  }, [goToStep, transitionDelay]);\n\n  return {\n    isTransitioning,\n    transitionToStep,\n    progress,\n  };\n}\n","path":null,"size_bytes":1497,"size_tokens":null},"client/src/components/ExpandableSection.tsx":{"content":"import { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, ChevronUp } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\n\ninterface ExpandableSectionProps {\n  children: React.ReactNode;\n}\n\nexport function ExpandableSection({ children }: ExpandableSectionProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n  const animationDuration = prefersReducedMotion ? 0 : 0.5;\n\n  return (\n    <div className=\"space-y-3 md:space-y-4\">\n      {!isExpanded && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={() => setIsExpanded(true)}\n          className=\"gap-2 text-primary text-sm\"\n          data-testid=\"button-expand\"\n        >\n          <ChevronDown className=\"w-4 h-4\" />\n          Voir l'explication complète\n        </Button>\n      )}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            transition={{ duration: animationDuration, ease: \"easeOut\" }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"space-y-3 md:space-y-4\">\n              <div className=\"prose prose-sm max-w-none text-foreground leading-relaxed\">\n                {children}\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsExpanded(false)}\n                className=\"gap-2 text-muted-foreground text-sm\"\n                data-testid=\"button-collapse\"\n              >\n                <ChevronUp className=\"w-4 h-4\" />\n                Réduire\n              </Button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n","path":null,"size_bytes":1934,"size_tokens":null},"client/src/pages/DuoIntention.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Heart } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Intention() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Rappel important\n        </h1>\n\n        <div className=\"w-full max-w-2xl space-y-5 md:space-y-6\">\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n            <p className=\"text-lg md:text-xl leading-relaxed text-foreground font-medium\">\n              Malgré les malaises et inconforts que ça peut créer, le but de la communication est d'être bien ensemble.\n            </p>\n\n            <p className=\"text-base md:text-lg leading-relaxed text-muted-foreground\">\n              Apprendre à vivre l'inconfort et rester en lien est crucial pour bien communiquer.\n            </p>\n          </div>\n\n          <div className=\"prose prose-sm max-w-none text-muted-foreground\">\n            <p className=\"leading-relaxed\">\n              Cette conversation n'est pas un débat à gagner, mais un moment de connexion authentique. L'objectif n'est pas d'avoir raison, mais de se comprendre mutuellement.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex flex-col items-center pt-4 space-y-4\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(4)}\n            disabled={isTransitioning}\n            className=\"px-12\"\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-64\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2227,"size_tokens":null},"client/src/pages/DuoReceiverClosing.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { Heart } from 'lucide-react';\n\nexport default function ReceiverClosing() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <div className=\"flex flex-col items-center gap-2\">\n          <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n            Conclusion - Ici et maintenant\n          </h1>\n          <span className=\"text-sm text-muted-foreground\">2/2</span>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n            {session.receiverName} comment te sens-tu alors qu'on arrive à la fin?\n          </h2>\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Après cet échange, je me sens...\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ce qui me reste de cette conversation...\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Nomme ce qui est présent pour toi maintenant, pas seulement ce qui s'est passé pendant l'échange\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Accueille et exprime tes émotions sans jugement\n              </span>\n            </li>\n          </ul>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n            <p className=\"text-sm text-foreground\">\n              Cette étape te permet de te déposer après l'échange et de reconnaître l'effort accompli. C'est le moment d'accueillir ce qui reste de cette conversation dans l'ici et maintenant, sans jugement. Prends le temps d'apprécier l'engagement qu'il t'a fallu pour être authentique et vulnérable avec {session.senderName}.\n            </p>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(23)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3601,"size_tokens":null},"client/src/pages/DuoInversionPage15a.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Ear, Volume2 } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function DuoInversionPage15a() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Ear className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Valide {session.senderName}\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <Volume2 className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            C'est au tour de {session.receiverName} de parler\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.receiverName}, redis ce que tu as entendu\n            </h2>\n\n            <p className=\"text-base md:text-lg text-muted-foreground leading-relaxed\">\n              Valide que tu as bien compris {session.senderName}\n            </p>\n\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Répète le vécu de {session.senderName}\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Valide que tu as bien compris ses émotions\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Ne juge pas, ne minimise pas\n                </span>\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n            <p className=\"text-sm text-foreground\">\n              Reformule simplement : \"Si je comprends bien, tu te sens...\"\n            </p>\n          </div>\n\n          <div className=\"space-y-4 pt-4\">\n            <div className=\"flex justify-center\">\n              <Button\n                size=\"lg\"\n                onClick={() => transitionToStep(34)}\n                disabled={isTransitioning}\n                className=\"min-w-48\"\n                data-testid=\"button-next\"\n              >\n                Étape suivante\n              </Button>\n            </div>\n            \n            {isTransitioning && (\n              <div className=\"flex justify-center\">\n                <Progress value={progress} className=\"w-full md:w-48\" />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3501,"size_tokens":null},"client/src/pages/admin-login.tsx":{"content":"import { useState } from 'react';\nimport { useLocation } from 'wouter';\nimport { LogIn, ArrowLeft, Loader2, AlertCircle } from 'lucide-react';\nimport { Logo } from '@/components/logo';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { ThemeToggle } from '@/components/theme-toggle';\n\nexport default function AdminLogin() {\n  const [, setLocation] = useLocation();\n  const [email, setEmail] = useState('');\n  const [pin, setPin] = useState('');\n  const [error, setError] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setIsLoading(true);\n\n    try {\n      const response = await fetch('/api/auth/admin-login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, pin }),\n      });\n\n      const data = await response.json();\n\n      if (!response.ok) {\n        throw new Error(data.error || 'Erreur de connexion');\n      }\n\n      localStorage.setItem('session_token', data.session_token);\n      localStorage.setItem('user_id', data.user_id);\n      localStorage.setItem('is_admin', String(data.is_admin));\n      localStorage.setItem('session_timestamp', String(Date.now()));\n\n      setLocation('/admin');\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Erreur de connexion');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\n      <div className=\"absolute top-4 right-4\">\n        <ThemeToggle />\n      </div>\n\n      <Card className=\"w-full max-w-md shadow-lg\" data-testid=\"card-admin-login\">\n        <CardHeader className=\"text-center space-y-4\">\n          <Logo size=\"lg\" className=\"mx-auto\" />\n          <div className=\"flex items-center justify-center w-12 h-12 mx-auto rounded-full bg-primary/10\">\n            <LogIn className=\"h-6 w-6 text-primary\" />\n          </div>\n          <CardTitle className=\"text-2xl font-semibold\">\n            Connexion\n          </CardTitle>\n          <CardDescription>\n            Accédez à votre espace membre\n          </CardDescription>\n        </CardHeader>\n\n        <CardContent className=\"space-y-6\">\n          {error && (\n            <Alert variant=\"destructive\" className=\"bg-destructive/10 border-destructive/20\">\n              <AlertCircle className=\"h-4 w-4\" />\n              <AlertDescription data-testid=\"text-error\">{error}</AlertDescription>\n            </Alert>\n          )}\n\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\">Email</Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                placeholder=\"admin@example.com\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                required\n                disabled={isLoading}\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"pin\">NIP (4-6 chiffres)</Label>\n              <Input\n                id=\"pin\"\n                type=\"password\"\n                inputMode=\"numeric\"\n                pattern=\"[0-9]*\"\n                maxLength={6}\n                placeholder=\"••••••\"\n                value={pin}\n                onChange={(e) => setPin(e.target.value.replace(/\\D/g, ''))}\n                required\n                disabled={isLoading}\n                data-testid=\"input-pin\"\n              />\n            </div>\n\n            <Button\n              onClick={(e) => handleSubmit(e)}\n              className=\"w-full h-12\"\n              disabled={isLoading || !email || pin.length < 4}\n              data-testid=\"button-submit\"\n            >\n              {isLoading ? (\n                <>\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                  Connexion...\n                </>\n              ) : (\n                <>\n                  <LogIn className=\"h-4 w-4 mr-2\" />\n                  Se connecter\n                </>\n              )}\n            </Button>\n          </div>\n\n          <Button\n            variant=\"ghost\"\n            className=\"w-full\"\n            onClick={() => setLocation('/')}\n            data-testid=\"button-back\"\n          >\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Retour\n          </Button>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4772,"size_tokens":null},"client/src/pages/SoloSenderImpact.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderImpact() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <WarningBanner type=\"speaker\">\n            {session.receiverName} écoute sans parler\n          </WarningBanner>\n\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.senderName}, quel a été l'impact sur toi?\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Parle des conséquences\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Quand ça arrive, je me sens rejeté / pas important / incompris...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  L'impact sur moi est que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Je réagis généralement en...\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Maintenant, partage les conséquences que cette situation a sur toi. Comment cela affecte-t-il ton bien-être, ta relation, ta façon d'agir?\n              </p>\n              <p className=\"mb-4\">\n                Les impacts peuvent être variés :\n              </p>\n              <ul className=\"list-disc pl-6 space-y-2 mb-4\">\n                <li>Défensif : tu te protèges, tu te justifies</li>\n                <li>Coupure : tu te retires, tu crées de la distance</li>\n                <li>Accrochage : tu contre-attaques, tu reproches</li>\n                <li>Bouderie : tu te renfermes, tu deviens silencieux</li>\n                <li>Anxiété : tu te sens insécure, inquiet</li>\n              </ul>\n              <p>\n                Partage honnêtement comment cette situation t'affecte et comment tu as tendance à réagir quand cela arrive.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(12)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3584,"size_tokens":null},"client/src/pages/SoloSenderValidation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderValidation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <WarningBanner type=\"speaker\" speaker={session.senderName}>\n          C'est au tour de {session.senderName} de parler\n        </WarningBanner>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.senderName}, redis ce que tu as entendu\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          Valide que tu as bien compris les émotions de {session.receiverName}\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Répète le vécu de {session.receiverName}\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Valide que tu as bien compris ses émotions\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ne juge pas, ne minimise pas\n              </span>\n            </li>\n          </ul>\n        </div>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n          <p className=\"text-sm text-foreground\">\n            Reformule simplement : \"Si je comprends bien, tu te sens... [les émotions que tu as entendues]\"\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(18)}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            disabled={isTransitioning}\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2771,"size_tokens":null},"client/src/pages/SoloTransition2.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { ArrowRight } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Transition2() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Êtes-vous prêts à passer à l'étape suivante?\n        </h1>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n          <p className=\"text-lg leading-relaxed text-foreground\">\n            Vous allez maintenant aborder la question des besoins et des demandes. C'est le moment de formuler ce qui pourrait améliorer la situation.\n          </p>\n\n          <p className=\"text-base text-muted-foreground leading-relaxed\">\n            Continuez à prendre votre temps et à écouter avec bienveillance.\n          </p>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(20)}\n            disabled={isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-continue\"\n          >\n            Oui, on continue\n            <ArrowRight className=\"w-5 h-5 ml-2\" />\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":1674,"size_tokens":null},"client/src/pages/DuoSenderInterpretation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { MessageSquare, VolumeX } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderInterpretation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <MessageSquare className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n          Nomme ta vision des choses\n        </h1>\n\n        <div className=\"flex items-center gap-2\">\n          <VolumeX className=\"w-5 h-5 text-destructive\" />\n          <p className=\"text-base md:text-lg text-muted-foreground\">\n            {session.receiverName} : écoute attentive et bienveillante\n          </p>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <div className=\"space-y-4\">\n            <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n              {session.senderName}, parle de comment tu as perçu la situation\n            </h2>\n\n            <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Quand c'est arrivé, j'ai eu l'impression que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  J'ai vu ça de cette façon...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Pour moi, ça voulait dire que...\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Nos émotions sont créées par notre interprétation personnelle des situations. Ce que tu as ressenti découle de comment tu as interprété ce qui s'est passé.\n              </p>\n              <p className=\"mb-4\">\n                Par exemple : si quelqu'un ne te salue pas le matin, tu pourrais interpréter que cette personne est fâchée contre toi (ce qui pourrait créer de l'anxiété), ou qu'elle est préoccupée par quelque chose (ce qui créerait de l'empathie).\n              </p>\n              <p>\n                Partage maintenant comment TOI tu as interprété la situation. Utilise des formules comme \"J'ai eu l'impression que...\", \"Je me suis dit que...\", \"Pour moi, ça signifiait que...\". Reconnais que c'est ton interprétation, pas nécessairement la réalité.\n              </p>\n            </ExpandableSection>\n            </div>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(10)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":4059,"size_tokens":null},"client/src/pages/SoloIntention.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Heart } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function Intention() {\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-2\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          Rappel important\n        </h1>\n\n        <div className=\"space-y-5 md:space-y-6\">\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-6 space-y-4\">\n            <p className=\"text-lg md:text-xl leading-relaxed text-foreground font-medium\">\n              Malgré les malaises et inconforts que ça peut créer, le but de la communication est d'être bien ensemble.\n            </p>\n\n            <p className=\"text-base md:text-lg leading-relaxed text-muted-foreground\">\n              Apprendre à vivre l'inconfort et rester en lien est crucial pour bien communiquer.\n            </p>\n          </div>\n\n          <div className=\"prose prose-sm max-w-none text-muted-foreground\">\n            <p className=\"leading-relaxed\">\n              Cette conversation n'est pas un débat à gagner, mais un moment de connexion authentique. L'objectif n'est pas d'avoir raison, mais de se comprendre mutuellement.\n            </p>\n          </div>\n        </div>\n\n        <div className=\"pt-4 space-y-3\">\n          <Button\n            size=\"lg\"\n            onClick={() => transitionToStep(5)}\n            disabled={isTransitioning}\n            className=\"w-full md:w-auto px-8 min-w-48\"\n            data-testid=\"button-next\"\n          >\n            Suivant\n          </Button>\n          {isTransitioning && (\n            <Progress value={progress} className=\"w-full md:w-48\" />\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":2178,"size_tokens":null},"client/src/pages/SoloReceiverGrounding.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function ReceiverGrounding() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.receiverName}, prends le temps de te déposer\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Comment te sens-tu à l'idée d'écouter {session.senderName}?\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Parle de ce que tu ressens maintenant, en ce moment précis\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Exprime ton état d'esprit face à cette conversation qui arrive\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Prends le temps de reconnaître tes émotions présentes\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                En tant que récepteur, ton rôle est d'écouter avec bienveillance. Mais avant de pouvoir vraiment écouter l'autre, il est important que tu reconnaisses ton propre état émotionnel.\n              </p>\n              <p>\n                Peut-être ressens-tu de l'ouverture, de la curiosité, mais aussi peut-être de l'appréhension ou de la défensive. Tous ces ressentis sont valides. Les exprimer maintenant te permet de les reconnaître et de te préparer à accueillir ce que {session.senderName} va partager.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(7)}\n              disabled={isTransitioning}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3165,"size_tokens":null},"client/src/pages/SoloSenderInterpretation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { ExpandableSection } from '@/components/ExpandableSection';\nimport { WarningBanner } from '@/components/WarningBanner';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderInterpretation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n        <div className=\"space-y-6 md:space-y-8\">\n          <WarningBanner type=\"speaker\">\n            {session.receiverName} écoute sans parler\n          </WarningBanner>\n\n          <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n            {session.senderName}, comment as-tu perçu la situation?\n          </h1>\n\n          <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n            Explique ton interprétation\n          </p>\n\n          <div className=\"space-y-3 md:space-y-4\">\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Quand c'est arrivé, j'ai eu l'impression que...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  J'ai vu ça de cette façon...\n                </span>\n              </li>\n              <li className=\"flex items-start gap-3\">\n                <span className=\"text-primary text-xl\">•</span>\n                <span className=\"text-base md:text-lg leading-relaxed\">\n                  Pour moi, ça voulait dire que...\n                </span>\n              </li>\n            </ul>\n\n            <ExpandableSection>\n              <p className=\"mb-4\">\n                Nos émotions sont créées par notre interprétation personnelle des situations. Ce que tu as ressenti découle de comment tu as interprété ce qui s'est passé.\n              </p>\n              <p className=\"mb-4\">\n                Par exemple : si quelqu'un ne te salue pas le matin, tu pourrais interpréter que cette personne est fâchée contre toi (ce qui pourrait créer de l'anxiété), ou qu'elle est préoccupée par quelque chose (ce qui créerait de l'empathie).\n              </p>\n              <p>\n                Partage maintenant comment TOI tu as interprété la situation. Utilise des formules comme \"J'ai eu l'impression que...\", \"Je me suis dit que...\", \"Pour moi, ça signifiait que...\". Reconnais que c'est ton interprétation, pas nécessairement la réalité.\n              </p>\n            </ExpandableSection>\n          </div>\n\n          <div className=\"pt-4 space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(11)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </PageLayout>\n  );\n}\n","path":null,"size_bytes":3522,"size_tokens":null},"client/src/pages/SoloSenderConfirmation.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { CheckCircle2, Edit3 } from 'lucide-react';\nimport { Progress } from '@/components/ui/progress';\n\nexport default function SenderConfirmation() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"space-y-6 md:space-y-8\">\n        <h1 className=\"text-3xl md:text-4xl font-semibold font-serif text-foreground\">\n          {session.senderName}, as-tu été bien entendu?\n        </h1>\n\n        <p className=\"text-lg md:text-xl text-muted-foreground leading-relaxed\">\n          {session.receiverName} vient de reformuler ce que tu as partagé\n        </p>\n\n        <div className=\"space-y-3 md:space-y-4\">\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ajoute des précisions si nécessaire\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Rectifie ce qui n'est pas tout à fait juste\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Appuie sur ce qui est particulièrement important pour toi\n              </span>\n            </li>\n          </ul>\n        </div>\n\n        <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n          <p className=\"text-sm text-foreground\">\n            L'objectif est que {session.receiverName} comprenne vraiment ce que tu vis. Prends le temps nécessaire pour t'assurer que ton message est bien passé.\n          </p>\n        </div>\n\n        <div className=\"space-y-4 pt-4\">\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <Button\n              size=\"lg\"\n              variant=\"outline\"\n              onClick={() => transitionToStep(15)}\n              disabled={isTransitioning}\n              className=\"min-w-48\"\n              data-testid=\"button-clarify\"\n            >\n              <Edit3 className=\"w-5 h-5 mr-2\" />\n              Je veux ajouter/rectifier\n            </Button>\n\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(16)}\n              disabled={isTransitioning}\n              className=\"min-w-48\"\n              data-testid=\"button-confirm\"\n            >\n              <CheckCircle2 className=\"w-5 h-5 mr-2\" />\n              Oui, c'est bien ça\n            </Button>\n          </div>\n          \n          {isTransitioning && (\n            <div className=\"flex justify-center\">\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            </div>\n          )}\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3285,"size_tokens":null},"client/src/pages/DuoSenderClosing.tsx":{"content":"import { Button } from '@/components/ui/button';\nimport { PageLayout } from '@/components/PageLayout';\nimport { useSession } from '@/contexts/SessionContext';\nimport { usePageTransition } from '@/hooks/usePageTransition';\nimport { Progress } from '@/components/ui/progress';\nimport { Heart } from 'lucide-react';\n\nexport default function SenderClosing() {\n  const { session } = useSession();\n  const { isTransitioning, transitionToStep, progress } = usePageTransition();\n\n  return (\n    <PageLayout>\n      <div className=\"flex flex-col items-center space-y-8 md:space-y-10\">\n        <div className=\"flex items-center justify-center w-16 h-16 rounded-full bg-primary/10\">\n          <Heart className=\"w-8 h-8 text-primary\" />\n        </div>\n\n        <div className=\"flex flex-col items-center gap-2\">\n          <h1 className=\"text-3xl md:text-4xl lg:text-5xl font-semibold font-serif text-foreground text-center\">\n            Conclusion - Ici et maintenant\n          </h1>\n          <span className=\"text-sm text-muted-foreground\">1/2</span>\n        </div>\n\n        <div className=\"w-full max-w-2xl space-y-6 md:space-y-8\">\n          <h2 className=\"text-xl md:text-2xl font-medium text-foreground\">\n            {session.senderName} comment te sens-tu alors qu'on arrive à la fin?\n          </h2>\n          <ul className=\"space-y-3\">\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Après cet échange, je me sens...\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Ce qui me reste de cette conversation...\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Nomme ce qui est présent pour toi maintenant, pas seulement ce qui s'est passé pendant l'échange\n              </span>\n            </li>\n            <li className=\"flex items-start gap-3\">\n              <span className=\"text-primary text-xl\">•</span>\n              <span className=\"text-base md:text-lg leading-relaxed\">\n                Accueille et exprime tes émotions sans jugement\n              </span>\n            </li>\n          </ul>\n\n          <div className=\"rounded-lg border border-primary/20 bg-primary/5 p-4\">\n            <p className=\"text-sm text-foreground\">\n              Cette étape te permet de te déposer après l'échange et de reconnaître l'effort accompli. C'est le moment d'accueillir ce qui te reste de cette conversation dans l'ici et maintenant, sans jugement. Prends le temps d'apprécier l'engagement qu'il t'a fallu pour être authentique et vulnérable avec {session.receiverName}.\n            </p>\n          </div>\n\n          <div className=\"pt-4 flex flex-col items-center space-y-3\">\n            <Button\n              size=\"lg\"\n              onClick={() => transitionToStep(22)}\n              className=\"w-full md:w-auto px-8 min-w-48\"\n              disabled={isTransitioning}\n              data-testid=\"button-next\"\n            >\n              Suivant\n            </Button>\n            {isTransitioning && (\n              <Progress value={progress} className=\"w-full md:w-48\" />\n            )}\n          </div>\n        </div>\n      </div>\n    </PageLayout>\n  );\n}\n","path":null,"size_bytes":3602,"size_tokens":null}},"version":2}